# 004 - å¤§å±å¹•ç³»ç»Ÿè‡ªå®šä¹‰æ‹–æ‹½å¸ƒå±€

## éœ€æ±‚æ¦‚è¿°

å®ç°ä¸€ä¸ªå¤§å±å¹•å±•ç¤ºç³»ç»Ÿï¼Œæ”¯æŒè‡ªå®šä¹‰æ‹–æ‹½å¸ƒå±€ã€åœ¨çº¿é¢„è§ˆå’ŒæŠ•æ”¾å±•ç¤ºã€‚

## ç³»ç»Ÿæ¶æ„

### 1. @pro/api - åç«¯æœåŠ¡
è´Ÿè´£é¡µé¢é…ç½®çš„æ•°æ®ç®¡ç†

**åŠŸèƒ½æ¨¡å—ï¼š**
- å¤§å±é¡µé¢ CRUD æ¥å£
- å¸ƒå±€é…ç½®ä¿å­˜/åŠ è½½
- ç»„ä»¶é…ç½®ç®¡ç†
- æƒé™æ§åˆ¶

**æ•°æ®æ¨¡å‹è®¾è®¡ï¼š**
```typescript
// å¤§å±é¡µé¢è¡¨
interface ScreenPage {
  id: string;
  name: string;              // é¡µé¢åç§°
  description?: string;      // é¡µé¢æè¿°
  layout: LayoutConfig;      // å¸ƒå±€é…ç½®
  components: Component[];   // ç»„ä»¶åˆ—è¡¨
  status: 'draft' | 'published';  // å‘å¸ƒçŠ¶æ€
  createdBy: string;         // åˆ›å»ºè€…
  createdAt: Date;
  updatedAt: Date;
}

// å¸ƒå±€é…ç½®
interface LayoutConfig {
  width: number;             // ç”»å¸ƒå®½åº¦ï¼ˆå¦‚ 1920ï¼‰
  height: number;            // ç”»å¸ƒé«˜åº¦ï¼ˆå¦‚ 1080ï¼‰
  background: string;        // èƒŒæ™¯è‰²/å›¾ç‰‡
  grid?: {
    enabled: boolean;
    size: number;
  };
}

// ç»„ä»¶é…ç½®
interface Component {
  id: string;
  type: string;              // ç»„ä»¶ç±»å‹ï¼šchart/text/image/video/data-table
  position: {
    x: number;
    y: number;
    width: number;
    height: number;
    zIndex: number;
  };
  config: any;               // ç»„ä»¶ç‰¹å®šé…ç½®
  dataSource?: {
    type: 'api' | 'static';
    url?: string;
    data?: any;
    refreshInterval?: number; // åˆ·æ–°é—´éš”ï¼ˆmsï¼‰
  };
}
```

**API æ¥å£ï¼š**
```
POST   /api/screens              - åˆ›å»ºå¤§å±é¡µé¢
GET    /api/screens              - è·å–é¡µé¢åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ï¼‰
GET    /api/screens/:id          - è·å–é¡µé¢è¯¦æƒ…
PUT    /api/screens/:id          - æ›´æ–°é¡µé¢é…ç½®
DELETE /api/screens/:id          - åˆ é™¤é¡µé¢
POST   /api/screens/:id/copy     - å¤åˆ¶é¡µé¢
POST   /api/screens/:id/publish  - å‘å¸ƒé¡µé¢
POST   /api/screens/:id/draft    - è®¾ä¸ºè‰ç¨¿
PUT    /api/screens/default/:id  - è®¾ç½®é»˜è®¤é¡µé¢
GET    /api/screens/default      - è·å–é»˜è®¤é¡µé¢
```

**è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼š**

```typescript
// POST /api/screens - åˆ›å»ºé¡µé¢
Request:
{
  "name": "å¾®åšè¿è¥å¤§å±",
  "description": "å±•ç¤ºå¾®åšè´¦å·è¿è¥æ•°æ®",
  "layout": {
    "width": 1920,
    "height": 1080,
    "background": "#0f1419",
    "grid": { "enabled": true, "size": 10 }
  },
  "components": []
}

Response:
{
  "id": "uuid-xxx",
  "name": "å¾®åšè¿è¥å¤§å±",
  "status": "draft",
  "createdAt": "2025-10-08T10:00:00Z",
  ...
}

// PUT /api/screens/:id - æ›´æ–°é¡µé¢
Request:
{
  "layout": { ... },
  "components": [
    {
      "id": "comp-1",
      "type": "weibo-stats-card",
      "position": { "x": 0, "y": 0, "width": 4, "height": 2, "zIndex": 1 }
    },
    {
      "id": "comp-2",
      "type": "fans-trend-chart",
      "position": { "x": 4, "y": 0, "width": 8, "height": 4, "zIndex": 1 }
    }
  ]
}
```

### 2. @pro/admin - ç®¡ç†åå°ï¼ˆç¼–è¾‘å™¨ï¼‰
è´Ÿè´£åˆ›å»ºå’Œç®¡ç†å¤§å±é¡µé¢ï¼Œæä¾›æ‹–æ‹½å¸ƒå±€ç¼–è¾‘å™¨

#### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**1. å¤šé¡µé¢ç®¡ç†åŠŸèƒ½**
- âœ… **é¡µé¢åˆ—è¡¨**ï¼šå±•ç¤ºæ‰€æœ‰åˆ›å»ºçš„é¡µé¢ï¼ˆåç§°ã€åˆ›å»ºæ—¶é—´ã€çŠ¶æ€ï¼‰
- âœ… **åˆ›å»ºé¡µé¢**ï¼šå¿«é€Ÿåˆ›å»ºæ–°çš„å¤§å±é¡µé¢
- âœ… **ç¼–è¾‘é¡µé¢**ï¼šè¿›å…¥ç¼–è¾‘å™¨ä¿®æ”¹é¡µé¢å¸ƒå±€
- âœ… **åˆ é™¤é¡µé¢**ï¼šåˆ é™¤ä¸éœ€è¦çš„é¡µé¢
- âœ… **å¤åˆ¶é¡µé¢**ï¼šåŸºäºç°æœ‰é¡µé¢å¿«é€Ÿåˆ›å»ºå‰¯æœ¬
- âœ… **åˆ‡æ¢é¡µé¢**ï¼šåœ¨ä¸åŒé¡µé¢ä¹‹é—´åˆ‡æ¢å±•ç¤º
- âœ… **è®¾ç½®é»˜è®¤**ï¼šè®¾ç½®ç³»ç»Ÿå¯åŠ¨æ—¶çš„é»˜è®¤é¡µé¢
- ğŸ”„ **é¡µé¢çŠ¶æ€**ï¼šè‰ç¨¿ / å·²å‘å¸ƒ

**2. å¯è§†åŒ–æ‹–æ‹½ç¼–è¾‘å™¨**
- âœ… **ç»„ä»¶åº“é¢æ¿**ï¼šå±•ç¤ºæ‰€æœ‰å¯ç”¨çš„ä¸šåŠ¡ç»„ä»¶
- âœ… **æ‹–æ‹½æ·»åŠ ç»„ä»¶**ï¼šä»ç»„ä»¶åº“æ‹–æ‹½åˆ°ç”»å¸ƒï¼ˆAngular CDKï¼‰
- âœ… **å¸ƒå±€è°ƒæ•´**ï¼šç§»åŠ¨ã€ç¼©æ”¾ç»„ä»¶ï¼ˆangular-gridster2ï¼‰
- âœ… **å®æ—¶é¢„è§ˆ**ï¼šåˆ‡æ¢é¢„è§ˆæ¨¡å¼ï¼Œæ‰€è§å³æ‰€å¾—
- âœ… **è‡ªåŠ¨ä¿å­˜**ï¼šå®šæ—¶è‡ªåŠ¨ä¿å­˜è‰ç¨¿
- âœ… **æ’¤é”€/é‡åš**ï¼šæ”¯æŒæ“ä½œå†å²å›é€€

**3. ç»„ä»¶åº“ï¼ˆä¸šåŠ¡ç»„ä»¶å¼€ç®±å³ç”¨ï¼‰**
- ğŸ“Š **å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡** `WeiboLoggedInUsersCardComponent` â­ï¸ ä¼˜å…ˆå®ç°
  - å±•ç¤ºï¼šå·²ç™»å½•ç”¨æˆ·æ€»æ•°ã€ä»Šæ—¥æ–°å¢ã€åœ¨çº¿ç”¨æˆ·æ•°
  - æ•°æ®æºï¼šGET `/api/weibo/logged-in-users/stats`
  - WebSocketï¼šç›‘å¬ `weibo:logged-in-users:update` äº‹ä»¶
  - æ ·å¼ï¼šäº®è‰²ä¸»é¢˜å¡ç‰‡

**æŠ€æœ¯æ ˆï¼š**
- æ‹–æ‹½åº“ï¼š`angular-gridster2` + `@angular/cdk/drag-drop`
- åŠ¨æ€ç»„ä»¶ï¼š`ComponentFactoryResolver`
- ç»„ä»¶æ³¨å†Œï¼š`ComponentRegistryService`
- å›¾è¡¨åº“ï¼š`ECharts`ï¼ˆç”¨äºå›¾è¡¨ç±»ç»„ä»¶ï¼‰
- æ ·å¼åº“ï¼š`TailwindCSS`

**ç¼–è¾‘å™¨é¡µé¢ç»“æ„ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¶éƒ¨å·¥å…·æ                                                     â”‚
â”‚ [è¿”å›åˆ—è¡¨] [é¡µé¢åç§°] [è‡ªåŠ¨ä¿å­˜] [é¢„è§ˆ] [ä¿å­˜] [å‘å¸ƒ]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          â”‚                                  â”‚               â”‚
â”‚ å·¦ä¾§é¢æ¿ â”‚        ä¸­å¤®ç”»å¸ƒåŒºåŸŸ               â”‚  å³ä¾§é¢æ¿     â”‚
â”‚          â”‚                                  â”‚               â”‚
â”‚ ç»„ä»¶åº“   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  é¡µé¢è®¾ç½®     â”‚
â”‚ â”œâ”€å¾®åš   â”‚   â”‚                         â”‚   â”‚  - é¡µé¢åç§°   â”‚
â”‚ â”‚ ç»Ÿè®¡   â”‚   â”‚   gridster2 ç½‘æ ¼å¸ƒå±€    â”‚   â”‚  - ç”»å¸ƒå°ºå¯¸   â”‚
â”‚ â”‚ å¡ç‰‡   â”‚   â”‚                         â”‚   â”‚  - èƒŒæ™¯è®¾ç½®   â”‚
â”‚ â”œâ”€ç²‰ä¸   â”‚   â”‚   [ç»„ä»¶1] [ç»„ä»¶2]       â”‚   â”‚  - ç½‘æ ¼é…ç½®   â”‚
â”‚ â”‚ è¶‹åŠ¿   â”‚   â”‚                         â”‚   â”‚               â”‚
â”‚ â”œâ”€è´¦å·   â”‚   â”‚   [ç»„ä»¶3]               â”‚   â”‚               â”‚
â”‚ â”‚ åˆ—è¡¨   â”‚   â”‚                         â”‚   â”‚               â”‚
â”‚ â””â”€...    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚               â”‚
â”‚          â”‚                                  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. @pro/web - å‰å°å±•ç¤º
è´Ÿè´£å¤§å±é¡µé¢çš„çº¿ä¸ŠæŠ•æ”¾å’Œå±•ç¤º

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æ ¹æ®é¡µé¢ ID åŠ è½½é…ç½®
- æ¸²æŸ“å¤§å±å¸ƒå±€å’Œç»„ä»¶
- æ•°æ®è‡ªåŠ¨åˆ·æ–°
- å…¨å±å±•ç¤ºæ¨¡å¼
- å“åº”å¼é€‚é…ï¼ˆå¯é€‰ï¼‰

**æŠ€æœ¯è¦ç‚¹ï¼š**
- çº¯å±•ç¤ºæ¨¡å¼ï¼Œä¸å¯ç¼–è¾‘
- æ”¯æŒå®æ—¶æ•°æ®æ›´æ–°
- æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤§å±é•¿æ—¶é—´è¿è¡Œï¼‰

## æŠ€æœ¯æ–¹æ¡ˆ

### æ‹–æ‹½ç¼–è¾‘å™¨å®ç°æ–¹æ¡ˆ âœ…

**ç¡®å®šæ–¹æ¡ˆï¼šangular-gridster2 + Angular CDK Drag Drop**

#### æŠ€æœ¯æ ˆç»„åˆ
1. **angular-gridster2**ï¼šå®ç°ç”»å¸ƒç½‘æ ¼å¸ƒå±€å’Œç»„ä»¶æ‹–æ‹½è°ƒæ•´
   - ç½‘æ ¼åŒ–å¸ƒå±€ç®¡ç†
   - ç»„ä»¶ä½ç½®ã€å°ºå¯¸è°ƒæ•´
   - å“åº”å¼å¸ƒå±€æ”¯æŒ

2. **Angular CDK Drag Drop**ï¼šå®ç°ç»„ä»¶åº“æ‹–æ‹½
   - ä»ç»„ä»¶åº“æ‹–æ‹½åˆ°ç”»å¸ƒ
   - æ‹–æ‹½é¢„è§ˆæ•ˆæœ
   - æ‹–æ”¾é€»è¾‘å¤„ç†

3. **ComponentFactoryResolver**ï¼šåŠ¨æ€ç»„ä»¶åŠ è½½
   - è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºç»„ä»¶å®ä¾‹
   - æ”¯æŒæ‡’åŠ è½½
   - ç±»å‹å®‰å…¨

#### ç»„ä»¶æ³¨å†Œæœºåˆ¶

```typescript
// component-registry.service.ts
@Injectable({ providedIn: 'root' })
export class ComponentRegistryService {
  private components = new Map<string, Type<any>>();

  register(type: string, component: Type<any>) {
    this.components.set(type, component);
  }

  get(type: string): Type<any> | undefined {
    return this.components.get(type);
  }

  getAll(): Array<{ type: string; component: Type<any> }> {
    return Array.from(this.components.entries()).map(([type, component]) => ({
      type,
      component
    }));
  }
}
```

#### ä¸šåŠ¡ç»„ä»¶å¼€ç®±å³ç”¨è®¾è®¡ **ã€æ ¸å¿ƒç†å¿µã€‘**

**è®¾è®¡åŸåˆ™ï¼š**
- âœ… **é›¶é…ç½®**ï¼šç»„ä»¶å†…éƒ¨å·²å¯¹æ¥åç«¯æ•°æ®æ¥å£
- âœ… **è‡ªåŠ¨è·å–**ï¼šç»„ä»¶é€šè¿‡ Service è‡ªåŠ¨è·å–æ•°æ®
- âœ… **å®æ—¶æ›´æ–°**ï¼šè‡ªåŠ¨è®¢é˜… WebSocket æ¥æ”¶å®æ—¶æ•°æ®
- âœ… **ç»Ÿä¸€æ¥å£**ï¼šæ‰€æœ‰ç»„ä»¶éµå¾ªç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸ

**ç¤ºä¾‹ç»„ä»¶å®ç°ï¼š**

```typescript
// å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡ç»„ä»¶
@Component({
  selector: 'app-weibo-logged-in-users-card',
  template: `
    <div class="stats-card bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡</h3>
      <div class="stats grid grid-cols-3 gap-4">
        <div class="stat-item text-center">
          <div class="text-2xl font-bold text-blue-600">{{ stats?.total || 0 }}</div>
          <div class="text-sm text-gray-500">æ€»ç”¨æˆ·æ•°</div>
        </div>
        <div class="stat-item text-center">
          <div class="text-2xl font-bold text-green-600">{{ stats?.todayNew || 0 }}</div>
          <div class="text-sm text-gray-500">ä»Šæ—¥æ–°å¢</div>
        </div>
        <div class="stat-item text-center">
          <div class="text-2xl font-bold text-purple-600">{{ stats?.online || 0 }}</div>
          <div class="text-sm text-gray-500">åœ¨çº¿ç”¨æˆ·</div>
        </div>
      </div>
    </div>
  `
})
export class WeiboLoggedInUsersCardComponent implements OnInit, OnDestroy {
  stats: any;
  private destroy$ = new Subject<void>();

  constructor(
    private weiboService: WeiboService,
    private wsService: WebSocketService
  ) {}

  ngOnInit() {
    // è‡ªåŠ¨è·å–åˆå§‹æ•°æ®
    this.weiboService.getLoggedInUsersStats().pipe(
      takeUntil(this.destroy$)
    ).subscribe(stats => {
      this.stats = stats;
    });

    // è‡ªåŠ¨è®¢é˜…å®æ—¶æ›´æ–°
    this.wsService.on('weibo:logged-in-users:update').pipe(
      takeUntil(this.destroy$)
    ).subscribe(stats => {
      this.stats = stats;
    });
  }

  ngOnDestroy() {
    this.destroy$.next();
    this.destroy$.complete();
  }
}
```

**æ•°æ®æ¥å£å®šä¹‰ï¼š**

```typescript
// GET /api/weibo/logged-in-users/stats
interface LoggedInUsersStats {
  total: number;        // å·²ç™»å½•ç”¨æˆ·æ€»æ•°
  todayNew: number;     // ä»Šæ—¥æ–°å¢ç™»å½•ç”¨æˆ·
  online: number;       // å½“å‰åœ¨çº¿ç”¨æˆ·æ•°
}

// WebSocket äº‹ä»¶ï¼šweibo:logged-in-users:update
// æ¨é€ç›¸åŒæ ¼å¼çš„æ•°æ®
```

**ç”¨æˆ·ä½¿ç”¨æµç¨‹ï¼š**
1. ä»å·¦ä¾§ç»„ä»¶åº“æ‹–æ‹½ã€Œå¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡ã€åˆ°ç”»å¸ƒ
2. ç»„ä»¶è‡ªåŠ¨è°ƒç”¨ API è·å–æ•°æ®å¹¶å±•ç¤º
3. WebSocket è‡ªåŠ¨æ¨é€å®æ—¶æ›´æ–°
4. æ— éœ€ä»»ä½•é…ç½®ï¼Œå¼€ç®±å³ç”¨

### å·¥ä½œæµç¨‹

#### 1. è¿›å…¥ç¼–è¾‘å™¨
- ç”¨æˆ·ç‚¹å‡»ã€Œåˆ›å»ºé¡µé¢ã€åˆ›å»ºæ–°é¡µé¢
- æˆ–ç‚¹å‡»ã€Œç¼–è¾‘é¡µé¢ã€ç¼–è¾‘å·²æœ‰é¡µé¢
- è¿›å…¥å¯è§†åŒ–ç¼–è¾‘å™¨ç•Œé¢

#### 2. æ‹–æ‹½ç»„ä»¶
- ä»å·¦ä¾§ç»„ä»¶åº“é¢æ¿é€‰æ‹©ç»„ä»¶
- ä½¿ç”¨ Angular CDK Drag Drop æ‹–æ‹½åˆ°ç”»å¸ƒ
- gridster2 è‡ªåŠ¨åˆ†é…ç½‘æ ¼ä½ç½®

#### 3. è°ƒæ•´å¸ƒå±€
- æ‹–åŠ¨ç»„ä»¶è°ƒæ•´ä½ç½®
- æ‹–åŠ¨è¾¹è§’è°ƒæ•´å°ºå¯¸
- å®æ—¶çœ‹åˆ°å¸ƒå±€å˜åŒ–

#### 4. å®æ—¶é¢„è§ˆ
- åˆ‡æ¢åˆ°é¢„è§ˆæ¨¡å¼
- æŸ¥çœ‹çœŸå®æ•°æ®æ•ˆæœ
- æ‰€è§å³æ‰€å¾—

#### 5. ä¿å­˜é¡µé¢
- ç‚¹å‡»ä¿å­˜æŒ‰é’®
- åºåˆ—åŒ–ç”»å¸ƒé…ç½®
- é€šè¿‡ RESTful API ä¿å­˜åˆ°æ•°æ®åº“

#### 6. åˆ‡æ¢é¡µé¢
- åœ¨é¡µé¢åˆ—è¡¨ä¸­é€‰æ‹©ä¸åŒé¡µé¢
- å¿«é€Ÿåˆ‡æ¢å±•ç¤ºå†…å®¹
- æ”¯æŒè®¾ç½®é»˜è®¤é¡µé¢

### æ•°æ®æµè®¾è®¡

```
ç¼–è¾‘å™¨æµç¨‹ï¼š
1. ç”¨æˆ·ä»ç»„ä»¶åº“æ‹–æ‹½ç»„ä»¶ï¼ˆCDK Drag Dropï¼‰
2. ç»„ä»¶æ·»åŠ åˆ° gridster2 ç”»å¸ƒ
3. ComponentFactoryResolver åŠ¨æ€åˆ›å»ºç»„ä»¶å®ä¾‹
4. ç»„ä»¶è‡ªåŠ¨è·å–æ•°æ®å¹¶å±•ç¤ºï¼ˆæ— éœ€é…ç½®ï¼‰
5. ç”¨æˆ·è°ƒæ•´å¸ƒå±€ï¼ˆç§»åŠ¨ã€ç¼©æ”¾ï¼‰
6. ç‚¹å‡»ä¿å­˜ï¼Œåºåˆ—åŒ–é…ç½® â†’ POST /api/screens
7. åˆ‡æ¢é¢„è§ˆæ¨¡å¼ï¼ŒæŸ¥çœ‹çœŸå®æ•ˆæœ

å±•ç¤ºæµç¨‹ï¼ˆ@pro/webï¼‰ï¼š
1. é€šè¿‡ URL å‚æ•°è·å–é¡µé¢ IDï¼ˆ/screen/:idï¼‰
2. è°ƒç”¨ GET /api/screens/:id è·å–é…ç½®
3. ComponentFactoryResolver åŠ¨æ€æ¸²æŸ“ç»„ä»¶
4. ç»„ä»¶è‡ªåŠ¨è·å–æ•°æ® + WebSocket å®æ—¶æ›´æ–°
5. å…¨å±å±•ç¤ºæ¨¡å¼
```

## å¼€å‘è®¡åˆ’ä¸ä»»åŠ¡æ‹†åˆ†

### ä»»åŠ¡ä¾èµ–å…³ç³»åˆ†æ

```
ä»»åŠ¡ä¾èµ–å›¾ï¼š
A(æ•°æ®åº“è®¾è®¡) -> B(APIæ¥å£) -> C(adminé¡µé¢åˆ—è¡¨) -> D(ç¼–è¾‘å™¨æ¡†æ¶)
                             -> E(webå±•ç¤ºæ¡†æ¶)

D(ç¼–è¾‘å™¨æ¡†æ¶) -> F(ç»„ä»¶æ³¨å†ŒæœåŠ¡) -> G(ä¸šåŠ¡ç»„ä»¶å¼€å‘) -> H(æ‹–æ‹½åŠŸèƒ½)
E(webå±•ç¤ºæ¡†æ¶) -> I(æ¸²æŸ“å¼•æ“)

H(æ‹–æ‹½åŠŸèƒ½) + I(æ¸²æŸ“å¼•æ“) -> J(é¢„è§ˆæ¨¡å¼) -> K(é›†æˆæµ‹è¯•)

æ‰§è¡Œé¡ºåºï¼š
1. Aï¼ˆæ•°æ®åº“ï¼‰
2. Bï¼ˆAPIï¼‰
3. C|E å¹¶è¡Œï¼ˆadminåˆ—è¡¨ + webæ¡†æ¶ï¼‰
4. Dï¼ˆç¼–è¾‘å™¨æ¡†æ¶ï¼‰
5. Fï¼ˆç»„ä»¶æ³¨å†Œï¼‰
6. Gï¼ˆä¸šåŠ¡ç»„ä»¶ï¼‰
7. H|I å¹¶è¡Œï¼ˆæ‹–æ‹½ + æ¸²æŸ“ï¼‰
8. Jï¼ˆé¢„è§ˆï¼‰
9. Kï¼ˆæµ‹è¯•ï¼‰
```

### é˜¶æ®µä¸€ï¼šåŸºç¡€æ¶æ„ï¼ˆåç«¯ä¼˜å…ˆï¼‰

**ä»»åŠ¡ Aï¼šæ•°æ®åº“è¡¨è®¾è®¡**
- [ ] åˆ›å»º `screen_pages` è¡¨
  - `id`, `name`, `description`, `layout`, `components`, `status`, `is_default`, `created_by`, `created_at`, `updated_at`
- [ ] åˆ›å»º Entityï¼š`ScreenPage`
- [ ] ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬

**ä»»åŠ¡ Bï¼šAPI åŸºç¡€æ¥å£å®ç°**ï¼ˆä¾èµ– Aï¼‰
- [ ] åˆ›å»º `screens` æ¨¡å—ï¼ˆNestJSï¼‰
- [ ] å®ç° CRUD æ¥å£
  - `POST /api/screens` - åˆ›å»º
  - `GET /api/screens` - åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
  - `GET /api/screens/:id` - è¯¦æƒ…
  - `PUT /api/screens/:id` - æ›´æ–°
  - `DELETE /api/screens/:id` - åˆ é™¤
  - `POST /api/screens/:id/copy` - å¤åˆ¶
  - `POST /api/screens/:id/publish` - å‘å¸ƒ
  - `PUT /api/screens/default/:id` - è®¾ç½®é»˜è®¤
  - `GET /api/screens/default` - è·å–é»˜è®¤
- [ ] å®ç°å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡æ¥å£
  - `GET /api/weibo/logged-in-users/stats` - è·å–ç»Ÿè®¡æ•°æ®
- [ ] æ·»åŠ  JWT æƒé™æ ¡éªŒï¼ˆ`@UseGuards(JwtAuthGuard)`ï¼‰
- [ ] å®ç° WebSocket Gateway
  - åˆ›å»º `ScreensGateway`
  - æ”¯æŒ `weibo:logged-in-users:update` äº‹ä»¶æ¨é€
  - JWT è®¤è¯ï¼ˆWebSocket æ¡æ‰‹æ—¶éªŒè¯ tokenï¼‰
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

**æäº¤ç‚¹ï¼š** å®Œæˆåæäº¤ä»£ç  `feat(api): å®ç°å¤§å±é¡µé¢ç®¡ç†æ¥å£å’Œ WebSocket`

### é˜¶æ®µäºŒï¼šå‰ç«¯æ¡†æ¶æ­å»ºï¼ˆå¹¶è¡Œï¼‰

**ä»»åŠ¡ Cï¼šadmin é¡µé¢åˆ—è¡¨**ï¼ˆä¾èµ– Bï¼Œä¸ E å¹¶è¡Œï¼‰
- [ ] åˆ›å»º `screens` è·¯ç”±å’Œç»„ä»¶ï¼ˆéœ€è¦ç™»å½•ï¼Œ`canActivate: [AuthGuard]`ï¼‰
- [ ] å®ç°é¡µé¢åˆ—è¡¨é¡µé¢
  - è¡¨æ ¼å±•ç¤ºï¼ˆåç§°ã€çŠ¶æ€ã€åˆ›å»ºæ—¶é—´ã€æ“ä½œï¼‰
  - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€å¤åˆ¶æŒ‰é’®
  - è®¾ç½®é»˜è®¤é¡µé¢åŠŸèƒ½
- [ ] åˆ›å»º `ScreenApiService`ï¼ˆHTTP è¯·æ±‚å¸¦ JWT tokenï¼‰
- [ ] çŠ¶æ€ç®¡ç†ï¼ˆAkita Storeï¼‰

**ä»»åŠ¡ Eï¼šweb å±•ç¤ºæ¡†æ¶**ï¼ˆä¾èµ– Bï¼Œä¸ C å¹¶è¡Œï¼‰
- [ ] åˆ›å»º `/screen/:id` è·¯ç”±ï¼ˆéœ€è¦ç™»å½•ï¼Œ`canActivate: [AuthGuard]`ï¼‰
- [ ] åˆ›å»º `screen-display.component`
- [ ] åˆ›å»º `ScreenApiService`ï¼ˆHTTP è¯·æ±‚å¸¦ JWT tokenï¼‰
- [ ] åˆ›å»º `WebSocketService`ï¼ˆè¿æ¥æ—¶ä¼ é€’ JWT tokenï¼‰
- [ ] å…¨å±æ¨¡å¼æ”¯æŒ

**æäº¤ç‚¹ï¼š** å®Œæˆåæäº¤ä»£ç  `feat(admin,web): æ·»åŠ å¤§å±é¡µé¢ç®¡ç†åŸºç¡€æ¡†æ¶`

### é˜¶æ®µä¸‰ï¼šç¼–è¾‘å™¨æ ¸å¿ƒå¼€å‘

**ä»»åŠ¡ Dï¼šç¼–è¾‘å™¨æ¡†æ¶**ï¼ˆä¾èµ– Cï¼‰
- [ ] åˆ›å»ºç¼–è¾‘å™¨è·¯ç”± `/screens/editor/:id`
- [ ] æ­å»ºç¼–è¾‘å™¨å¸ƒå±€ï¼ˆä¸‰æ ç»“æ„ï¼‰
  - é¡¶éƒ¨å·¥å…·æ 
  - å·¦ä¾§ç»„ä»¶åº“é¢æ¿
  - ä¸­å¤®ç”»å¸ƒåŒºåŸŸ
  - å³ä¾§è®¾ç½®é¢æ¿
- [ ] é›†æˆ `angular-gridster2`
- [ ] åŸºç¡€ä¿å­˜/åŠ è½½åŠŸèƒ½

**ä»»åŠ¡ Fï¼šç»„ä»¶æ³¨å†ŒæœåŠ¡**ï¼ˆä¾èµ– Dï¼‰
- [ ] åˆ›å»º `ComponentRegistryService`
- [ ] å®šä¹‰ç»„ä»¶æ¥å£ `IScreenComponent`
- [ ] å®ç°ç»„ä»¶æ³¨å†Œæœºåˆ¶

**ä»»åŠ¡ Gï¼šä¸šåŠ¡ç»„ä»¶å¼€å‘**ï¼ˆä¾èµ– Fï¼‰
- [ ] å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡ç»„ä»¶ `WeiboLoggedInUsersCardComponent`
  - è°ƒç”¨ `GET /api/weibo/logged-in-users/stats` è·å–åˆå§‹æ•°æ®
  - è®¢é˜… WebSocket äº‹ä»¶ `weibo:logged-in-users:update`
  - äº®è‰²ä¸»é¢˜æ ·å¼è®¾è®¡ï¼ˆç™½è‰²å¡ç‰‡ + TailwindCSSï¼‰
  - å±•ç¤ºï¼šæ€»ç”¨æˆ·æ•°ã€ä»Šæ—¥æ–°å¢ã€åœ¨çº¿ç”¨æˆ·æ•°
- [ ] æ³¨å†Œç»„ä»¶åˆ° Registry

**æäº¤ç‚¹ï¼š** å®Œæˆåæäº¤ä»£ç  `feat(admin,web): å®ç°å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡`

### é˜¶æ®µå››ï¼šæ‹–æ‹½ä¸æ¸²æŸ“ï¼ˆå¹¶è¡Œï¼‰

**ä»»åŠ¡ Hï¼šæ‹–æ‹½åŠŸèƒ½å®ç°**ï¼ˆä¾èµ– Gï¼Œä¸ I å¹¶è¡Œï¼‰
- [ ] ç»„ä»¶åº“ -> ç”»å¸ƒæ‹–æ‹½ï¼ˆAngular CDKï¼‰
- [ ] gridster2 é…ç½®å’Œé›†æˆ
- [ ] ComponentFactoryResolver åŠ¨æ€åˆ›å»ºç»„ä»¶
- [ ] ç»„ä»¶åˆ é™¤åŠŸèƒ½
- [ ] å¸ƒå±€åºåˆ—åŒ–/ååºåˆ—åŒ–

**ä»»åŠ¡ Iï¼šweb æ¸²æŸ“å¼•æ“**ï¼ˆä¾èµ– E+Fï¼Œä¸ H å¹¶è¡Œï¼‰
- [ ] å®ç°åŠ¨æ€ç»„ä»¶æ¸²æŸ“
- [ ] åŠ è½½é¡µé¢é…ç½®å¹¶æ¸²æŸ“
- [ ] WebSocket å®æ—¶æ•°æ®æ¨é€
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆé•¿æ—¶é—´è¿è¡Œï¼‰

**æäº¤ç‚¹ï¼š** å®Œæˆååˆ†åˆ«æäº¤ `feat(admin): å®ç°æ‹–æ‹½ç¼–è¾‘åŠŸèƒ½` å’Œ `feat(web): å®ç°å¤§å±æ¸²æŸ“å¼•æ“`

### é˜¶æ®µäº”ï¼šé¢„è§ˆä¸æµ‹è¯•

**ä»»åŠ¡ Jï¼šé¢„è§ˆæ¨¡å¼**ï¼ˆä¾èµ– H+Iï¼‰
- [ ] admin ç¼–è¾‘å™¨é¢„è§ˆæ¨¡å¼
- [ ] é¢„è§ˆæ¨¡å¼æ•°æ®æ¨¡æ‹Ÿ
- [ ] ç¼–è¾‘/é¢„è§ˆæ¨¡å¼åˆ‡æ¢

**ä»»åŠ¡ Kï¼šé›†æˆæµ‹è¯•**ï¼ˆä¾èµ– Jï¼‰
- [ ] E2E æµ‹è¯•ï¼šåˆ›å»ºé¡µé¢æµç¨‹
- [ ] E2E æµ‹è¯•ï¼šç¼–è¾‘å™¨æ‹–æ‹½æµç¨‹
- [ ] E2E æµ‹è¯•ï¼šweb å±•ç¤ºæµç¨‹
- [ ] æ€§èƒ½æµ‹è¯•

**æäº¤ç‚¹ï¼š** å®Œæˆåæäº¤ä»£ç  `test: æ·»åŠ å¤§å±ç³»ç»Ÿé›†æˆæµ‹è¯•`

### é˜¶æ®µå…­ï¼šä¼˜åŒ–ä¸å®Œå–„

- [ ] æ ·å¼ä¼˜åŒ–ï¼ˆTailwindCSSï¼‰
- [ ] è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
- [ ] æ’¤é”€/é‡åšåŠŸèƒ½
- [ ] é”™è¯¯å¤„ç†å’Œæç¤º
- [ ] æ–‡æ¡£ç¼–å†™

---

## æŠ€æœ¯ç»†èŠ‚ç¡®è®¤

### âœ… å·²ç¡®è®¤
1. **æŠ€æœ¯æ ˆ**ï¼šangular-gridster2 + Angular CDK + ComponentFactoryResolver
2. **æ ¸å¿ƒç†å¿µ**ï¼šä¸šåŠ¡ç»„ä»¶å¼€ç®±å³ç”¨ï¼Œé›¶é…ç½®
3. **å¤šé¡µé¢ç®¡ç†**ï¼šå®Œæ•´çš„ CRUD + é»˜è®¤é¡µé¢è®¾ç½®
4. **å›ºå®šåˆ†è¾¨ç‡**ï¼š1920x1080ï¼ˆæš‚ä¸è€ƒè™‘å“åº”å¼ï¼‰

### âœ… å…¨éƒ¨ç¡®è®¤

1. **åˆæœŸç»„ä»¶åº“èŒƒå›´**ï¼š
   - âœ… æš‚æ—¶åªå®ç° 1 ä¸ªæ¼”ç¤ºç»„ä»¶å³å¯
   - ğŸ“Š **å¾®åšå·²ç™»å½•ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡** `WeiboLoggedInUsersCardComponent`ï¼ˆä¼˜å…ˆå®ç°ï¼‰
   - å±•ç¤ºï¼šæ€»ç”¨æˆ·æ•°ã€ä»Šæ—¥æ–°å¢ã€åœ¨çº¿ç”¨æˆ·æ•°

2. **WebSocket å®æ—¶æ¨é€**ï¼š
   - âœ… ä¼˜å…ˆä½¿ç”¨ WebSocket
   - ç»„ä»¶è‡ªåŠ¨è®¢é˜… WebSocket äº‹ä»¶æ¥æ”¶å®æ—¶æ•°æ®
   - éœ€è¦å®ç° WebSocket Gatewayï¼ˆNestJSï¼‰

3. **æƒé™ç®¡ç†**ï¼š
   - âœ… **admin ç¼–è¾‘**ï¼šéœ€è¦ç™»å½•ï¼ˆJWT é‰´æƒï¼‰
   - âœ… **web å±•ç¤º**ï¼šéœ€è¦ç™»å½•ï¼ˆJWT é‰´æƒï¼‰
   - ä½¿ç”¨ç°æœ‰çš„ JWT Auth Guard

4. **ç»„ä»¶æ ·å¼ä¸»é¢˜**ï¼š
   - âœ… äº®è‰²ä¸»é¢˜ä¸ºä¸»
   - âœ… ä¸éœ€è¦ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½

---

## æ–¹æ¡ˆæœ€ç»ˆç¡®è®¤ âœ…

å·²ç¡®è®¤æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚ï¼Œå‡†å¤‡è¿›å…¥å¼€å‘é˜¶æ®µï¼
