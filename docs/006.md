# 006 - 媒体类型表设计方案

## 1. 需求背景

设计一个媒体类型表，用于管理系统中的各种媒体类型分类，如：政府、企业、自媒体等。

## 2. 需求确认

- ✅ 数据库：PostgreSQL
- ✅ ORM：TypeORM
- ✅ 类型编号：用户自定义填写（唯一约束）
- ✅ 层级结构：不支持父子级，扁平结构
- ✅ 示例类型：政府、企业、自媒体

## 3. 表结构设计

### 3.1 表名：media_type

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | int | 主键ID | 自增主键 |
| type_code | varchar(50) | 类型编号 | 必填，唯一，用户自定义 |
| type_name | varchar(100) | 类型名称 | 必填 |
| description | varchar(500) | 类型描述 | 可选 |
| sort | int | 排序序号 | 默认0 |
| status | enum('ACTIVE','INACTIVE') | 状态 | 默认ACTIVE |
| created_at | timestamp | 创建时间 | 自动生成 |
| updated_at | timestamp | 更新时间 | 自动更新 |

### 3.2 索引设计

- PRIMARY KEY: `id`
- UNIQUE KEY: `type_code`
- INDEX: `status`

## 4. 技术实现

### 4.1 后端 API（apps/api）

#### 4.1.1 Entity 实体
```
apps/api/src/entities/media-type.entity.ts
```

#### 4.1.2 Module 模块
```
apps/api/src/media-type/media-type.module.ts
apps/api/src/media-type/media-type.service.ts
apps/api/src/media-type/media-type.controller.ts
apps/api/src/media-type/dto/create-media-type.dto.ts
apps/api/src/media-type/dto/update-media-type.dto.ts
apps/api/src/media-type/dto/query-media-type.dto.ts
```

#### 4.1.3 API 接口设计

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /media-type | 创建媒体类型 |
| GET | /media-type | 获取类型列表（支持分页、筛选） |
| GET | /media-type/:id | 获取单个类型详情 |
| PATCH | /media-type/:id | 更新媒体类型 |
| DELETE | /media-type/:id | 删除媒体类型 |

### 4.2 SDK 封装（@pro/sdk）

#### 4.2.1 SDK 文件
```
packages/sdk/src/media-type.sdk.ts
```

#### 4.2.2 接口定义
```typescript
// packages/sdk/src/media-type.interface.ts
export interface MediaType {
  id: number;
  typeCode: string;
  typeName: string;
  description?: string;
  sort: number;
  status: 'ACTIVE' | 'INACTIVE';
  createdAt: Date;
  updatedAt: Date;
}

export interface CreateMediaTypeDto {
  typeCode: string;
  typeName: string;
  description?: string;
  sort?: number;
  status?: 'ACTIVE' | 'INACTIVE';
}

export interface UpdateMediaTypeDto {
  typeCode?: string;
  typeName?: string;
  description?: string;
  sort?: number;
  status?: 'ACTIVE' | 'INACTIVE';
}

export interface QueryMediaTypeDto {
  page?: number;
  pageSize?: number;
  status?: 'ACTIVE' | 'INACTIVE';
  keyword?: string;
}
```

#### 4.2.3 SDK 方法
```typescript
class MediaTypeSdk {
  createMediaType(data: CreateMediaTypeDto): Promise<MediaType>
  getMediaTypeList(query?: QueryMediaTypeDto): Promise<{ list: MediaType[], total: number }>
  getMediaTypeById(id: number): Promise<MediaType>
  updateMediaType(id: number, data: UpdateMediaTypeDto): Promise<MediaType>
  deleteMediaType(id: number): Promise<void>
}
```

### 4.3 前端管理页面（@pro/admin）

#### 4.3.1 页面路由
```
apps/admin/src/app/features/media-type/
```

#### 4.3.2 组件结构
```
apps/admin/src/app/features/media-type/
├── media-type-list/                 # 列表页面
│   ├── media-type-list.component.ts
│   ├── media-type-list.component.html
│   └── media-type-list.component.scss
├── media-type-form/                 # 表单组件（新增/编辑）
│   ├── media-type-form.component.ts
│   ├── media-type-form.component.html
│   └── media-type-form.component.scss
├── media-type.routes.ts             # 路由配置
└── services/
    └── media-type.service.ts        # 调用 SDK
```

#### 4.3.3 页面功能
- **列表页**：展示、搜索、分页、启用/禁用、删除
- **新增/编辑**：表单录入、校验（类型编号唯一性）
- **权限控制**：基于现有权限系统

## 5. 数据示例

```json
[
  { "type_code": "GOV", "type_name": "政府", "sort": 1 },
  { "type_code": "ENT", "type_name": "企业", "sort": 2 },
  { "type_code": "SELF", "type_name": "自媒体", "sort": 3 }
]
```

## 6. 业务规则

1. **类型编号唯一性**：创建时检查 type_code 是否已存在
2. **删除限制**：如有关联数据，禁止删除或提示用户
3. **状态控制**：可启用/禁用，禁用后不影响已有数据
4. **排序**：按 sort 字段升序排列

## 7. 待确认问题

1. 删除类型时的处理策略？
   - 硬删除 or 软删除？
   - 如有关联数据如何处理？

2. 是否需要前端管理界面？

3. 权限控制要求？
