# @pro/admin 布局美化方案

## 目标
将 @pro/admin 改造为现代化的管理后台布局：侧边栏 + 顶部状态栏 + 核心内容区

## 当前状态分析
待调研现有布局结构

## 设计方案

### 1. 整体布局结构
```
┌─────────────────────────────────────────────┐
│           顶部状态栏 (Header)                │
├──────────┬──────────────────────────────────┤
│          │                                  │
│  侧边栏   │        核心内容区                 │
│ (Sidebar)│       (Main Content)            │
│          │                                  │
│          │                                  │
└──────────┴──────────────────────────────────┘
```

### 2. 组件划分

#### 2.1 顶部状态栏 (Header)
- 用户信息显示
- 通知中心
- 快捷操作
- 退出登录

#### 2.2 侧边栏 (Sidebar)
- Logo 区域
- 二级导航菜单
  - 大屏管理
    - 大屏列表
    - 创建大屏
  - 微博账号管理
    - 账号列表
    - 账号授权
  - 系统设置（可选）
- 可折叠功能（状态需持久化到 localStorage）

#### 2.3 核心内容区 (Main Content)
- 面包屑导航
- 页面标题
- 路由内容区域

### 3. 技术实现

#### 3.1 组件结构详细拆分

##### 3.1.1 布局容器组件（Layout 层级）
- `LayoutComponent` - 主布局容器（根组件）
  - 路径: `src/app/core/layout/layout.component.ts`
  - 职责: 管理整体布局结构，包含 Header + Sidebar + Main

##### 3.1.2 顶部状态栏组件（Header 层级）
- `HeaderComponent` - 顶部状态栏容器
  - 路径: `src/app/core/layout/header/header.component.ts`
  - 职责: 顶部栏整体布局
  - 子组件:
    - `UserInfoComponent` - 用户信息下拉菜单
      - 路径: `src/app/core/layout/header/user-info/user-info.component.ts`
      - 职责: 显示用户头像、用户名、下拉菜单（个人设置、退出登录）
    - `NotificationComponent` - 通知中心
      - 路径: `src/app/core/layout/header/notification/notification.component.ts`
      - 职责: 显示通知图标、未读数、通知列表

##### 3.1.3 侧边栏组件（Sidebar 层级）
- `SidebarComponent` - 侧边栏容器
  - 路径: `src/app/core/layout/sidebar/sidebar.component.ts`
  - 职责: 侧边栏整体布局、折叠状态管理
  - 子组件:
    - `LogoComponent` - Logo 区域
      - 路径: `src/app/core/layout/sidebar/logo/logo.component.ts`
      - 职责: 显示 Logo 和品牌名（折叠时仅显示小 Logo）
    - `MenuComponent` - 导航菜单
      - 路径: `src/app/core/layout/sidebar/menu/menu.component.ts`
      - 职责: 管理菜单数据、展开/折叠状态
      - 子组件:
        - `MenuItemComponent` - 单个菜单项
          - 路径: `src/app/core/layout/sidebar/menu/menu-item/menu-item.component.ts`
          - 职责: 渲染单个一级菜单项（支持无子菜单）
        - `SubMenuComponent` - 二级子菜单
          - 路径: `src/app/core/layout/sidebar/menu/sub-menu/sub-menu.component.ts`
          - 职责: 渲染二级菜单项列表、展开/折叠动画
    - `SidebarToggleComponent` - 侧边栏折叠按钮
      - 路径: `src/app/core/layout/sidebar/sidebar-toggle/sidebar-toggle.component.ts`
      - 职责: 切换侧边栏折叠状态

##### 3.1.4 主内容区组件（Main Content 层级）
- `MainContentComponent` - 主内容容器
  - 路径: `src/app/core/layout/main-content/main-content.component.ts`
  - 职责: 包装路由出口，提供内边距
  - 子组件:
    - `BreadcrumbComponent` - 面包屑导航（可选）
      - 路径: `src/app/core/layout/main-content/breadcrumb/breadcrumb.component.ts`
      - 职责: 根据路由自动生成面包屑
    - `PageHeaderComponent` - 页面标题区域（可选）
      - 路径: `src/app/core/layout/main-content/page-header/page-header.component.ts`
      - 职责: 显示当前页面标题和操作按钮

##### 3.1.5 状态管理 Service
- `LayoutStateService` - 布局状态服务
  - 路径: `src/app/core/services/layout-state.service.ts`
  - 职责:
    - 管理侧边栏折叠状态（读写 localStorage）
    - 管理二级菜单展开状态
    - 提供状态变化的 Observable

##### 3.1.6 数据配置
- `menu.config.ts` - 菜单配置文件
  - 路径: `src/app/core/config/menu.config.ts`
  - 职责: 定义菜单数据结构（图标、标题、路由、子菜单）

#### 3.2 路由配置
- 登录/注册页面：不使用布局
- 其他页面：使用完整布局

#### 3.3 样式方案
- 使用 TailwindCSS 实现布局
- 统一的颜色主题和间距
- 流畅的过渡动画

#### 3.4 状态管理
- 侧边栏折叠状态：localStorage 持久化
- 当前激活菜单：通过路由自动匹配
- 二级菜单展开状态：支持手动展开/折叠

### 4. 任务拆分与依赖关系

#### 4.1 基础层任务（无依赖，可并行执行）

##### 任务组 A1: 配置与服务（并行）
- **A1.1** 创建菜单配置文件 `menu.config.ts`
  - 定义菜单数据结构（MenuItem interface）
  - 配置一级菜单和二级菜单数据
  - 配置图标、路由、权限等

- **A1.2** 创建布局状态服务 `LayoutStateService`
  - 实现侧边栏折叠状态管理
  - 实现 localStorage 读写
  - 实现 Observable 状态流
  - 实现二级菜单展开状态管理

##### 任务组 A2: 基础组件（并行）
- **A2.1** 创建 Logo 组件 `LogoComponent`
  - 设计折叠/展开两种显示模式
  - 实现品牌名称显示/隐藏逻辑

- **A2.2** 创建侧边栏折叠按钮 `SidebarToggleComponent`
  - 实现折叠/展开图标切换
  - 绑定点击事件

- **A2.3** 创建用户信息组件 `UserInfoComponent`
  - 实现用户信息显示
  - 实现下拉菜单（个人设置、退出登录）
  - 集成退出登录功能

- **A2.4** 创建通知组件 `NotificationComponent`
  - 实现通知图标和徽章
  - 实现通知列表下拉框
  - 集成 WebSocket 通知（已有 WebSocketService）

- **A2.5** 创建面包屑组件 `BreadcrumbComponent`（可选）
  - 实现路由监听
  - 实现面包屑自动生成逻辑

- **A2.6** 创建页面标题组件 `PageHeaderComponent`（可选）
  - 实现标题显示
  - 预留操作按钮插槽

#### 4.2 组合层任务（依赖基础层）

##### 任务组 B1: 菜单组件（依赖 A1.1, A1.2）串行
- **B1.1** 创建菜单项组件 `MenuItemComponent`
  - 依赖: A1.1（菜单配置）
  - 实现一级菜单项渲染
  - 实现路由激活状态判断
  - 实现图标和文字显示

- **B1.2** 创建二级菜单组件 `SubMenuComponent`
  - 依赖: B1.1（菜单项组件）
  - 实现二级菜单项列表渲染
  - 实现展开/折叠动画
  - 实现激活状态判断

- **B1.3** 创建菜单容器组件 `MenuComponent`
  - 依赖: B1.1, B1.2
  - 组装菜单项和二级菜单
  - 实现菜单数据遍历
  - 集成 LayoutStateService

##### 任务组 B2: 布局容器（依赖基础组件）并行
- **B2.1** 创建侧边栏组件 `SidebarComponent`
  - 依赖: A2.1（Logo）, A2.2（Toggle）, B1.3（Menu）
  - 组装 Logo + Menu + Toggle
  - 实现折叠/展开布局切换
  - 集成 LayoutStateService

- **B2.2** 创建顶部栏组件 `HeaderComponent`
  - 依赖: A2.3（UserInfo）, A2.4（Notification）
  - 组装用户信息和通知
  - 实现顶部栏布局

- **B2.3** 创建主内容组件 `MainContentComponent`
  - 依赖: A2.5（Breadcrumb，可选）, A2.6（PageHeader，可选）
  - 组装面包屑 + 路由出口
  - 实现内容区域布局

#### 4.3 集成层任务（依赖所有组件）

##### 任务组 C1: 主布局（依赖 B2.1, B2.2, B2.3）串行
- **C1.1** 创建主布局组件 `LayoutComponent`
  - 依赖: B2.1, B2.2, B2.3
  - 组装 Header + Sidebar + MainContent
  - 实现整体布局样式（Flex/Grid）
  - 集成 LayoutStateService

- **C1.2** 配置路由嵌套
  - 依赖: C1.1
  - 修改 app.routes.ts
  - 将业务路由嵌套到 LayoutComponent
  - 保持登录/注册页面独立

#### 4.4 优化层任务（依赖集成层）

##### 任务组 D1: 样式和体验优化（并行）
- **D1.1** 统一色彩主题
  - 定义主题色变量
  - 应用到所有组件

- **D1.2** 实现过渡动画
  - 侧边栏折叠动画
  - 二级菜单展开动画
  - 路由切换动画

- **D1.3** 细节打磨
  - 调整间距和对齐
  - 优化交互反馈
  - 测试边界情况

### 5. 并行执行方案

#### 第一轮并行（5个 Agent）
```
Agent 1: A1.1 菜单配置文件
Agent 2: A1.2 布局状态服务
Agent 3: A2.1 Logo 组件
Agent 4: A2.2 侧边栏折叠按钮
Agent 5: A2.3 用户信息组件
```

#### 第二轮并行（3个 Agent）
```
Agent 1: A2.4 通知组件
Agent 2: A2.5 面包屑组件（可选）
Agent 3: A2.6 页面标题组件（可选）
```

#### 第三轮串行（菜单组件依赖链）
```
B1.1 菜单项组件 → B1.2 二级菜单组件 → B1.3 菜单容器组件
```

#### 第四轮并行（3个 Agent）
```
Agent 1: B2.1 侧边栏组件
Agent 2: B2.2 顶部栏组件
Agent 3: B2.3 主内容组件
```

#### 第五轮串行（集成）
```
C1.1 主布局组件 → C1.2 路由配置
```

#### 第六轮并行（3个 Agent）
```
Agent 1: D1.1 色彩主题
Agent 2: D1.2 过渡动画
Agent 3: D1.3 细节打磨
```

### 6. 提交策略
每完成一个任务组，立即提交代码：
- 提交信息格式: `feat(admin): 完成 [任务组名称]`
- 确保每次提交代码可编译、可运行

## 已确认需求
1. ✅ 不需要暗色模式
2. ✅ 侧边栏支持二级菜单
3. ✅ 不需要移动端适配
4. ✅ 需要记住侧边栏折叠状态（localStorage 持久化）

## 待讨论问题
1. 顶部状态栏具体需要哪些功能？（当前：用户信息、通知、快捷操作、退出登录）
2. 二级菜单的具体内容是否需要调整？
3. 是否需要面包屑导航？
4. Logo 和品牌名称是什么？

## 参考设计
- Ant Design Pro
- Element Admin
- Material Dashboard
