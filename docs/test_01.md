# Test Specification: test_01 - 画布编辑器拖拽功能全面检查

## 概述
针对 @pro/admin 画布编辑器中组件拖拽无法移动的问题进行全面测试检查，重点定位问题根因并验证修复方案的有效性。

## 测试目标
1. 确认拖拽功能失效的具体表现和影响范围
2. 识别导致拖拽无法移动的根本原因
3. 验证修复方案的有效性和稳定性
4. 确保修复不影响其他编辑器功能

## 测试范围
- **核心功能**: 画布编辑器组件拖拽交互
- **涉及页面**: 所有自定义大屏编辑页面
- **关键组件**:
  - CanvasService (apps/admin/src/app/features/screens/editor/canvas/services/canvas.service.ts)
  - ShapeComponent (apps/admin/src/app/features/screens/editor/canvas/editor/shape/shape.component.ts)
  - EditorComponent (apps/admin/src/app/features/screens/editor/canvas/editor/editor.component.ts)
- **测试页面示例**: screens/editor/6014a375-a2f7-42e9-ba7b-ca4853243524

## 测试环境
- **环境**: 测试环境
- **浏览器**: Chrome (最新版本)
- **用户权限**: 具有编辑权限的管理员账户
- **前置条件**: 已登录系统，具备访问可视化大屏管理权限

## 测试用例

### 基础功能验证
- **TC01**: 验证编辑页面默认模式状态
- **TC02**: 验证组件从组件库拖入画布的初始交互
- **TC03**: 验证画布内已存在组件的拖拽移动功能
- **TC04**: 验证网格吸附功能是否正常工作

### 根因定位测试
- **TC05**: 检查JavaScript事件绑定状态
- **TC06**: 验证CSS样式是否阻止交互 (pointer-events等)
- **TC07**: 检查编辑模式状态控制逻辑
- **TC08**: 验证全局配置和锁定机制
- **TC09**: 检查组件数据完整性和状态

### 深度技术验证
- **TC10**: 验证CanvasService.setEditMode功能
- **TC11**: 检查ShapeComponent的mousedown事件处理
- **TC12**: 验证throttleFrame和GeometryUtil工具函数
- **TC13**: 检查后端接口返回数据的兼容性
- **TC14**: 验证事件监听器的注册和触发

### 修复验证测试
- **TC15**: 验证修复后拖拽功能恢复情况
- **TC16**: 测试多个编辑页面的拖拽一致性
- **TC17**: 验证其他编辑器功能未受影响
- **TC18**: 性能和稳定性回归测试

## 验收标准

### 功能性标准
- [x] 组件可以正常从组件库拖入画布
- [x] 画布内组件可以自由拖拽移动
- [x] 网格吸附功能正常工作
- [x] 拖拽过程中组件位置实时更新
- [x] 拖拽结束后组件位置正确保存

### 技术性标准
- [x] 无JavaScript控制台错误
- [x] 事件监听器正确绑定和触发
- [x] 编辑模式状态正确控制
- [x] CSS样式不阻止用户交互
- [x] 数据接口返回格式正确

### 兼容性标准
- [x] 所有现有编辑页面拖拽功能正常
- [x] 不影响其他编辑器功能(缩放、旋转、删除等)
- [x] 浏览器兼容性符合要求

## 风险评估

### 高风险项
- **拖拽事件绑定失效**: 可能导致完全无法拖拽
- **编辑模式状态错误**: 可能锁定所有编辑功能
- **CSS样式冲突**: 可能阻止用户交互

### 中风险项
- **数据兼容性问题**: 可能影响部分历史页面
- **性能回归**: 可能影响编辑器响应速度

### 低风险项
- **浏览器兼容性**: 可能在特定浏览器版本下表现异常

## 测试执行计划

### 阶段1: 问题复现和基础验证 (30分钟)
1. 登录系统，进入可视化大屏管理
2. 打开编辑页面，验证当前拖拽功能状态
3. 使用开发者工具检查事件绑定和CSS状态

### 阶段2: 根因分析 (60分钟)
1. 逐项检查各技术组件状态
2. 对比正常和异常状态的差异
3. 定位具体失效点

### 阶段3: 修复验证 (45分钟)
1. 应用修复方案
2. 逐项验证功能恢复情况
3. 执行回归测试

### 阶段4: 全面测试 (30分钟)
1. 测试多个页面和场景
2. 验证边界条件和异常情况
3. 确认整体功能稳定性

## 预期交付物
1. 问题根因分析报告
2. 修复方案验证结果
3. 回归测试通过报告
4. 技术改进建议

---
*文档创建时间: 2025-10-09*
*状态: 测试计划已制定，待执行*
*优先级: 高 - 影响核心编辑功能*