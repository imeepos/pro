# å¾®åšçˆ¬å–æ ¸å¿ƒé›†æˆæµ‹è¯•

è¿™æ˜¯å¾®åšçˆ¬å–ç³»ç»Ÿçš„æ ¸å¿ƒé›†æˆæµ‹è¯•å¥—ä»¶ï¼ŒåŒ…å«äº†5ä¸ªå…³é”®åŠŸèƒ½çš„æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ•°æ®è´¨é‡ã€‚

## ğŸ“‹ æµ‹è¯•å¥—ä»¶æ¦‚è§ˆ

### æ ¸å¿ƒæµ‹è¯•ç±»åˆ«

1. **å¾®åšæœç´¢çˆ¬å–é›†æˆæµ‹è¯•** (`weibo-search-crawler.integration.test.ts`)
   - å…³é”®è¯æœç´¢åŠŸèƒ½æµ‹è¯•
   - æ—¶é—´èŒƒå›´è¿‡æ»¤æµ‹è¯•
   - æœç´¢ç»“æœåˆ†é¡µæµ‹è¯•
   - æœç´¢æ•°æ®å®Œæ•´æ€§éªŒè¯
   - åçˆ¬è™«æœºåˆ¶ç»•è¿‡æµ‹è¯•

2. **å¾®åšè¯¦æƒ…çˆ¬å–é›†æˆæµ‹è¯•** (`weibo-detail-crawler.integration.test.ts`)
   - å•æ¡å¾®åšè¯¦æƒ…çˆ¬å–
   - è¯„è®ºæ•°æ®çˆ¬å–
   - ç”¨æˆ·ä¿¡æ¯çˆ¬å–
   - åª’ä½“æ–‡ä»¶ä¸‹è½½æµ‹è¯•
   - æ•°æ®å…³è”æ€§éªŒè¯

3. **è´¦å·ç®¡ç†å’Œè½®æ¢é›†æˆæµ‹è¯•** (`account-rotation.integration.test.ts`)
   - è´¦å·æ± ç®¡ç†æµ‹è¯•
   - è´¦å·å¥åº·åº¦æ£€æµ‹
   - æ™ºèƒ½è´¦å·åˆ‡æ¢
   - Cookieç®¡ç†æµ‹è¯•
   - è´¦å·æ¢å¤æœºåˆ¶

4. **æµè§ˆå™¨ç®¡ç†é›†æˆæµ‹è¯•** (`browser-management.integration.test.ts`)
   - æµè§ˆå™¨å®ä¾‹ç®¡ç†
   - é¡µé¢åŠ è½½æ€§èƒ½æµ‹è¯•
   - èµ„æºæ‹¦æˆªå’Œä¼˜åŒ–
   - æµè§ˆå™¨å¼‚å¸¸å¤„ç†
   - å¹¶å‘æµè§ˆå™¨ç®¡ç†

5. **æ•°æ®è´¨é‡éªŒè¯é›†æˆæµ‹è¯•** (`data-quality-validation.integration.test.ts`)
   - çˆ¬å–æ•°æ®å‡†ç¡®æ€§éªŒè¯
   - æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
   - æ•°æ®æ ¼å¼æ ‡å‡†åŒ–æµ‹è¯•
   - é‡å¤æ•°æ®æ£€æµ‹
   - æ•°æ®ä¸€è‡´æ€§éªŒè¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ä½¿ç”¨Jestè¿è¡Œæ‰€æœ‰æ ¸å¿ƒæµ‹è¯•
npm test -- test/integration/core

# æˆ–ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨
ts-node test/integration/core/run-core-tests.ts

# è¯¦ç»†æ¨¡å¼è¿è¡Œ
ts-node test/integration/core/run-core-tests.ts -v
```

### è¿è¡Œç‰¹å®šç±»åˆ«çš„æµ‹è¯•

```bash
# åªè¿è¡Œæœç´¢çˆ¬å–æµ‹è¯•
ts-node test/integration/core/run-core-tests.ts -c search

# åªè¿è¡Œè´¦å·ç®¡ç†æµ‹è¯•
ts-node test/integration/core/run-core-tests.ts -c account

# åªè¿è¡Œæ•°æ®è´¨é‡æµ‹è¯•
ts-node test/integration/core/run-core-tests.ts -c quality
```

### å¹¶è¡Œæ‰§è¡Œæµ‹è¯•

```bash
# å¹¶è¡Œè¿è¡Œæ‰€æœ‰æµ‹è¯•
ts-node test/integration/core/run-core-tests.ts -p

# å¹¶è¡Œè¿è¡Œç‰¹å®šç±»åˆ«
ts-node test/integration/core/run-core-tests.ts -c search -p
```

### è‡ªå®šä¹‰è¶…æ—¶è®¾ç½®

```bash
# è®¾ç½®60ç§’è¶…æ—¶
ts-node test/integration/core/run-core-tests.ts -t 60000

# ç»“åˆå…¶ä»–é€‰é¡¹
ts-node test/integration/core/run-core-tests.ts -v -p -t 120000
```

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®æµ‹è¯•ç¯å¢ƒ
export NODE_ENV=test

# å¯ç”¨è¯¦ç»†æ—¥å¿—
export DEBUG=weibo-crawler:*

# è®¾ç½®æ•°æ®åº“é…ç½®
export TEST_DB_URL=sqlite::memory:

# è®¾ç½®æµ‹è¯•è¶…æ—¶
export JEST_TIMEOUT=60000
```

### é…ç½®æ–‡ä»¶

æµ‹è¯•é…ç½®ä½äº `core-test.config.ts`ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®é¡¹ï¼š

- **è¶…æ—¶é…ç½®**: æ§åˆ¶æµ‹è¯•æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´
- **é‡è¯•é…ç½®**: å¤±è´¥é‡è¯•çš„ç­–ç•¥
- **Mockæ•°æ®é…ç½®**: æµ‹è¯•æ•°æ®ç”Ÿæˆçš„å‚æ•°
- **æ€§èƒ½åŸºå‡†**: æ€§èƒ½æµ‹è¯•çš„åŸºå‡†å€¼
- **è´¨é‡é˜ˆå€¼**: æ•°æ®è´¨é‡éªŒè¯çš„æ ‡å‡†

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š

æµ‹è¯•æ‰§è¡Œåä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ ¼å¼çš„æŠ¥å‘Šï¼š

- **JSONæ ¼å¼**: æœºå™¨å¯è¯»çš„è¯¦ç»†æ•°æ®
- **HTMLæ ¼å¼**: å¯è§†åŒ–çš„æµ‹è¯•æŠ¥å‘Š
- **JUnitæ ¼å¼**: CI/CDé›†æˆçš„æ ‡å‡†æ ¼å¼

### è´¨é‡æŒ‡æ ‡

æ¯ä¸ªæµ‹è¯•éƒ½ä¼šç”Ÿæˆè´¨é‡åˆ†æ•°ï¼š

- **å®Œæ•´æ€§åˆ†æ•°** (0-100%): å¿…è¦å­—æ®µçš„è¦†ç›–ç¨‹åº¦
- **å‡†ç¡®æ€§åˆ†æ•°** (0-100%): æ•°æ®æ ¼å¼çš„æ­£ç¡®æ€§
- **ä¸€è‡´æ€§åˆ†æ•°** (0-100%): æ•°æ®é—´çš„é€»è¾‘ä¸€è‡´æ€§
- **æ–°é²œåº¦åˆ†æ•°** (0-100%): æ•°æ®çš„æ—¶æ•ˆæ€§

### æ€§èƒ½æŒ‡æ ‡

- **é¡µé¢åŠ è½½æ—¶é—´**: ç›®æ ‡ < 5ç§’
- **å†…å­˜ä½¿ç”¨**: ç›‘æ§æµè§ˆå™¨å†…å­˜æ¶ˆè€—
- **å¹¶å‘å¤„ç†**: éªŒè¯å¤šä»»åŠ¡å¤„ç†èƒ½åŠ›
- **é”™è¯¯æ¢å¤**: æµ‹è¯•å¼‚å¸¸æƒ…å†µçš„å¤„ç†

## ğŸ”§ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹
2. ä½¿ç”¨ `describe` ç»„ç»‡ç›¸å…³çš„æµ‹è¯•
3. éµå¾ªå‘½åçº¦å®šï¼š`åº”è¯¥èƒ½å¤Ÿ...`
4. æ·»åŠ é€‚å½“çš„æ–­è¨€å’Œé”™è¯¯å¤„ç†
5. æ›´æ–°é…ç½®æ–‡ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰

```typescript
describe('æ–°åŠŸèƒ½æµ‹è¯•', () => {
  it('åº”è¯¥èƒ½å¤Ÿæ‰§è¡Œæ–°åŠŸèƒ½', async () => {
    // å‡†å¤‡æµ‹è¯•æ•°æ®
    const testData = createTestData();

    // æ‰§è¡Œæµ‹è¯•
    const result = await serviceUnderTest.execute(testData);

    // éªŒè¯ç»“æœ
    expect(result).toBeDefined();
    expect(result.status).toBe('success');
  });
});
```

### Mockæ•°æ®ä½¿ç”¨

æµ‹è¯•ä½¿ç”¨é¢„å®šä¹‰çš„Mockæ•°æ®ï¼š

```typescript
// ä½¿ç”¨æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
const mockResults = TestDataGenerator.generateWeiboSearchResult(3);

// ä½¿ç”¨Mockå“åº”ç”Ÿæˆå™¨
const mockResponse = mockGenerator.generateWeiboSearchTask({
  keyword: 'æµ‹è¯•å…³é”®è¯',
  status: WeiboSearchTaskStatus.ACTIVE
});
```

### è°ƒè¯•æµ‹è¯•

```bash
# å¯ç”¨è°ƒè¯•æ¨¡å¼
DEBUG=weibo-crawler:* npm test

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
npm test -- test/integration/core/weibo-search-crawler.integration.test.ts

# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
npm test -- --testNamePattern="åº”è¯¥èƒ½å¤Ÿæ‰§è¡ŒåŸºæœ¬çš„å…³é”®è¯æœç´¢"
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### é¢„æœŸæ‰§è¡Œæ—¶é—´

- **æœç´¢çˆ¬å–æµ‹è¯•**: ~45ç§’
- **è¯¦æƒ…çˆ¬å–æµ‹è¯•**: ~60ç§’
- **è´¦å·ç®¡ç†æµ‹è¯•**: ~30ç§’
- **æµè§ˆå™¨ç®¡ç†æµ‹è¯•**: ~40ç§’
- **æ•°æ®è´¨é‡æµ‹è¯•**: ~35ç§’
- **æ€»è®¡**: ~3.5åˆ†é’Ÿ

### èµ„æºè¦æ±‚

- **å†…å­˜**: æœ€å°‘512MBï¼Œæ¨è1GB
- **ç£ç›˜**: æœ€å°‘100MBä¸´æ—¶ç©ºé—´
- **ç½‘ç»œ**: å¯é€‰ï¼ˆä¸»è¦ä½¿ç”¨Mockæ•°æ®ï¼‰
- **CPU**: 2æ ¸å¿ƒä»¥ä¸Š

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•è¶…æ—¶**
   ```bash
   # å¢åŠ è¶…æ—¶æ—¶é—´
   ts-node run-core-tests.ts -t 120000
   ```

2. **å†…å­˜ä¸è¶³**
   ```bash
   # å¢åŠ Node.jså†…å­˜é™åˆ¶
   node --max-old-space-size=4096 node_modules/.bin/jest
   ```

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“é…ç½®
   export TEST_DB_URL=sqlite::memory:
   ```

4. **Mockæ•°æ®ä¸åŒ¹é…**
   ```bash
   # é‡æ–°ç”ŸæˆMockæ•°æ®
   npm run test:generate-mocks
   ```

### è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹æ‰€æœ‰é€‰é¡¹
ts-node run-core-tests.ts --help

# æŸ¥çœ‹æµ‹è¯•å¥—ä»¶ä¿¡æ¯
ts-node -e "
import { createTestRunner } from './index';
const runner = createTestRunner();
console.log(JSON.stringify(runner.getSuiteInfo(), null, 2));
"
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŒ…å«5ä¸ªæ ¸å¿ƒæµ‹è¯•ç±»åˆ«
- æ”¯æŒå¹¶è¡Œå’Œä¸²è¡Œæ‰§è¡Œ
- å®Œæ•´çš„é…ç½®ç³»ç»Ÿ
- è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹
4. ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§ [LICENSE](../../../LICENSE) æ–‡ä»¶ã€‚

---

**æ³¨æ„**: è¿™äº›æµ‹è¯•è®¾è®¡ä¸ºåœ¨å—æ§ç¯å¢ƒä¸­è¿è¡Œï¼Œä½¿ç”¨Mockæ•°æ®é¿å…å¯¹çœŸå®ç³»ç»Ÿé€ æˆå½±å“ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿å……åˆ†ç†è§£æµ‹è¯•çš„è¡Œä¸ºå’Œå½±å“ã€‚