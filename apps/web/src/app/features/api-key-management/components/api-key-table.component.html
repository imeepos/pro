<div class="w-full">
  <!-- è¡¨æ ¼å¤´éƒ¨ -->
  <div class="px-6 py-4 border-b border-slate-200">
    <div class="flex justify-between items-center">
      <h2 class="text-xl font-semibold text-slate-800">API Keys</h2>
      <div class="text-sm text-slate-500">
        {{ getDisplayRange() }}
      </div>
    </div>
  </div>

  <!-- è¡¨æ ¼å†…å®¹ -->
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            åç§°
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            API Key
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            ç±»å‹
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            çŠ¶æ€
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            ä½¿ç”¨æ¬¡æ•°
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            æœ€åä½¿ç”¨
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            è¿‡æœŸæ—¶é—´
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            æ“ä½œ
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-slate-200">
        <!-- ç©ºçŠ¶æ€ -->
        <tr *ngIf="!loading && apiKeys.length === 0">
          <td colspan="8" class="px-6 py-12 text-center">
            <div class="flex flex-col items-center gap-4">
              <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center">
                <span class="text-2xl">ğŸ”‘</span>
              </div>
              <div>
                <h3 class="text-lg font-medium text-slate-900 mb-1">æš‚æ—  API Keys</h3>
                <p class="text-slate-500">åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ª API Key å¼€å§‹ä½¿ç”¨</p>
              </div>
            </div>
          </td>
        </tr>

        <!-- æ•°æ®è¡Œ -->
        <tr *ngFor="let apiKey of apiKeys; trackBy: trackByApiKeyId"
            class="hover:bg-slate-50 transition-colors duration-150"
            [class.bg-blue-50]="isApiKeySelected(apiKey)">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex flex-col">
              <div class="text-sm font-medium text-slate-900">
                {{ apiKey.name }}
              </div>
              <div class="text-xs text-slate-500 truncate max-w-[200px]" [title]="apiKey.description">
                {{ apiKey.description || '-' }}
              </div>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center gap-2">
              <code class="text-xs bg-slate-100 px-2 py-1 rounded font-mono">
                {{ getDisplayedApiKey(apiKey) }}
              </code>
              <button class="text-slate-400 hover:text-slate-600 transition-colors"
                      (click)="toggleApiKeyVisibility(apiKey)"
                      title="æ˜¾ç¤º/éšè—å®Œæ•´ API Key">
                <span class="text-sm">{{ showFullApiKey.get(apiKey.id) ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}</span>
              </button>
              <button class="text-slate-400 hover:text-slate-600 transition-colors"
                      (click)="copyApiKey.emit(apiKey)"
                      title="å¤åˆ¶ API Key">
                <span class="text-sm">ğŸ“‹</span>
              </button>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border {{ getTypeBadgeClass(apiKey.type) }}">
              {{ getTypeText(apiKey.type) }}
            </span>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex flex-col gap-1">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border {{ getStatusBadgeClass(apiKey.status) }}">
                {{ getStatusText(apiKey.status) }}
              </span>
              <span *ngIf="isExpiringSoon(apiKey.expiresAt)"
                    class="text-xs text-orange-600 font-medium">
                âš ï¸ å³å°†è¿‡æœŸ
              </span>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">
            <div class="flex flex-col">
              <span class="font-medium">{{ apiKey.usageCount.toLocaleString() }}</span>
              <span class="text-xs text-slate-500">æ¬¡è°ƒç”¨</span>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-slate-900">
              <div>{{ formatRelativeTime(apiKey.lastUsedAt) }}</div>
              <div class="text-xs text-slate-500">{{ formatDate(apiKey.lastUsedAt) }}</div>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-slate-900">
              <div *ngIf="apiKey.expiresAt">
                <div [class.text-red-600]="apiKey.isExpired" [class.text-orange-600]="isExpiringSoon(apiKey.expiresAt)">
                  {{ formatDate(apiKey.expiresAt) }}
                </div>
                <div class="text-xs"
                     [class.text-red-500]="apiKey.isExpired"
                     [class.text-orange-500]="isExpiringSoon(apiKey.expiresAt)">
                  {{ apiKey.isExpired ? 'å·²è¿‡æœŸ' : (isExpiringSoon(apiKey.expiresAt) ? 'å³å°†è¿‡æœŸ' : 'æ­£å¸¸') }}
                </div>
              </div>
              <div *ngIf="!apiKey.expiresAt" class="text-slate-500">
                æ°¸ä¸è¿‡æœŸ
              </div>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center gap-2">
              <!-- æŸ¥çœ‹ç»Ÿè®¡ -->
              <button class="p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded transition-all duration-150"
                      (click)="viewStats.emit(apiKey)"
                      title="æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡">
                <span class="text-sm">ğŸ“Š</span>
              </button>

              <!-- ç¼–è¾‘ -->
              <button class="p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded transition-all duration-150"
                      [disabled]="isActionDisabled(apiKey, 'edit')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'edit')"
                      (click)="editApiKey.emit(apiKey)"
                      title="ç¼–è¾‘">
                <span class="text-sm">âœï¸</span>
              </button>

              <!-- åˆ‡æ¢çŠ¶æ€ -->
              <button class="p-1.5 text-white rounded transition-all duration-150 text-xs px-2 py-1"
                      [class]="getToggleStatusClass(apiKey)"
                      [disabled]="isActionDisabled(apiKey, 'toggle')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'toggle')"
                      (click)="toggleStatus.emit(apiKey)"
                      [title]="getToggleStatusText(apiKey)">
                {{ getToggleStatusText(apiKey) }}
              </button>

              <!-- é‡æ–°ç”Ÿæˆ -->
              <button class="p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded transition-all duration-150"
                      [disabled]="isActionDisabled(apiKey, 'regenerate')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'regenerate')"
                      (click)="regenerateApiKey.emit(apiKey)"
                      title="é‡æ–°ç”Ÿæˆ">
                <span class="text-sm">ğŸ”„</span>
              </button>

              <!-- åˆ é™¤ -->
              <button class="p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-all duration-150"
                      [disabled]="isActionDisabled(apiKey, 'delete')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'delete')"
                      (click)="deleteApiKey.emit(apiKey)"
                      title="åˆ é™¤">
                <span class="text-sm">ğŸ—‘ï¸</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- åˆ†é¡µæ§ä»¶ -->
  <div class="px-6 py-4 border-t border-slate-200 bg-slate-50" *ngIf="totalPages > 1">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <!-- æ¯é¡µæ˜¾ç¤ºæ•°é‡ -->
        <div class="flex items-center gap-2">
          <label class="text-sm text-slate-600">æ¯é¡µæ˜¾ç¤º:</label>
          <select class="text-sm border border-slate-300 rounded px-2 py-1 bg-white"
                  [value]="pageSize"
                  (change)="onPageSizeChange($any($event.target).value)">
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
            <option [ngValue]="50">50</option>
            <option [ngValue]="100">100</option>
          </select>
        </div>
      </div>

      <!-- åˆ†é¡µæŒ‰é’® -->
      <div class="flex items-center gap-1">
        <!-- ä¸Šä¸€é¡µ -->
        <button class="px-3 py-1 text-sm border border-slate-300 rounded hover:bg-white transition-colors duration-150"
                [disabled]="currentPage === 1"
                [class.opacity-50]="currentPage === 1"
                (click)="onPrevPage()">
          ä¸Šä¸€é¡µ
        </button>

        <!-- é¡µç  -->
        <button *ngFor="let page of pageNumbers; trackBy: trackByPage"
                class="px-3 py-1 text-sm border rounded transition-colors duration-150"
                [class]="{
                  'bg-primary text-white border-primary': page === currentPage,
                  'border-slate-300 hover:bg-white': page !== currentPage && page !== -1,
                  'px-2 border-0 cursor-default': page === -1
                }"
                [disabled]="page === -1"
                (click)="page !== -1 && onGoToPage(page)">
          {{ page === -1 ? '...' : page }}
        </button>

        <!-- ä¸‹ä¸€é¡µ -->
        <button class="px-3 py-1 text-sm border border-slate-300 rounded hover:bg-white transition-colors duration-150"
                [disabled]="currentPage === totalPages"
                [class.opacity-50]="currentPage === totalPages"
                (click)="onNextPage()">
          ä¸‹ä¸€é¡µ
        </button>
      </div>
    </div>
  </div>
</div>