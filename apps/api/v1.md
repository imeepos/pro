# èˆ†æƒ…å¤§å±å¹•ç³»ç»Ÿåç«¯ API V1 ç‰ˆæœ¬è§„åˆ’

## æ¦‚è¿°
ä¸ºèˆ†æƒ…å¤§å±å¹•ç³»ç»Ÿæä¾›åç«¯ API æ”¯æŒï¼ŒåŒ…æ‹¬é¡µé¢ç®¡ç†ã€èˆ†æƒ…æ•°æ®æŸ¥è¯¢ã€å®æ—¶æ•°æ®æ¨é€ã€å†å²æ•°æ®å›æ”¾ç­‰åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆï¼ˆå·²ç¡®è®¤ï¼‰âœ…
- åç«¯æ¡†æ¶: NestJS + TypeScript
- æ•°æ®åº“:
  - **MongoDB**: å­˜å‚¨çˆ¬å–çš„åŸå§‹æ•°æ®ï¼ˆåŸå§‹ HTMLã€æœªæ¸…æ´—æ•°æ®ï¼‰
  - **PostgreSQL**: å­˜å‚¨æ¸…æ´—åçš„ç»“æ„åŒ–æ•°æ®ï¼ˆèˆ†æƒ…åˆ†æç»“æœã€é¡µé¢é…ç½®ï¼‰
- ORM: **TypeORM** (PostgreSQL) + **Mongoose** (MongoDB)
- ç¼“å­˜: Redis (çƒ­ç‚¹æ•°æ®ç¼“å­˜ã€Session å­˜å‚¨)
- å®æ—¶é€šä¿¡: WebSocket (ä½¿ç”¨ @nestjs/websockets)
- æ–‡ä»¶å­˜å‚¨: **MinIO** (å¯¼å‡ºæ–‡ä»¶ã€å›¾ç‰‡ã€é™„ä»¶)
- æ¶ˆæ¯é˜Ÿåˆ—: **RabbitMQ** (æ•°æ®é‡‡é›†ä»»åŠ¡ã€æ•°æ®å¤„ç†ç®¡é“)
- æ•°æ®é‡‡é›†: **è‡ªå®šä¹‰çˆ¬è™«** (åŸºäº Puppeteer / Cheerio)

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. é¡µé¢ç®¡ç†æ¨¡å— (Pages Module)
ç®¡ç†å¤§å±é¡µé¢é…ç½®ï¼Œæ”¯æŒ CRUDã€å¤åˆ¶ã€è®¾ç½®é»˜è®¤é¡µé¢ç­‰æ“ä½œã€‚

#### æ•°æ®æ¨¡å‹
```typescript
// page.entity.ts
export interface Page {
  id: string;                    // UUID
  name: string;                  // é¡µé¢åç§°
  description?: string;          // é¡µé¢æè¿°
  screenSize: '1920x1080' | '4K' | 'ultrawide' | 'custom';
  customSize?: {
    width: number;
    height: number;
  };
  isDefault: boolean;            // æ˜¯å¦é»˜è®¤é¡µé¢
  createdAt: Date;
  updatedAt: Date;
  config: PageConfig;            // é¡µé¢é…ç½®ï¼ˆJSON å­˜å‚¨ï¼‰
}

export interface PageConfig {
  grid: {
    columns: number;             // ç½‘æ ¼åˆ—æ•°
    rows: number;                // ç½‘æ ¼è¡Œæ•°
  };
  components: ComponentInstance[];
}

export interface ComponentInstance {
  id: string;
  componentType: string;         // ç»„ä»¶ç±»å‹
  position: { x: number; y: number };
  size: { w: number; h: number };
  zIndex?: number;
}
```

#### API æ¥å£
```typescript
// è·å–é¡µé¢åˆ—è¡¨
GET /api/pages
Response: Page[]

// è·å–å•ä¸ªé¡µé¢
GET /api/pages/:id
Response: Page

// åˆ›å»ºé¡µé¢
POST /api/pages
Body: {
  name: string;
  description?: string;
  screenSize: string;
  customSize?: { width: number; height: number };
  config: PageConfig;
}
Response: Page

// æ›´æ–°é¡µé¢
PUT /api/pages/:id
Body: Partial<Page>
Response: Page

// åˆ é™¤é¡µé¢
DELETE /api/pages/:id
Response: { success: boolean }

// å¤åˆ¶é¡µé¢
POST /api/pages/:id/duplicate
Body: { newName: string }
Response: Page

// è®¾ç½®é»˜è®¤é¡µé¢
POST /api/pages/:id/set-default
Response: { success: boolean }
```

---

### 2. èˆ†æƒ…æ•°æ®æ¨¡å— (Sentiment Module)

#### 2.1 å®æ—¶ç»Ÿè®¡æ•°æ®
æä¾›å½“å‰æ—¶åˆ»çš„å…³é”®æŒ‡æ ‡æ•°æ®ã€‚

```typescript
GET /api/sentiment/statistics
Response: {
  totalCount: number;          // æ€»èˆ†æƒ…æ•°
  todayCount: number;          // ä»Šæ—¥æ–°å¢
  positiveCount: number;       // æ­£é¢èˆ†æƒ…
  neutralCount: number;        // ä¸­æ€§èˆ†æƒ…
  negativeCount: number;       // è´Ÿé¢èˆ†æƒ…
  growthRate: number;          // å¢é•¿ç‡ (%)
  hotTopicsCount: number;      // çƒ­ç‚¹è¯é¢˜æ•°
  alertCount: number;          // é¢„è­¦æ•°é‡
}
```

#### 2.2 è¶‹åŠ¿æ•°æ®
æä¾›æ—¶é—´åºåˆ—è¶‹åŠ¿æ•°æ®ã€‚

```typescript
GET /api/sentiment/trend
Query: {
  timeRange: 'hour' | 'day' | 'week' | 'month';
  startTime?: string;         // ISO 8601 æ ¼å¼
  endTime?: string;
}
Response: {
  timestamps: string[];       // æ—¶é—´æˆ³æ•°ç»„
  positive: number[];
  neutral: number[];
  negative: number[];
  total: number[];
}
```

#### 2.3 åˆ†ç±»åˆ†å¸ƒæ•°æ®ï¼ˆé¥¼å›¾ï¼‰
```typescript
GET /api/sentiment/category-distribution
Response: {
  categories: Array<{
    name: string;             // åˆ†ç±»åç§°
    value: number;            // æ•°é‡
    percentage: number;       // ç™¾åˆ†æ¯”
  }>;
}
```

#### 2.4 çƒ­ç‚¹è¯é¢˜æ’è¡Œï¼ˆæŸ±çŠ¶å›¾ï¼‰
```typescript
GET /api/sentiment/hot-topics
Query: {
  limit?: number;             // é»˜è®¤ 10
}
Response: {
  topics: Array<{
    name: string;             // è¯é¢˜åç§°
    count: number;            // è®¨è®ºæ•°
    sentiment: 'positive' | 'neutral' | 'negative';
    trend: 'up' | 'down' | 'stable';
  }>;
}
```

#### 2.5 åœ°ç†åˆ†å¸ƒæ•°æ®ï¼ˆåœ°å›¾ï¼‰
```typescript
GET /api/sentiment/geo-distribution
Response: {
  regions: Array<{
    province: string;         // çœä»½
    city?: string;            // åŸå¸‚
    count: number;            // èˆ†æƒ…æ•°é‡
    sentiment: {
      positive: number;
      neutral: number;
      negative: number;
    };
    coordinates: [number, number];  // ç»çº¬åº¦
  }>;
}
```

#### 2.6 è¯äº‘æ•°æ®
```typescript
GET /api/sentiment/word-cloud
Query: {
  limit?: number;             // é»˜è®¤ 100
}
Response: {
  words: Array<{
    text: string;
    value: number;            // è¯é¢‘
    sentiment?: 'positive' | 'neutral' | 'negative';
  }>;
}
```

#### 2.7 èˆ†æƒ…åˆ—è¡¨ï¼ˆæ»šåŠ¨åˆ—è¡¨ï¼‰
```typescript
GET /api/sentiment/news
Query: {
  page?: number;
  pageSize?: number;
  sentiment?: 'positive' | 'neutral' | 'negative';
  keyword?: string;
  startTime?: string;
  endTime?: string;
}
Response: {
  total: number;
  page: number;
  pageSize: number;
  items: Array<{
    id: string;
    title: string;
    content: string;
    source: string;           // æ¥æº
    author?: string;
    publishTime: string;
    sentiment: 'positive' | 'neutral' | 'negative';
    sentimentScore: number;   // æƒ…æ„Ÿå¾—åˆ† [-1, 1]
    tags: string[];
    readCount?: number;
    commentCount?: number;
    shareCount?: number;
  }>;
}
```

#### 2.8 é¢„è­¦ä¿¡æ¯
```typescript
GET /api/sentiment/alerts
Query: {
  severity?: 'high' | 'medium' | 'low';
  isResolved?: boolean;
}
Response: {
  alerts: Array<{
    id: string;
    title: string;
    description: string;
    severity: 'high' | 'medium' | 'low';
    timestamp: string;
    isResolved: boolean;
    relatedNewsIds: string[];
  }>;
}
```

#### 2.9 åª’ä½“æ¥æºåˆ†å¸ƒ
```typescript
GET /api/sentiment/source-distribution
Response: {
  sources: Array<{
    name: string;             // åª’ä½“åç§°
    count: number;            // æ•°é‡
    percentage: number;
  }>;
}
```

---

### 3. å†å²æ•°æ®æ¨¡å— (History Module)
æ”¯æŒå†å²æ•°æ®æŸ¥è¯¢å’Œå›æ”¾åŠŸèƒ½ã€‚

#### 3.1 è·å–å†å²å¿«ç…§
```typescript
GET /api/history/snapshots
Query: {
  startTime: string;          // ISO 8601
  endTime: string;
  interval?: number;          // é‡‡æ ·é—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 300
}
Response: {
  snapshots: Array<{
    timestamp: string;
    statistics: any;          // ç»Ÿè®¡æ•°æ®å¿«ç…§
    charts: any;              // å›¾è¡¨æ•°æ®å¿«ç…§
    news: any[];              // æ–°é—»åˆ—è¡¨å¿«ç…§
    alerts: any[];            // é¢„è­¦ä¿¡æ¯å¿«ç…§
  }>;
}
```

#### 3.2 è·å–å…³é”®äº‹ä»¶
```typescript
GET /api/history/events
Query: {
  startTime: string;
  endTime: string;
}
Response: {
  events: Array<{
    id: string;
    timestamp: string;
    type: string;
    description: string;
    severity: 'high' | 'medium' | 'low';
    relatedData: any;
  }>;
}
```

---

### 4. å¯¼å‡ºæ¨¡å— (Export Module)

#### 4.1 å¯¼å‡º Excel æ•°æ®
```typescript
POST /api/export/excel
Body: {
  startTime: string;
  endTime: string;
  filters?: {
    sentiment?: string;
    source?: string;
    keyword?: string;
  };
  includeCharts?: boolean;    // æ˜¯å¦åŒ…å«å›¾è¡¨æ•°æ®
}
Response: {
  downloadUrl: string;        // æ–‡ä»¶ä¸‹è½½é“¾æ¥
  fileSize: number;
  expiresAt: string;          // è¿‡æœŸæ—¶é—´
}
```

#### 4.2 å¯¼å‡º PDF æŠ¥å‘Š
```typescript
POST /api/export/pdf
Body: {
  pageId: string;             // å¤§å±é¡µé¢ ID
  includeScreenshot?: boolean;
  timeRange?: {
    startTime: string;
    endTime: string;
  };
}
Response: {
  downloadUrl: string;
  fileSize: number;
  expiresAt: string;
}
```

---

### 5. WebSocket å®æ—¶æ¨é€æ¨¡å—

#### è¿æ¥ç«¯ç‚¹
```
ws://xxx:3000/ws
```

#### æ¶ˆæ¯æ ¼å¼
```typescript
// å®¢æˆ·ç«¯è®¢é˜…
{
  action: 'subscribe',
  channels: ['statistics', 'news', 'alerts']
}

// æœåŠ¡ç«¯æ¨é€
{
  channel: 'statistics',
  data: {
    // ç»Ÿè®¡æ•°æ®
  },
  timestamp: string
}

{
  channel: 'news',
  data: {
    // æ–°èˆ†æƒ…æ•°æ®
  }
}

{
  channel: 'alerts',
  data: {
    // æ–°é¢„è­¦ä¿¡æ¯
  }
}
```

#### æ”¯æŒçš„é¢‘é“
- `statistics`: å®æ—¶ç»Ÿè®¡æ•°æ®æ›´æ–°
- `news`: æ–°èˆ†æƒ…æ•°æ®æ¨é€
- `alerts`: é¢„è­¦ä¿¡æ¯æ¨é€
- `trend`: è¶‹åŠ¿æ•°æ®æ›´æ–°
- `hot-topics`: çƒ­ç‚¹è¯é¢˜æ›´æ–°

---

## æ•°æ®åº“è®¾è®¡ï¼ˆå·²ç¡®è®¤ï¼‰âœ…

### æ··åˆæ•°æ®åº“æ¶æ„
```
çˆ¬è™«é‡‡é›† â†’ MongoDB (åŸå§‹æ•°æ®) â†’ æ•°æ®æ¸…æ´— â†’ PostgreSQL (ç»“æ„åŒ–æ•°æ®) â†’ API æŸ¥è¯¢
```

### æ•°æ®æµè½¬è¯´æ˜
1. **MongoDBï¼ˆåŸå§‹æ•°æ®å±‚ï¼‰**
   - å­˜å‚¨çˆ¬è™«æŠ“å–çš„åŸå§‹ HTML
   - å­˜å‚¨æœªæ¸…æ´—çš„èˆ†æƒ…æ•°æ®
   - ä½œä¸ºæ•°æ®æ¹–ï¼Œä¿ç•™å®Œæ•´æ•°æ®
   - æ”¯æŒæ•°æ®å›æº¯å’Œé‡æ–°å¤„ç†

2. **PostgreSQLï¼ˆä¸šåŠ¡æ•°æ®å±‚ï¼‰**
   - å­˜å‚¨æ¸…æ´—åçš„ç»“æ„åŒ–èˆ†æƒ…æ•°æ®
   - å­˜å‚¨é¡µé¢é…ç½®ã€ç”¨æˆ·è®¾ç½®
   - å­˜å‚¨é¢„è­¦ä¿¡æ¯ã€ç»Ÿè®¡ç»“æœ
   - æä¾›é«˜æ€§èƒ½æŸ¥è¯¢å’Œèšåˆ

### æ ¸å¿ƒè¡¨ç»“æ„ï¼ˆPostgreSQLï¼‰

#### pages è¡¨
```sql
CREATE TABLE pages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL,
  description TEXT,
  screen_size VARCHAR(50),
  custom_size JSONB,
  is_default BOOLEAN DEFAULT FALSE,
  config JSONB NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### sentiment_news è¡¨ï¼ˆPostgreSQL - æ¸…æ´—åçš„ç»“æ„åŒ–æ•°æ®ï¼‰
```sql
CREATE TABLE sentiment_news (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  raw_data_id VARCHAR(24),              -- MongoDB åŸå§‹æ•°æ® ObjectId
  title VARCHAR(500) NOT NULL,
  content TEXT NOT NULL,
  source VARCHAR(255) NOT NULL,
  author VARCHAR(255),
  publish_time TIMESTAMP NOT NULL,
  crawl_time TIMESTAMP NOT NULL,
  sentiment VARCHAR(20) NOT NULL,       -- 'positive' | 'neutral' | 'negative'
  sentiment_score DECIMAL(3,2),         -- -1.00 åˆ° 1.00
  tags TEXT[],                          -- PostgreSQL æ•°ç»„ç±»å‹
  province VARCHAR(50),
  city VARCHAR(50),
  coordinates POINT,                    -- PostgreSQL åœ°ç†ç±»å‹
  read_count INTEGER DEFAULT 0,
  comment_count INTEGER DEFAULT 0,
  share_count INTEGER DEFAULT 0,
  source_url TEXT NOT NULL,
  is_processed BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_sentiment_news_publish_time ON sentiment_news(publish_time DESC);
CREATE INDEX idx_sentiment_news_sentiment ON sentiment_news(sentiment);
CREATE INDEX idx_sentiment_news_source ON sentiment_news(source);
CREATE INDEX idx_sentiment_news_province ON sentiment_news(province);
```

### MongoDB Collectionsï¼ˆåŸå§‹æ•°æ®å±‚ï¼‰

#### raw_news_dataï¼ˆåŸå§‹çˆ¬è™«æ•°æ®ï¼‰
```typescript
// Mongoose Schema
{
  _id: ObjectId,
  sourceUrl: string,                    // æ¥æº URL
  sourceDomain: string,                 // æ¥æºåŸŸå
  crawlTime: Date,                      // çˆ¬å–æ—¶é—´
  rawHtml: string,                      // åŸå§‹ HTML
  httpStatus: number,                   // HTTP çŠ¶æ€ç 
  headers: Object,                      // HTTP å“åº”å¤´
  cookies: Object,                      // Cookies
  screenshot?: string,                  // æˆªå›¾æ–‡ä»¶è·¯å¾„ï¼ˆMinIOï¼‰

  // åˆæ­¥æå–çš„å­—æ®µï¼ˆæœªæ¸…æ´—ï¼‰
  extractedData: {
    title?: string,
    content?: string,
    author?: string,
    publishTime?: string,               // åŸå§‹æ—¶é—´å­—ç¬¦ä¸²
    tags?: string[],
    images?: string[],
    videos?: string[]
  },

  // çˆ¬è™«å…ƒæ•°æ®
  crawler: {
    name: string,                       // çˆ¬è™«åç§°
    version: string,
    taskId: string,                     // ä»»åŠ¡ ID
    retryCount: number
  },

  // å¤„ç†çŠ¶æ€
  processingStatus: 'pending' | 'processing' | 'completed' | 'failed',
  processedAt?: Date,
  processingError?: string,

  // å…³è”çš„ PostgreSQL è®°å½•
  sentimentNewsId?: string              // UUID
}
```

#### crawl_tasksï¼ˆçˆ¬è™«ä»»åŠ¡é˜Ÿåˆ—ï¼‰
```typescript
// Mongoose Schema
{
  _id: ObjectId,
  taskType: 'url' | 'keyword' | 'batch',
  priority: number,                     // ä¼˜å…ˆçº§ï¼ˆ1-10ï¼‰
  status: 'pending' | 'running' | 'completed' | 'failed',

  // ä»»åŠ¡é…ç½®
  config: {
    urls?: string[],                    // URL åˆ—è¡¨
    keywords?: string[],                // å…³é”®è¯åˆ—è¡¨
    searchEngine?: string,              // æœç´¢å¼•æ“
    maxPages?: number,                  // æœ€å¤§æŠ“å–é¡µæ•°
    depth?: number,                     // çˆ¬å–æ·±åº¦
    rateLimit?: number                  // é€Ÿç‡é™åˆ¶ï¼ˆè¯·æ±‚/ç§’ï¼‰
  },

  // ä»»åŠ¡ç»“æœ
  result: {
    totalUrls: number,
    successCount: number,
    failedCount: number,
    startTime?: Date,
    endTime?: Date,
    duration?: number,                  // è€—æ—¶ï¼ˆç§’ï¼‰
    errors?: Array<{
      url: string,
      error: string,
      timestamp: Date
    }>
  },

  createdAt: Date,
  updatedAt: Date
}
```

#### alerts è¡¨
```sql
CREATE TABLE alerts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  title VARCHAR(255) NOT NULL,
  description TEXT,
  severity VARCHAR(20) NOT NULL,
  is_resolved BOOLEAN DEFAULT FALSE,
  related_news_ids UUID[],
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  resolved_at TIMESTAMP
);
```

---

## æ•°æ®é‡‡é›†ä¸å¤„ç†ï¼ˆå·²ç¡®è®¤ï¼‰âœ…

### æ•°æ®å¤„ç†å…¨æµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ä»»åŠ¡åˆ›å»º  â”‚ â†’ ç”¨æˆ·/å®šæ—¶ä»»åŠ¡ åˆ›å»ºçˆ¬è™«ä»»åŠ¡
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ä»»åŠ¡é˜Ÿåˆ—  â”‚ â†’ RabbitMQ ç®¡ç†çˆ¬è™«ä»»åŠ¡é˜Ÿåˆ—
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. çˆ¬è™«é‡‡é›†  â”‚ â†’ Puppeteer/Cheerio æŠ“å–ç½‘é¡µ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   å­˜å‚¨åŸå§‹ HTML åˆ° MongoDB
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ•°æ®æå–  â”‚ â†’ ä» HTML ä¸­æå–æ ‡é¢˜/å†…å®¹/ä½œè€…ç­‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   åˆæ­¥ç»“æ„åŒ–ï¼ˆä»åœ¨ MongoDBï¼‰
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ•°æ®æ¸…æ´—  â”‚ â†’ å»é‡ã€æ ¼å¼åŒ–ã€è¿‡æ»¤æ— æ•ˆæ•°æ®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æƒ…æ„Ÿåˆ†æ  â”‚ â†’ NLP åˆ†ææƒ…æ„Ÿå€¾å‘
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   å…³é”®è¯æå–ã€åˆ†ç±»
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å…¥åº“ PG   â”‚ â†’ å°†æ¸…æ´—åçš„æ•°æ®å†™å…¥ PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. å®æ—¶æ¨é€  â”‚ â†’ WebSocket æ¨é€æ–°æ•°æ®åˆ°å‰ç«¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. çˆ¬è™«æ¨¡å— (Crawler Module) **ã€ç¬¬ä¸€æœŸï¼šå¾®åšã€‘**

#### æŠ€æœ¯æ–¹æ¡ˆï¼ˆå·²ç¡®è®¤ï¼‰âœ…
- **Playwright**: çˆ¬å–å¾®åšåŠ¨æ€ç½‘é¡µï¼ˆæ›¿ä»£ Puppeteerï¼Œæ€§èƒ½æ›´å¥½ï¼‰
- **ä»£ç†æ± **: æš‚ä¸ä½¿ç”¨ï¼ˆå…ˆæµ‹è¯•æ•ˆæœï¼Œå¦‚éœ€è¦å†æ·»åŠ ï¼‰
- **User-Agent è½®æ¢**: æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨
- **Cookie ç®¡ç†**: **å¿…éœ€**ï¼Œä½¿ç”¨ Playwright æ‰«ç ç™»å½•è·å– Cookie

#### å¾®åšçˆ¬è™«è¯¦ç»†æ–¹æ¡ˆ

##### å¾®åšæ•°æ®æ¥æºé€‰æ‹©
**æ–¹æ¡ˆ 1: å¾®åšçƒ­æœæ¦œï¼ˆæ¨èï¼Œç¬¬ä¸€æœŸï¼‰**
- URL: `https://s.weibo.com/top/summary`
- ä¼˜ç‚¹: æ— éœ€ç™»å½•ï¼Œåçˆ¬è¾ƒå¼±ï¼Œæ•°æ®é›†ä¸­
- å¯è·å–: çƒ­æœè¯é¢˜ã€çƒ­åº¦å€¼ã€åˆ†ç±»æ ‡ç­¾
- æ•°æ®é‡: 50æ¡/æ¬¡ï¼Œé€‚åˆå®æ—¶ç›‘æ§

**æ–¹æ¡ˆ 2: å¾®åšæœç´¢ï¼ˆç¬¬äºŒæœŸï¼‰**
- URL: `https://s.weibo.com/weibo?q={keyword}`
- éœ€è¦: Cookieï¼ˆå»ºè®®ç™»å½•ï¼‰
- å¯è·å–: æœç´¢ç»“æœã€å¾®åšå†…å®¹ã€è¯„è®ºæ•°ã€è½¬å‘æ•°
- æ•°æ®é‡: å¯é…ç½®ï¼Œé€‚åˆå…³é”®è¯ç›‘æ§

**æ–¹æ¡ˆ 3: å¾®åšç”¨æˆ·ä¸»é¡µï¼ˆç¬¬ä¸‰æœŸï¼‰**
- URL: `https://weibo.com/u/{uid}`
- éœ€è¦: ç™»å½• Cookie
- å¯è·å–: ç”¨æˆ·å¾®åšã€ç²‰ä¸æ•°ã€äº’åŠ¨æ•°æ®
- æ•°æ®é‡: å¤§ï¼Œé€‚åˆç‰¹å®šç”¨æˆ·ç›‘æ§

##### å¾®åšçƒ­æœçˆ¬è™«å®ç°ï¼ˆç¬¬ä¸€æœŸï¼‰**ã€ä½¿ç”¨ Playwrightã€‘**

```typescript
// weibo-hotrank.crawler.ts
import { Injectable, Logger } from '@nestjs/common';
import { chromium, Browser, Page } from 'playwright';

@Injectable()
export class WeiboHotRankCrawler {
  private readonly logger = new Logger(WeiboHotRankCrawler.name);
  private browser: Browser;

  async init() {
    this.browser = await chromium.launch({
      headless: true,
      args: [
        '--disable-blink-features=AutomationControlled',
      ]
    });
  }

  async crawlHotRank(): Promise<WeiboHotTopic[]> {
    const page = await this.browser.newPage();

    try {
      // è®¾ç½® User-Agent
      await page.setExtraHTTPHeaders({
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
      });

      // è®¿é—®çƒ­æœæ¦œ
      await page.goto('https://s.weibo.com/top/summary', {
        waitUntil: 'networkidle',
        timeout: 30000
      });

      // ç­‰å¾…çƒ­æœåˆ—è¡¨åŠ è½½
      await page.waitForSelector('#pl_top_realtimehot table tbody tr', { timeout: 10000 });

      // æå–çƒ­æœæ•°æ®
      const hotTopics = await page.evaluate(() => {
        const rows = document.querySelectorAll('#pl_top_realtimehot table tbody tr');
        const topics: any[] = [];

        rows.forEach((row, index) => {
          if (index === 0) return; // è·³è¿‡è¡¨å¤´

          const link = row.querySelector('td.td-02 a');
          const hotValue = row.querySelector('td.td-02 span');
          const icon = row.querySelector('td.td-03 i');

          if (link) {
            topics.push({
              rank: index,
              title: link.textContent?.trim() || '',
              url: 'https://s.weibo.com' + link.getAttribute('href'),
              hotValue: hotValue?.textContent?.trim() || '0',
              category: icon?.className || 'normal',
              crawlTime: new Date().toISOString()
            });
          }
        });

        return topics;
      });

      this.logger.log(`æˆåŠŸçˆ¬å– ${hotTopics.length} æ¡å¾®åšçƒ­æœ`);
      return hotTopics;

    } catch (error) {
      this.logger.error('å¾®åšçƒ­æœçˆ¬å–å¤±è´¥', error);
      throw error;
    } finally {
      await page.close();
    }
  }

  // çˆ¬å–çƒ­æœè¯é¢˜è¯¦æƒ…ï¼ˆç‚¹å‡»è¿›å…¥è¯é¢˜ï¼Œè·å–å¾®åšå†…å®¹ï¼‰
  async crawlTopicDetail(topicUrl: string): Promise<WeiboPost[]> {
    const page = await this.browser.newPage();

    try {
      await page.setExtraHTTPHeaders({
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
      });

      await page.goto(topicUrl, { waitUntil: 'networkidle', timeout: 30000 });
      await page.waitForSelector('.card-wrap', { timeout: 10000 });

      // æ¨¡æ‹Ÿæ»šåŠ¨åŠ è½½æ›´å¤š
      for (let i = 0; i < 3; i++) {
        await page.evaluate(() => window.scrollTo(0, document.body.scrollHeight));
        await page.waitForTimeout(2000);
      }

      // æå–å¾®åšå†…å®¹
      const posts = await page.evaluate(() => {
        const cards = document.querySelectorAll('.card-wrap');
        const result: any[] = [];

        cards.forEach((card) => {
          const contentEl = card.querySelector('.txt');
          const authorEl = card.querySelector('.name');
          const timeEl = card.querySelector('.from a');

          if (contentEl && authorEl) {
            result.push({
              content: contentEl.textContent?.trim() || '',
              author: authorEl.textContent?.trim() || '',
              publishTime: timeEl?.textContent?.trim() || '',
              repostCount: 0,  // éœ€è¦è¿›ä¸€æ­¥è§£æ
              commentCount: 0,
              likeCount: 0
            });
          }
        });

        return result;
      });

      this.logger.log(`æˆåŠŸçˆ¬å–è¯é¢˜ ${topicUrl} çš„ ${posts.length} æ¡å¾®åš`);
      return posts;

    } catch (error) {
      this.logger.error('å¾®åšè¯é¢˜è¯¦æƒ…çˆ¬å–å¤±è´¥', error);
      throw error;
    } finally {
      await page.close();
    }
  }

  async destroy() {
    if (this.browser) {
      await this.browser.close();
    }
  }
}

export interface WeiboHotTopic {
  rank: number;
  title: string;
  url: string;
  hotValue: string;
  category: string;
  crawlTime: string;
}

export interface WeiboPost {
  content: string;
  author: string;
  publishTime: string;
  repostCount: number;
  commentCount: number;
  likeCount: number;
}
```

##### å¾®åšåçˆ¬åº”å¯¹ç­–ç•¥ï¼ˆå·²ç¡®è®¤ï¼‰âœ…

**1. User-Agent è½®æ¢**
```typescript
const userAgents = [
  'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
  'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
  'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36'
];

// ä½¿ç”¨ Playwright è®¾ç½®
await page.setExtraHTTPHeaders({
  'User-Agent': userAgents[Math.floor(Math.random() * userAgents.length)]
});
```

**2. è¯·æ±‚é¢‘ç‡æ§åˆ¶**
```typescript
// æ¯æ¬¡è¯·æ±‚é—´éš” 3-5 ç§’ï¼ˆéšæœºï¼‰
const delay = Math.random() * 2000 + 3000;
await page.waitForTimeout(delay);
```

**3. éšè—è‡ªåŠ¨åŒ–ç‰¹å¾ï¼ˆPlaywright è‡ªå¸¦ï¼‰**
```typescript
// Playwright é»˜è®¤éšè—äº† webdriver ç‰¹å¾ï¼Œæ— éœ€é¢å¤–é…ç½®
// ä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š
await page.addInitScript(() => {
  // è¦†ç›– navigator.webdriver
  Object.defineProperty(navigator, 'webdriver', { get: () => false });

  // è¦†ç›– plugins
  Object.defineProperty(navigator, 'plugins', {
    get: () => [1, 2, 3, 4, 5]
  });
});
```

**4. ä»£ç†æ± ï¼ˆæš‚ä¸ä½¿ç”¨ï¼‰**
```typescript
// ç¬¬ä¸€æœŸæš‚ä¸ä½¿ç”¨ä»£ç†æ± ï¼Œå…ˆæµ‹è¯•æ•ˆæœ
// å¦‚éœ€è¦ï¼Œå¯åç»­æ·»åŠ ï¼š
// const browser = await chromium.launch({
//   proxy: {
//     server: 'http://proxy-server:port',
//     username: 'user',
//     password: 'pass'
//   }
// });
```

**5. Cookie ç®¡ç†ï¼ˆå¿…éœ€ï¼‰âœ…**
```typescript
// å¾®åšéœ€è¦ç™»å½•æ‰èƒ½çˆ¬å–æ•°æ®
// Cookie é€šè¿‡æ‰«ç ç™»å½•è·å–ï¼Œå¹¶æŒä¹…åŒ–å­˜å‚¨
const cookiePath = './cookies/weibo-cookies.json';

// åŠ è½½ä¿å­˜çš„ Cookie
if (fs.existsSync(cookiePath)) {
  const cookies = JSON.parse(fs.readFileSync(cookiePath, 'utf-8'));
  await context.addCookies(cookies);
}
```

##### å¾®åšæ•°æ®ç»“æ„

```typescript
// MongoDB Schema - å¾®åšåŸå§‹æ•°æ®
export interface WeiboRawData {
  _id: ObjectId;
  type: 'hotrank' | 'search' | 'user';  // æ•°æ®ç±»å‹

  // çƒ­æœæ¦œæ•°æ®
  hotRank?: {
    rank: number;
    title: string;
    url: string;
    hotValue: string;
    category: string;
  };

  // å¾®åšå†…å®¹
  post?: {
    content: string;
    author: string;
    authorUid?: string;
    publishTime: string;
    repostCount: number;
    commentCount: number;
    likeCount: number;
    images?: string[];
    videos?: string[];
  };

  sourceUrl: string;
  crawlTime: Date;
  rawHtml?: string;

  // å¤„ç†çŠ¶æ€
  processingStatus: 'pending' | 'processing' | 'completed' | 'failed';
  sentimentNewsId?: string;
}
```

#### çˆ¬è™«é…ç½®ï¼ˆå·²ç¡®è®¤ï¼‰âœ…
```typescript
// crawler.config.ts
export const weiboConfig = {
  // å¹¶å‘æ§åˆ¶
  concurrency: 2,                       // åŒæ—¶è¿è¡Œçš„çˆ¬è™«æ•°ï¼ˆå¾®åšå»ºè®®ä½å¹¶å‘ï¼‰
  requestDelay: 3000,                   // è¯·æ±‚é—´éš”ï¼ˆæ¯«ç§’ï¼‰

  // é‡è¯•ç­–ç•¥
  maxRetries: 3,
  retryDelay: 5000,

  // è¶…æ—¶è®¾ç½®
  timeout: 30000,

  // ä»£ç†é…ç½®
  useProxy: false,                      // âœ… ç¬¬ä¸€æœŸä¸ä½¿ç”¨ä»£ç†

  // Cookie é…ç½®
  useCookie: false,                     // âœ… ä¸ä½¿ç”¨ç™»å½•
  cookiePath: './cookies/weibo.json',

  // å®šæ—¶ä»»åŠ¡
  schedule: {
    hotRank: '*/10 * * * *',            // æ¯ 10 åˆ†é’Ÿçˆ¬å–çƒ­æœ
    topicDetail: '*/30 * * * * *'       // æ¯ 30 åˆ†é’Ÿçˆ¬å–è¯é¢˜è¯¦æƒ…
  }
};
```

#### çˆ¬è™«ä»»åŠ¡ç®¡ç†
```typescript
// crawler.service.ts
@Injectable()
export class CrawlerService {
  // åˆ›å»ºçˆ¬è™«ä»»åŠ¡
  async createTask(config: CrawlTaskConfig): Promise<CrawlTask>

  // æ‰§è¡Œå•ä¸ª URL çˆ¬å–
  async crawlUrl(url: string, parser: string): Promise<RawNewsData>

  // æ‰§è¡Œå…³é”®è¯æœç´¢çˆ¬å–
  async crawlByKeyword(keyword: string, searchEngine: string): Promise<RawNewsData[]>

  // æ‰¹é‡çˆ¬å–
  async crawlBatch(urls: string[]): Promise<void>

  // åœæ­¢ä»»åŠ¡
  async stopTask(taskId: string): Promise<void>
}
```

### 2. æ•°æ®æ¸…æ´—æ¨¡å— (Data Cleaning Module)

#### æ¸…æ´—ä»»åŠ¡
- å»é™¤ HTML æ ‡ç­¾å’Œæ— æ•ˆå­—ç¬¦
- ç»Ÿä¸€æ—¶é—´æ ¼å¼ï¼ˆISO 8601ï¼‰
- æå–åœ°ç†ä½ç½®ä¿¡æ¯ï¼ˆæ­£åˆ™åŒ¹é…çœå¸‚åï¼‰
- å»é‡ï¼ˆåŸºäºæ ‡é¢˜ç›¸ä¼¼åº¦æˆ– URLï¼‰
- è¿‡æ»¤åƒåœ¾å†…å®¹ï¼ˆå¹¿å‘Šã€æ— æ•ˆæ–‡æœ¬ï¼‰

```typescript
// data-cleaning.service.ts
@Injectable()
export class DataCleaningService {
  // æ¸…æ´—å•æ¡åŸå§‹æ•°æ®
  async cleanRawData(rawData: RawNewsData): Promise<CleanedNewsData>

  // æ‰¹é‡æ¸…æ´—
  async cleanBatch(rawDataIds: string[]): Promise<void>

  // å»é‡æ£€æµ‹
  async checkDuplicate(title: string, sourceUrl: string): Promise<boolean>

  // æå–åœ°ç†ä½ç½®
  extractLocation(content: string): { province?: string; city?: string }
}
```

### 3. æƒ…æ„Ÿåˆ†ææ¨¡å— (Sentiment Analysis Module) **ã€å·²ç¡®è®¤ï¼šä½¿ç”¨å¤§æ¨¡å‹ã€‘**

#### æŠ€æœ¯æ–¹æ¡ˆï¼šå¤§æ¨¡å‹ API è°ƒç”¨
**ä¸»è¦æ¨¡å‹**: DeepSeekï¼ˆé»˜è®¤ï¼‰
**æ”¯æŒåˆ‡æ¢**: OpenAIã€Claudeã€é€šä¹‰åƒé—®ã€æ–‡å¿ƒä¸€è¨€ç­‰å…¶ä»–å¤§æ¨¡å‹

#### æ¶æ„è®¾è®¡ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
```typescript
// llm-provider.interface.ts
export interface LLMProvider {
  name: string;
  analyze(text: string): Promise<SentimentAnalysisResult>;
  extractKeywords(text: string): Promise<string[]>;
}

export interface SentimentAnalysisResult {
  sentiment: 'positive' | 'neutral' | 'negative';
  score: number;              // -1.00 åˆ° 1.00
  confidence: number;         // 0 åˆ° 1ï¼ˆç½®ä¿¡åº¦ï¼‰
  keywords: string[];
  reasoning?: string;         // æ¨¡å‹æ¨ç†è¿‡ç¨‹ï¼ˆå¯é€‰ï¼‰
}

// deepseek.provider.ts
@Injectable()
export class DeepSeekProvider implements LLMProvider {
  name = 'deepseek';
  private apiKey: string;
  private baseUrl = 'https://api.deepseek.com/v1';

  async analyze(text: string): Promise<SentimentAnalysisResult> {
    const prompt = `
è¯·åˆ†æä»¥ä¸‹æ–‡æœ¬çš„æƒ…æ„Ÿå€¾å‘ï¼Œå¹¶æå–å…³é”®è¯ï¼š

æ–‡æœ¬ï¼š${text}

è¯·æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¿”å›ï¼š
{
  "sentiment": "positive/neutral/negative",
  "score": -1.00 åˆ° 1.00 çš„æ•°å€¼,
  "confidence": 0 åˆ° 1 çš„ç½®ä¿¡åº¦,
  "keywords": ["å…³é”®è¯1", "å…³é”®è¯2", ...],
  "reasoning": "ç®€çŸ­çš„åˆ†æç†ç”±"
}
`;

    const response = await axios.post(
      `${this.baseUrl}/chat/completions`,
      {
        model: 'deepseek-chat',
        messages: [{ role: 'user', content: prompt }],
        temperature: 0.3,
        response_format: { type: 'json_object' }
      },
      {
        headers: { 'Authorization': `Bearer ${this.apiKey}` }
      }
    );

    return JSON.parse(response.data.choices[0].message.content);
  }

  async extractKeywords(text: string): Promise<string[]> {
    // å®ç°å…³é”®è¯æå–
  }
}

// openai.provider.ts
@Injectable()
export class OpenAIProvider implements LLMProvider {
  name = 'openai';
  // ç±»ä¼¼å®ç°
}

// sentiment-analysis.service.ts
@Injectable()
export class SentimentAnalysisService {
  private providers = new Map<string, LLMProvider>();
  private currentProvider: LLMProvider;

  constructor(
    private deepseekProvider: DeepSeekProvider,
    private openaiProvider: OpenAIProvider,
    // ... å…¶ä»– provider
    private configService: ConfigService
  ) {
    // æ³¨å†Œæ‰€æœ‰ provider
    this.registerProvider(deepseekProvider);
    this.registerProvider(openaiProvider);

    // è®¾ç½®é»˜è®¤ provider
    const defaultProvider = this.configService.get('LLM_PROVIDER', 'deepseek');
    this.setProvider(defaultProvider);
  }

  registerProvider(provider: LLMProvider) {
    this.providers.set(provider.name, provider);
  }

  setProvider(name: string) {
    const provider = this.providers.get(name);
    if (!provider) {
      throw new Error(`Provider ${name} not found`);
    }
    this.currentProvider = provider;
  }

  async analyze(text: string): Promise<SentimentAnalysisResult> {
    return await this.currentProvider.analyze(text);
  }

  async analyzeBatch(texts: string[]): Promise<SentimentAnalysisResult[]> {
    // æ‰¹é‡åˆ†æï¼Œæ”¯æŒå¹¶å‘æ§åˆ¶
    const results = [];
    for (const text of texts) {
      results.push(await this.analyze(text));
    }
    return results;
  }
}
```

#### é…ç½®æ–‡ä»¶ï¼ˆ.envï¼‰
```bash
# LLM é…ç½®
LLM_PROVIDER=deepseek           # é»˜è®¤ä½¿ç”¨çš„æ¨¡å‹
LLM_BATCH_SIZE=10               # æ‰¹é‡å¤„ç†å¤§å°
LLM_TIMEOUT=30000               # è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
LLM_RETRY_TIMES=3               # é‡è¯•æ¬¡æ•°

# DeepSeek é…ç½®
DEEPSEEK_API_KEY=sk-xxxxx
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# OpenAI é…ç½®ï¼ˆå¯é€‰ï¼‰
OPENAI_API_KEY=sk-xxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# é€šä¹‰åƒé—®é…ç½®ï¼ˆå¯é€‰ï¼‰
QWEN_API_KEY=xxxxx
QWEN_BASE_URL=https://dashscope.aliyuncs.com/api/v1

# æ–‡å¿ƒä¸€è¨€é…ç½®ï¼ˆå¯é€‰ï¼‰
ERNIE_API_KEY=xxxxx
ERNIE_SECRET_KEY=xxxxx
```

#### API æ¥å£ï¼ˆåŠ¨æ€åˆ‡æ¢æ¨¡å‹ï¼‰
```typescript
// åˆ‡æ¢æ¨¡å‹
POST /api/sentiment/config/provider
Body: { provider: 'deepseek' | 'openai' | 'qwen' | 'ernie' }
Response: { success: boolean, currentProvider: string }

// è·å–å½“å‰é…ç½®
GET /api/sentiment/config
Response: {
  currentProvider: string,
  availableProviders: string[],
  config: {
    batchSize: number,
    timeout: number,
    retryTimes: number
  }
}
```

#### ä¼˜åŠ¿
âœ… **é«˜å‡†ç¡®ç‡**: å¤§æ¨¡å‹ç†è§£èƒ½åŠ›å¼ºï¼Œå‡†ç¡®ç‡ 90%+
âœ… **çµæ´»åˆ‡æ¢**: æ”¯æŒå¤šç§æ¨¡å‹ï¼ŒæŒ‰éœ€åˆ‡æ¢
âœ… **ä¸Šä¸‹æ–‡ç†è§£**: ç†è§£å¤æ‚è¯­ä¹‰å’Œè®½åˆº
âœ… **å…³é”®è¯æå–**: åŒæ—¶å®Œæˆæƒ…æ„Ÿåˆ†æå’Œå…³é”®è¯æå–
âœ… **æˆæœ¬æ§åˆ¶**: å¯æ ¹æ®é¢„ç®—é€‰æ‹©ä¸åŒæ¨¡å‹

#### æ³¨æ„äº‹é¡¹
âš ï¸ **API è°ƒç”¨æˆæœ¬**: éœ€è¦è€ƒè™‘ API è´¹ç”¨
âš ï¸ **é€Ÿç‡é™åˆ¶**: éœ€è¦å®ç°é€Ÿç‡æ§åˆ¶å’Œé˜Ÿåˆ—
âš ï¸ **é™çº§ç­–ç•¥**: API å¤±è´¥æ—¶ä½¿ç”¨è§„åˆ™å¼•æ“å…œåº•
âš ï¸ **ç¼“å­˜ç­–ç•¥**: ç›¸åŒæ–‡æœ¬ç¼“å­˜ç»“æœï¼ˆRedisï¼‰

### 4. RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡

#### é˜Ÿåˆ—æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  crawl.tasks    â”‚ â†’ çˆ¬è™«ä»»åŠ¡é˜Ÿåˆ—ï¼ˆä¼˜å…ˆçº§é˜Ÿåˆ—ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  data.cleaning  â”‚ â†’ æ•°æ®æ¸…æ´—é˜Ÿåˆ—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  data.analysis  â”‚ â†’ æƒ…æ„Ÿåˆ†æé˜Ÿåˆ—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  data.notify    â”‚ â†’ å®æ—¶é€šçŸ¥é˜Ÿåˆ—ï¼ˆWebSocket æ¨é€ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¶ˆæ¯æ ¼å¼
```typescript
// çˆ¬è™«ä»»åŠ¡æ¶ˆæ¯
{
  taskId: string,
  taskType: 'url' | 'keyword' | 'batch',
  priority: number,
  payload: {
    url?: string,
    keyword?: string,
    urls?: string[]
  },
  retry: {
    count: number,
    maxRetries: number
  }
}

// æ•°æ®æ¸…æ´—æ¶ˆæ¯
{
  rawDataId: string,
  priority: number
}

// æƒ…æ„Ÿåˆ†ææ¶ˆæ¯
{
  newsId: string,
  text: string
}
```

---

## éƒ¨ç½²æ¶æ„ï¼ˆå¾…ç¡®è®¤ï¼‰

### å¼€å‘ç¯å¢ƒ
```
NestJS (xxx:3000)
PostgreSQL (xxx:5432)
MongoDB (xxx:27017)
Redis (xxx:6379)
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆå»ºè®®ï¼‰
```
NestJS æœåŠ¡ï¼ˆDocker å®¹å™¨ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•ï¼‰
PostgreSQLï¼ˆä¸»ä»å¤åˆ¶ï¼‰
MongoDB å‰¯æœ¬é›†
Redis é›†ç¾¤ï¼ˆç¼“å­˜ + æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
Nginx åå‘ä»£ç† + è´Ÿè½½å‡è¡¡
```

---

## å®‰å…¨ä¸æ€§èƒ½ï¼ˆå¾…å®Œå–„ï¼‰

### å®‰å…¨æªæ–½
- [ ] API é‰´æƒï¼ˆJWT / API Keyï¼‰**ï¼ˆå¾…ç¡®è®¤æ˜¯å¦éœ€è¦ï¼‰**
- [ ] è¯·æ±‚é¢‘ç‡é™åˆ¶ï¼ˆRate Limitingï¼‰
- [ ] æ•°æ®åŠ å¯†ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼‰
- [ ] SQL æ³¨å…¥é˜²æŠ¤ï¼ˆä½¿ç”¨ ORMï¼‰
- [ ] XSS é˜²æŠ¤

### æ€§èƒ½ä¼˜åŒ–
- [ ] Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- [ ] æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- [ ] åˆ†é¡µæŸ¥è¯¢ï¼ˆé¿å…å…¨è¡¨æ‰«æï¼‰
- [ ] WebSocket è¿æ¥æ± ç®¡ç†
- [ ] CDN åŠ é€Ÿé™æ€èµ„æº

---

## å¼€å‘è®¡åˆ’ï¼ˆä»»åŠ¡æ‹†åˆ†ï¼‰

### é˜¶æ®µ 1: é¡¹ç›®åˆå§‹åŒ–ï¼ˆæ— ä¾èµ–ï¼‰
- [ ] T1.1 æ£€æŸ¥ç°æœ‰ NestJS é¡¹ç›®é…ç½®
- [ ] T1.2 é…ç½® TypeORMï¼ˆPostgreSQLï¼‰
- [ ] T1.3 é…ç½® Mongooseï¼ˆMongoDBï¼‰
- [ ] T1.4 é…ç½® Redis è¿æ¥
- [ ] T1.5 é…ç½® RabbitMQ è¿æ¥ï¼ˆ@nestjs/microservicesï¼‰
- [ ] T1.6 é…ç½® MinIO å®¢æˆ·ç«¯ï¼ˆminio npm åŒ…ï¼‰
- [ ] T1.7 é…ç½® WebSocket æ¨¡å—ï¼ˆ@nestjs/websocketsï¼‰
- [ ] T1.8 é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰
- [ ] T1.9 é…ç½® ESLint + Prettierï¼ˆå·²æœ‰åˆ™æ£€æŸ¥ï¼‰
- [ ] T1.10 é…ç½® Docker Composeï¼ˆPostgreSQL, MongoDB, Redis, RabbitMQ, MinIOï¼‰
- [ ] T1.11 åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„ï¼ˆmodules, entities, schemasï¼‰

**æäº¤ç‚¹**: å®Œæˆé¡¹ç›®åŸºç¡€é…ç½®

### é˜¶æ®µ 2: é¡µé¢ç®¡ç†æ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ1ï¼‰
- [ ] T2.1 åˆ›å»º Pages Module
- [ ] T2.2 å®šä¹‰ Page Entity / Schema
- [ ] T2.3 å®ç° Pages Serviceï¼ˆCRUD é€»è¾‘ï¼‰
- [ ] T2.4 å®ç° Pages Controllerï¼ˆRESTful APIï¼‰
- [ ] T2.5 å®ç°é¡µé¢å¤åˆ¶åŠŸèƒ½
- [ ] T2.6 å®ç°è®¾ç½®é»˜è®¤é¡µé¢åŠŸèƒ½
- [ ] T2.7 æ·»åŠ æ•°æ®æ ¡éªŒï¼ˆclass-validatorï¼‰
- [ ] T2.8 ç¼–å†™å•å…ƒæµ‹è¯•

**æäº¤ç‚¹**: å®Œæˆé¡µé¢ç®¡ç†åŠŸèƒ½

### é˜¶æ®µ 3: Mock æ•°æ®æœåŠ¡ï¼ˆä¾èµ–é˜¶æ®µ1ï¼Œå¯ä¸é˜¶æ®µ2å¹¶è¡Œï¼‰
- [ ] T3.1 åˆ›å»º Mock Module
- [ ] T3.2 ç”Ÿæˆ Mock èˆ†æƒ…æ•°æ®ï¼ˆfaker.jsï¼‰
- [ ] T3.3 å®ç° Mock ç»Ÿè®¡æ•°æ®æ¥å£
- [ ] T3.4 å®ç° Mock è¶‹åŠ¿æ•°æ®æ¥å£
- [ ] T3.5 å®ç° Mock åœ°ç†åˆ†å¸ƒæ•°æ®
- [ ] T3.6 å®ç° Mock è¯äº‘æ•°æ®
- [ ] T3.7 å®ç° Mock æ–°é—»åˆ—è¡¨æ¥å£
- [ ] T3.8 å®ç° Mock é¢„è­¦æ•°æ®æ¥å£

**æäº¤ç‚¹**: å®Œæˆ Mock æ•°æ®æœåŠ¡ï¼ˆå‰ç«¯å¯å¼€å§‹å¯¹æ¥ï¼‰

### é˜¶æ®µ 4: èˆ†æƒ…æ•°æ®æ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ3ï¼‰
- [ ] T4.1 åˆ›å»º Sentiment Module
- [ ] T4.2 å®šä¹‰ Sentiment Entity / Schema
- [ ] T4.3 å®ç°ç»Ÿè®¡æ•°æ®æ¥å£
- [ ] T4.4 å®ç°è¶‹åŠ¿æ•°æ®æ¥å£
- [ ] T4.5 å®ç°åˆ†ç±»åˆ†å¸ƒæ¥å£
- [ ] T4.6 å®ç°çƒ­ç‚¹è¯é¢˜æ¥å£
- [ ] T4.7 å®ç°åœ°ç†åˆ†å¸ƒæ¥å£
- [ ] T4.8 å®ç°è¯äº‘æ•°æ®æ¥å£
- [ ] T4.9 å®ç°æ–°é—»åˆ—è¡¨æ¥å£ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
- [ ] T4.10 å®ç°é¢„è­¦ä¿¡æ¯æ¥å£
- [ ] T4.11 å®ç°åª’ä½“æ¥æºåˆ†å¸ƒæ¥å£

**æäº¤ç‚¹**: å®Œæˆèˆ†æƒ…æ•°æ®æŸ¥è¯¢åŠŸèƒ½

### é˜¶æ®µ 5: WebSocket å®æ—¶æ¨é€ï¼ˆä¾èµ–é˜¶æ®µ4ï¼‰
- [ ] T5.1 åˆ›å»º WebSocket Gateway
- [ ] T5.2 å®ç°å®¢æˆ·ç«¯è¿æ¥ç®¡ç†
- [ ] T5.3 å®ç°é¢‘é“è®¢é˜…æœºåˆ¶
- [ ] T5.4 å®ç°ç»Ÿè®¡æ•°æ®å®æ—¶æ¨é€
- [ ] T5.5 å®ç°æ–°é—»æ•°æ®å®æ—¶æ¨é€
- [ ] T5.6 å®ç°é¢„è­¦ä¿¡æ¯å®æ—¶æ¨é€
- [ ] T5.7 å®ç°å¿ƒè·³ä¿æ´»æœºåˆ¶
- [ ] T5.8 å®ç°æ–­çº¿é‡è¿é€»è¾‘

**æäº¤ç‚¹**: å®Œæˆ WebSocket å®æ—¶æ¨é€

### é˜¶æ®µ 6: å†å²æ•°æ®æ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ4ï¼‰
- [ ] T6.1 åˆ›å»º History Module
- [ ] T6.2 è®¾è®¡å†å²å¿«ç…§æ•°æ®ç»“æ„
- [ ] T6.3 å®ç°å†å²å¿«ç…§å­˜å‚¨é€»è¾‘
- [ ] T6.4 å®ç°å†å²å¿«ç…§æŸ¥è¯¢æ¥å£
- [ ] T6.5 å®ç°å…³é”®äº‹ä»¶è®°å½•åŠŸèƒ½
- [ ] T6.6 å®ç°å…³é”®äº‹ä»¶æŸ¥è¯¢æ¥å£
- [ ] T6.7 å®ç°å®šæ—¶ä»»åŠ¡ï¼ˆç”Ÿæˆå†å²å¿«ç…§ï¼‰

**æäº¤ç‚¹**: å®Œæˆå†å²æ•°æ®å›æ”¾åŠŸèƒ½

### é˜¶æ®µ 7: å¯¼å‡ºæ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ4ï¼‰
- [ ] T7.1 åˆ›å»º Export Module
- [ ] T7.2 é›†æˆ Excel å¯¼å‡ºåº“ï¼ˆexceljsï¼‰
- [ ] T7.3 å®ç° Excel æ•°æ®å¯¼å‡ºæ¥å£
- [ ] T7.4 é›†æˆ PDF ç”Ÿæˆåº“ï¼ˆpuppeteerï¼‰
- [ ] T7.5 å®ç° PDF æŠ¥å‘Šç”Ÿæˆæ¥å£
- [ ] T7.6 å®ç°æ–‡ä»¶ä¸´æ—¶å­˜å‚¨å’Œæ¸…ç†
- [ ] T7.7 å®ç°æ–‡ä»¶ä¸‹è½½æ¥å£

**æäº¤ç‚¹**: å®Œæˆå¯¼å‡ºåŠŸèƒ½

### é˜¶æ®µ 8: çˆ¬è™«æ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ1ï¼‰
- [ ] T8.1 åˆ›å»º Crawler Module
- [ ] T8.2 å®šä¹‰ RawNewsData Schemaï¼ˆMongoDBï¼‰
- [ ] T8.3 å®šä¹‰ CrawlTask Schemaï¼ˆMongoDBï¼‰
- [ ] T8.4 å®‰è£…çˆ¬è™«ä¾èµ–ï¼ˆpuppeteer, cheerio, axiosï¼‰
- [ ] T8.5 å®ç°é™æ€é¡µé¢çˆ¬å–ï¼ˆCheerioï¼‰
- [ ] T8.6 å®ç°åŠ¨æ€é¡µé¢çˆ¬å–ï¼ˆPuppeteerï¼‰
- [ ] T8.7 å®ç°ç½‘ç«™è§£æå™¨æ³¨å†Œæœºåˆ¶
- [ ] T8.8 å®ç° User-Agent è½®æ¢
- [ ] T8.9 å®ç°å¹¶å‘æ§åˆ¶å’Œé€Ÿç‡é™åˆ¶
- [ ] T8.10 å®ç°çˆ¬è™«ä»»åŠ¡é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰
- [ ] T8.11 å®ç°çˆ¬è™«ä»»åŠ¡ç®¡ç† APIï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€åœæ­¢ï¼‰
- [ ] T8.12 å®ç°çˆ¬è™«é”™è¯¯å¤„ç†å’Œé‡è¯•

**æäº¤ç‚¹**: å®Œæˆçˆ¬è™«æ¨¡å—

### é˜¶æ®µ 9: æ•°æ®æ¸…æ´—æ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ8ï¼‰
- [ ] T9.1 åˆ›å»º DataCleaning Module
- [ ] T9.2 å®ç° HTML æ ‡ç­¾æ¸…ç†
- [ ] T9.3 å®ç°æ—¶é—´æ ¼å¼æ ‡å‡†åŒ–
- [ ] T9.4 å®ç°åœ°ç†ä½ç½®æå–ï¼ˆçœå¸‚è¯†åˆ«ï¼‰
- [ ] T9.5 å®ç°å†…å®¹å»é‡é€»è¾‘ï¼ˆåŸºäºç›¸ä¼¼åº¦ï¼‰
- [ ] T9.6 å®ç°åƒåœ¾å†…å®¹è¿‡æ»¤
- [ ] T9.7 å®ç°æ•°æ®æ¸…æ´—é˜Ÿåˆ—æ¶ˆè´¹è€…ï¼ˆRabbitMQï¼‰
- [ ] T9.8 å®ç°æ‰¹é‡æ¸…æ´—æ¥å£

**æäº¤ç‚¹**: å®Œæˆæ•°æ®æ¸…æ´—æ¨¡å—

### é˜¶æ®µ 10: æƒ…æ„Ÿåˆ†ææ¨¡å—ï¼ˆä¾èµ–é˜¶æ®µ9ï¼‰**ã€ä½¿ç”¨ DeepSeek å¤§æ¨¡å‹ã€‘**
- [ ] T10.1 åˆ›å»º SentimentAnalysis Module
- [ ] T10.2 å®šä¹‰ LLMProvider æ¥å£ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
- [ ] T10.3 å®ç° DeepSeekProviderï¼ˆä¸»è¦ï¼‰
- [ ] T10.4 å®ç° OpenAIProviderï¼ˆå¯é€‰ï¼‰
- [ ] T10.5 å®ç°é€šä¹‰åƒé—® Providerï¼ˆå¯é€‰ï¼‰
- [ ] T10.6 å®ç°æ–‡å¿ƒä¸€è¨€ Providerï¼ˆå¯é€‰ï¼‰
- [ ] T10.7 å®ç° Provider æ³¨å†Œå’Œåˆ‡æ¢æœºåˆ¶
- [ ] T10.8 å®ç°æ‰¹é‡åˆ†ææ¥å£ï¼ˆå¹¶å‘æ§åˆ¶ï¼‰
- [ ] T10.9 å®ç°æƒ…æ„Ÿåˆ†æé˜Ÿåˆ—æ¶ˆè´¹è€…ï¼ˆRabbitMQï¼‰
- [ ] T10.10 å®ç° API é€Ÿç‡é™åˆ¶å’Œé‡è¯•
- [ ] T10.11 å®ç°æƒ…æ„Ÿåˆ†æç»“æœç¼“å­˜ï¼ˆRedisï¼‰
- [ ] T10.12 å®ç°é™çº§ç­–ç•¥ï¼ˆAPI å¤±è´¥æ—¶ä½¿ç”¨è§„åˆ™å¼•æ“ï¼‰
- [ ] T10.13 å®ç°æ¨¡å‹åˆ‡æ¢ç®¡ç†æ¥å£

**æäº¤ç‚¹**: å®Œæˆå¤§æ¨¡å‹æƒ…æ„Ÿåˆ†ææ¨¡å—

### é˜¶æ®µ 11: æ•°æ®å¤„ç†æµæ°´çº¿ï¼ˆä¾èµ–é˜¶æ®µ8ã€9ã€10ï¼‰
- [ ] T11.1 å®ç°å®Œæ•´æ•°æ®å¤„ç†æµæ°´çº¿ï¼ˆçˆ¬å–â†’æ¸…æ´—â†’åˆ†æâ†’å…¥åº“ï¼‰
- [ ] T11.2 å®ç° PostgreSQL æ•°æ®å†™å…¥
- [ ] T11.3 å®ç° MongoDB åˆ° PostgreSQL çš„æ•°æ®æ˜ å°„
- [ ] T11.4 å®ç°å¤„ç†çŠ¶æ€è·Ÿè¸ª
- [ ] T11.5 å®ç°å¤±è´¥æ•°æ®é‡æ–°å¤„ç†æœºåˆ¶
- [ ] T11.6 å®ç°å®šæ—¶ä»»åŠ¡ï¼ˆCronï¼‰- å®šæœŸçˆ¬å–
- [ ] T11.7 å®ç°æ•°æ®å¤„ç†ç›‘æ§å’Œæ—¥å¿—

**æäº¤ç‚¹**: å®Œæˆæ•°æ®å¤„ç†æµæ°´çº¿

### é˜¶æ®µ 12: æ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆä¾èµ–é˜¶æ®µ2-11ï¼‰
- [ ] T12.1 æ·»åŠ  Redis ç¼“å­˜ï¼ˆç»Ÿè®¡æ•°æ®ã€çƒ­ç‚¹æ•°æ®ï¼‰
- [ ] T12.2 ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆç´¢å¼•ä¼˜åŒ–ã€æ…¢æŸ¥è¯¢åˆ†æï¼‰
- [ ] T12.3 ä¼˜åŒ– MongoDB æŸ¥è¯¢ï¼ˆç´¢å¼•ã€èšåˆä¼˜åŒ–ï¼‰
- [ ] T12.4 å®ç° API é™æµï¼ˆRate Limitingï¼‰
- [ ] T12.5 å®ç°æ¥å£å“åº”ç¼“å­˜
- [ ] T12.6 ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] T12.7 ç¼–å†™é›†æˆæµ‹è¯•
- [ ] T12.8 ç¼–å†™ E2E æµ‹è¯•
- [ ] T12.9 æ€§èƒ½å‹æµ‹ï¼ˆArtillery / K6ï¼‰
- [ ] T12.10 æ—¥å¿—ç›‘æ§ï¼ˆWinstonï¼‰
- [ ] T12.11 å¥åº·æ£€æŸ¥æ¥å£ï¼ˆ/healthï¼‰
- [ ] T12.12 Swagger API æ–‡æ¡£ç”Ÿæˆ

**æäº¤ç‚¹**: å®Œæˆæµ‹è¯•å’Œä¼˜åŒ–

### æ‰§è¡Œé¡ºåºæ€»ç»“
```
é˜¶æ®µ1ï¼ˆåŸºç¡€é…ç½®ï¼‰
â†“
é˜¶æ®µ2ï¼ˆé¡µé¢ç®¡ç†ï¼‰| é˜¶æ®µ3ï¼ˆMock æ•°æ®ï¼‰| é˜¶æ®µ8ï¼ˆçˆ¬è™«æ¨¡å—ï¼‰ï¼ˆä¸‰è€…å¹¶è¡Œï¼‰
â†“
é˜¶æ®µ4ï¼ˆèˆ†æƒ…æ•°æ®æŸ¥è¯¢ï¼‰
â†“
é˜¶æ®µ5ï¼ˆWebSocketï¼‰| é˜¶æ®µ6ï¼ˆå†å²æ•°æ®ï¼‰| é˜¶æ®µ7ï¼ˆå¯¼å‡ºåŠŸèƒ½ï¼‰ï¼ˆä¸‰è€…å¹¶è¡Œï¼‰
â†“
é˜¶æ®µ9ï¼ˆæ•°æ®æ¸…æ´—ï¼‰
â†“
é˜¶æ®µ10ï¼ˆæƒ…æ„Ÿåˆ†æï¼‰
â†“
é˜¶æ®µ11ï¼ˆæ•°æ®æµæ°´çº¿ï¼‰
â†“
é˜¶æ®µ12ï¼ˆä¼˜åŒ–ä¸æµ‹è¯•ï¼‰
```

**æ¨èä¼˜å…ˆçº§**ï¼š
1. **é˜¶æ®µ1 â†’ é˜¶æ®µ3** - å¿«é€Ÿæ­å»º Mock æ•°æ®ï¼Œè®©å‰ç«¯å¯ä»¥å¼€å§‹å¯¹æ¥
2. **é˜¶æ®µ2** - é¡µé¢ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå¤§å±ç¼–è¾‘å™¨
3. **é˜¶æ®µ4ã€5ã€6ã€7** - æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼ˆæŸ¥è¯¢ã€å®æ—¶ã€å†å²ã€å¯¼å‡ºï¼‰
4. **é˜¶æ®µ8ã€9ã€10ã€11** - æ•°æ®é‡‡é›†å’Œå¤„ç†æµæ°´çº¿ï¼ˆå¯å»¶åå¼€å‘ï¼‰

---

## æŠ€æœ¯æ–¹æ¡ˆç¡®è®¤ âœ…

### å·²ç¡®è®¤äº‹é¡¹ï¼ˆå…¨éƒ¨å®Œæˆï¼‰
1. âœ… **çˆ¬è™«æŠ€æœ¯æ ˆ**: Playwrightï¼ˆæ›¿ä»£ Puppeteerï¼‰
   - æ•°æ®æ¥æº: `https://s.weibo.com/top/summary`
   - çˆ¬å–é¢‘ç‡: æ¯ 10 åˆ†é’Ÿçˆ¬å–çƒ­æœæ¦œï¼Œæ¯ 30 åˆ†é’Ÿçˆ¬å–è¯é¢˜è¯¦æƒ…
   - åçˆ¬ç­–ç•¥: User-Agent è½®æ¢ + é¢‘ç‡æ§åˆ¶ï¼ˆæš‚ä¸ä½¿ç”¨ä»£ç†æ± ï¼‰

2. âœ… **æƒ…æ„Ÿåˆ†æ**: ä½¿ç”¨ DeepSeek å¤§æ¨¡å‹
   - ä¸»è¦æ¨¡å‹: DeepSeek
   - API Key: `sk-38d1513afb404626b4be135b6124ce57`
   - æ”¯æŒåˆ‡æ¢: OpenAIã€Claudeã€é€šä¹‰åƒé—®ã€æ–‡å¿ƒä¸€è¨€
   - æ¶æ„æ¨¡å¼: ç­–ç•¥æ¨¡å¼ï¼Œå¯åŠ¨æ€åˆ‡æ¢æ¨¡å‹

3. âœ… **æ•°æ®åº“æ¶æ„**: æ··åˆæ–¹æ¡ˆ
   - MongoDB: å­˜å‚¨çˆ¬å–çš„åŸå§‹æ•°æ®
   - PostgreSQL: å­˜å‚¨æ¸…æ´—åçš„ç»“æ„åŒ–æ•°æ®

4. âœ… **ä¸­é—´ä»¶æŠ€æœ¯æ ˆ**:
   - æ¶ˆæ¯é˜Ÿåˆ—: RabbitMQ
   - ç¼“å­˜: Redis
   - æ–‡ä»¶å­˜å‚¨: MinIO

5. âœ… **ç”¨æˆ·é‰´æƒ**: ä¸éœ€è¦é‰´æƒï¼ŒAPI ç›´æ¥å¼€æ”¾

6. âœ… **ä»£ç†æ± **: æš‚ä¸ä½¿ç”¨ï¼Œå…ˆæµ‹è¯•æ•ˆæœ

7. âœ… **å†å²æ•°æ®**: æ°¸ä¹…ä¿å­˜ï¼ˆä¸è‡ªåŠ¨åˆ é™¤ï¼‰

## å¾…ç¡®è®¤äº‹é¡¹ âš ï¸

### ä¸­ä¼˜å…ˆçº§ï¼ˆå¯è¾¹å¼€å‘è¾¹ç¡®è®¤ï¼‰
1. **æ•°æ®é‡çº§é¢„ä¼°**:
   - å¾®åšçƒ­æœï¼šæ¯ 10 åˆ†é’Ÿ 50 æ¡ï¼Œæ¯å¤© ~7200 æ¡
   - å‰ç«¯è¿æ¥æ•°é¢„ä¼°ï¼Ÿï¼ˆWebSocket å¹¶å‘ï¼‰
   - æ•°æ®åº“å­˜å‚¨å®¹é‡è§„åˆ’ï¼Ÿ

### ä¸­ä¼˜å…ˆçº§
5. **éƒ¨ç½²æ–¹å¼**:
   - Docker Composeï¼ˆå•æœºéƒ¨ç½²ï¼Œå¼€å‘/æµ‹è¯•ç¯å¢ƒï¼‰
   - Kubernetesï¼ˆé›†ç¾¤éƒ¨ç½²ï¼Œç”Ÿäº§ç¯å¢ƒï¼‰
   - **æ¨èåˆæœŸä½¿ç”¨ Docker Compose**

6. **Redis ç¼“å­˜ç­–ç•¥**:
   - ç»Ÿè®¡æ•°æ®ï¼ˆTTL: 5åˆ†é’Ÿï¼‰
   - çƒ­ç‚¹èˆ†æƒ…ï¼ˆTTL: 10åˆ†é’Ÿï¼‰
   - åœ°ç†åˆ†å¸ƒæ•°æ®ï¼ˆTTL: 30åˆ†é’Ÿï¼‰

7. **ç›‘æ§å’Œæ—¥å¿—**:
   - Winstonï¼ˆæ—¥å¿—æ¡†æ¶ï¼‰
   - ELK Stackï¼ˆå¯é€‰ï¼Œæ—¥å¿—èšåˆï¼‰
   - Prometheus + Grafanaï¼ˆå¯é€‰ï¼Œæ€§èƒ½ç›‘æ§ï¼‰

### ä½ä¼˜å…ˆçº§ï¼ˆå¯å»¶åç¡®å®šï¼‰
8. **API æ–‡æ¡£**: ä½¿ç”¨ Swaggerï¼ˆ@nestjs/swaggerï¼‰
9. **å¥åº·æ£€æŸ¥**: å®ç° /health æ¥å£ï¼ˆK8s å°±ç»ªæ¢é’ˆï¼‰
10. **æ•°æ®å¤‡ä»½ç­–ç•¥**: PostgreSQL å®šæ—¶å¤‡ä»½ã€MongoDB å‰¯æœ¬é›†

---

## ä¸å‰ç«¯å¯¹æ¥çº¦å®š

### API åŸºç¡€è·¯å¾„
```
å¼€å‘ç¯å¢ƒ: http://xxx:3000/api
ç”Ÿäº§ç¯å¢ƒ: https://api.example.com/api
```

### WebSocket åœ°å€
```
å¼€å‘ç¯å¢ƒ: ws://xxx:3000/ws
ç”Ÿäº§ç¯å¢ƒ: wss://api.example.com/ws
```

### å“åº”æ ¼å¼ç»Ÿä¸€
```typescript
// æˆåŠŸå“åº”
{
  success: true,
  data: any,
  message?: string
}

// é”™è¯¯å“åº”
{
  success: false,
  error: {
    code: string,
    message: string,
    details?: any
  }
}
```

### æ—¶é—´æ ¼å¼
ç»Ÿä¸€ä½¿ç”¨ ISO 8601 æ ¼å¼ï¼š`2025-10-07T15:30:00Z`

### åˆ†é¡µå‚æ•°
```typescript
{
  page: number;         // é¡µç ï¼Œä» 1 å¼€å§‹
  pageSize: number;     // æ¯é¡µæ•°é‡
  total: number;        // æ€»æ•°
}
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨ ğŸš€

### ç¬¬ä¸€æœŸæ ¸å¿ƒç›®æ ‡ï¼ˆå¾®åšçƒ­æœ + DeepSeek æƒ…æ„Ÿåˆ†æï¼‰

#### å¿«é€Ÿå¯åŠ¨è·¯çº¿å›¾
```
Week 1: åŸºç¡€é…ç½® + Mock æ•°æ®
â”œâ”€ Day 1-2: Docker Compose é…ç½®ï¼ˆPostgreSQL, MongoDB, Redis, RabbitMQ, MinIOï¼‰
â”œâ”€ Day 3-4: Mock æ•°æ®æœåŠ¡ â†’ å‰ç«¯å¯å¼€å§‹å¯¹æ¥
â””â”€ Day 5: é¡µé¢ç®¡ç†æ¨¡å—å¼€å§‹

Week 2-3: æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½
â”œâ”€ é¡µé¢ç®¡ç†æ¨¡å—ï¼ˆCRUDï¼‰
â”œâ”€ èˆ†æƒ…æ•°æ®æŸ¥è¯¢æ¥å£
â”œâ”€ WebSocket å®æ—¶æ¨é€
â””â”€ å†å²æ•°æ®å’Œå¯¼å‡ºåŠŸèƒ½

Week 4-5: å¾®åšçˆ¬è™« + æ•°æ®æµæ°´çº¿ ğŸ”¥
â”œâ”€ å¾®åšçƒ­æœçˆ¬è™«å®ç°
â”œâ”€ æ•°æ®æ¸…æ´—æ¨¡å—
â”œâ”€ DeepSeek æƒ…æ„Ÿåˆ†æé›†æˆ
â”œâ”€ å®Œæ•´æ•°æ®æµæ°´çº¿ï¼ˆçˆ¬å–â†’æ¸…æ´—â†’åˆ†æâ†’å…¥åº“â†’æ¨é€ï¼‰
â””â”€ å®šæ—¶ä»»åŠ¡é…ç½®

Week 6: ä¼˜åŒ–ä¸ä¸Šçº¿
â”œâ”€ ä»£ç†æ± é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
â”œâ”€ æ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯•
â”œâ”€ ç›‘æ§å’Œæ—¥å¿—å®Œå–„
â””â”€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```

### ç«‹å³è¡ŒåŠ¨æ¸…å•

#### 1. å‡†å¤‡å·¥ä½œï¼ˆç°åœ¨ï¼‰
- [ ] è·å– DeepSeek API Key
- [ ] ç¡®è®¤æ˜¯å¦éœ€è¦ä»£ç†æ± ï¼ˆå»ºè®®å…ˆæµ‹è¯•æ— ä»£ç†ï¼‰
- [ ] ç¡®è®¤ç”¨æˆ·é‰´æƒéœ€æ±‚ï¼ˆå»ºè®®æš‚ä¸å®ç°ï¼‰
- [ ] å‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒï¼ˆDocker ç¯å¢ƒï¼‰

#### 2. ç¬¬1å‘¨ä»»åŠ¡ï¼ˆåŸºç¡€è®¾æ–½ï¼‰
- [ ] é…ç½® Docker Compose å…¨å®¶æ¡¶
- [ ] é…ç½® NestJS è¿æ¥æ‰€æœ‰æ•°æ®åº“å’Œä¸­é—´ä»¶
- [ ] å®ç° Mock æ•°æ®æœåŠ¡ï¼ˆä¼˜å…ˆï¼‰
- [ ] è®©å‰ç«¯å¼€å§‹å¯¹æ¥å¼€å‘

#### 3. ç¬¬2-3å‘¨ä»»åŠ¡ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- [ ] é¡µé¢ç®¡ç†æ¨¡å—ï¼ˆæ”¯æŒç¼–è¾‘å™¨ï¼‰
- [ ] èˆ†æƒ…æ•°æ®æŸ¥è¯¢æ¥å£ï¼ˆ9ä¸ªæ¥å£ï¼‰
- [ ] WebSocket å®æ—¶æ¨é€
- [ ] å†å²æ•°æ®æŸ¥è¯¢å’Œå¯¼å‡ºåŠŸèƒ½

#### 4. ç¬¬4-5å‘¨ä»»åŠ¡ï¼ˆæ•°æ®é‡‡é›†ï¼‰**ã€é‡ç‚¹ã€‘**
- [ ] å¾®åšçƒ­æœçˆ¬è™«å®ç°
- [ ] è¯é¢˜è¯¦æƒ…çˆ¬å–
- [ ] æ•°æ®æ¸…æ´—æ¨¡å—
- [ ] DeepSeek Provider å®ç°
- [ ] å®Œæ•´æ•°æ®æµæ°´çº¿æµ‹è¯•
- [ ] å®šæ—¶ä»»åŠ¡é…ç½®

#### 5. ç¬¬6å‘¨ä»»åŠ¡ï¼ˆä¼˜åŒ–ä¸Šçº¿ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œå‹æµ‹
- [ ] ç›‘æ§å’Œæ—¥å¿—
- [ ] ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### æŠ€æœ¯å‡†å¤‡æ¸…å•

#### ä¾èµ–åŒ…ï¼ˆéœ€å®‰è£…ï¼‰âœ…
```bash
# çˆ¬è™«ç›¸å…³ï¼ˆä½¿ç”¨ Playwrightï¼‰
pnpm add playwright
pnpm add cheerio axios                  # Cheerio ç”¨äºé™æ€è§£æï¼ˆå¯é€‰ï¼‰

# æ•°æ®åº“
pnpm add @nestjs/typeorm typeorm pg
pnpm add @nestjs/mongoose mongoose

# ä¸­é—´ä»¶
pnpm add @nestjs/microservices amqplib amqp-connection-manager
pnpm add redis ioredis
pnpm add minio

# WebSocket
pnpm add @nestjs/websockets @nestjs/platform-socket.io socket.io

# å·¥å…·åº“
pnpm add @nestjs/schedule          # å®šæ—¶ä»»åŠ¡
pnpm add @nestjs/config            # é…ç½®ç®¡ç†
pnpm add class-validator class-transformer
pnpm add winston                   # æ—¥å¿—

# å¤§æ¨¡å‹ SDK
pnpm add openai                    # DeepSeek å…¼å®¹ OpenAI SDK
pnpm add axios                     # HTTP è¯·æ±‚

# å¯¼å‡ºåŠŸèƒ½
pnpm add exceljs                   # Excel å¯¼å‡º
pnpm add puppeteer-core            # PDF ç”Ÿæˆï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ç”¨ Playwrightï¼‰

# å·¥å…·åº“
pnpm add dayjs                     # æ—¶é—´å¤„ç†
pnpm add lodash                    # å·¥å…·å‡½æ•°
pnpm add @types/lodash -D

# å®‰è£… Playwright æµè§ˆå™¨ï¼ˆå¿…é¡»ï¼‰
npx playwright install chromium
```

#### ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆ.envï¼‰âœ…
```bash
# æœåŠ¡é…ç½®
NODE_ENV=development
PORT=3000

# æ•°æ®åº“é…ç½®
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=sentiment

MONGODB_URI=mongodb://localhost:27017/sentiment
# å¦‚æœ MongoDB æœ‰ç”¨æˆ·åå¯†ç ï¼š
# MONGODB_URI=mongodb://username:password@localhost:27017/sentiment

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# RabbitMQ
RABBITMQ_URL=amqp://guest:guest@localhost:5672

# MinIO
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_USE_SSL=false
MINIO_BUCKET_NAME=sentiment-files

# DeepSeek APIï¼ˆå·²ç¡®è®¤ï¼‰âœ…
DEEPSEEK_API_KEY=sk-38d1513afb404626b4be135b6124ce57
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
DEEPSEEK_MODEL=deepseek-chat

# LLM é…ç½®
LLM_PROVIDER=deepseek              # é»˜è®¤ä½¿ç”¨çš„æ¨¡å‹
LLM_BATCH_SIZE=10                  # æ‰¹é‡å¤„ç†å¤§å°
LLM_TIMEOUT=30000                  # è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
LLM_RETRY_TIMES=3                  # é‡è¯•æ¬¡æ•°

# OpenAI é…ç½®ï¼ˆå¯é€‰ï¼‰
OPENAI_API_KEY=
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL=gpt-4o-mini

# çˆ¬è™«é…ç½®ï¼ˆå·²ç¡®è®¤ï¼‰âœ…
CRAWLER_CONCURRENCY=2              # å¹¶å‘æ•°
CRAWLER_REQUEST_DELAY=3000         # è¯·æ±‚é—´éš”ï¼ˆæ¯«ç§’ï¼‰
CRAWLER_USE_PROXY=false            # ä¸ä½¿ç”¨ä»£ç†
CRAWLER_TIMEOUT=30000              # è¶…æ—¶æ—¶é—´
CRAWLER_MAX_RETRIES=3              # æœ€å¤§é‡è¯•æ¬¡æ•°

# å®šæ—¶ä»»åŠ¡é…ç½®
CRAWLER_HOTRANK_SCHEDULE=*/10 * * * *     # æ¯ 10 åˆ†é’Ÿçˆ¬å–çƒ­æœ
CRAWLER_TOPIC_SCHEDULE=*/30 * * * *       # æ¯ 30 åˆ†é’Ÿçˆ¬å–è¯é¢˜è¯¦æƒ…

# å†å²æ•°æ®é…ç½®ï¼ˆå·²ç¡®è®¤ï¼‰âœ…
HISTORY_DATA_RETENTION=æ°¸ä¹…          # æ°¸ä¹…ä¿å­˜ï¼Œä¸è‡ªåŠ¨åˆ é™¤
HISTORY_SNAPSHOT_INTERVAL=300      # å†å²å¿«ç…§é—´éš”ï¼ˆç§’ï¼‰

# WebSocket é…ç½®
WS_PORT=3000
WS_PATH=/ws

# æ—¥å¿—é…ç½®
LOG_LEVEL=info                     # debug | info | warn | error
LOG_DIR=./logs

# å®‰å…¨é…ç½®ï¼ˆå·²ç¡®è®¤ï¼šä¸éœ€è¦é‰´æƒï¼‰âœ…
AUTH_ENABLED=false                 # ä¸å¯ç”¨é‰´æƒ
```

### å…³é”®é‡Œç¨‹ç¢‘

- **é‡Œç¨‹ç¢‘ 1** (Week 1 æœ«): å‰ç«¯å¯å¼€å§‹å¯¹æ¥ Mock æ•°æ® âœ…
- **é‡Œç¨‹ç¢‘ 2** (Week 3 æœ«): æ ¸å¿ƒæŸ¥è¯¢åŠŸèƒ½ä¸Šçº¿ âœ…
- **é‡Œç¨‹ç¢‘ 3** (Week 5 æœ«): å¾®åšæ•°æ®å®æ—¶é‡‡é›†å’Œåˆ†æ âœ… ğŸ¯
- **é‡Œç¨‹ç¢‘ 4** (Week 6 æœ«): ç³»ç»Ÿä¼˜åŒ–å®Œæˆï¼Œå‡†å¤‡ä¸Šçº¿ âœ…

---

*åˆ›å»ºæ—¶é—´: 2025-10-08*
*æœ€åæ›´æ–°: 2025-10-08*
