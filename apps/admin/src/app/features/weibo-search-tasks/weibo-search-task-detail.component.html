<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
  <div class="page-header">
    <div class="header-left">
      <button class="btn btn-text" (click)="goBack()">
        â† è¿”å›åˆ—è¡¨
      </button>
      <h1 *ngIf="task">{{ task.keyword }} - ä»»åŠ¡è¯¦æƒ…</h1>
    </div>
    <div class="header-actions">
      <div class="action-group">
        <button class="btn" (click)="editTask()">
          âœï¸ ç¼–è¾‘
        </button>

        <!-- æš‚åœ/æ¢å¤ -->
        <button
          *ngIf="canPauseTask()"
          class="btn"
          (click)="pauseTask()"
        >
          â¸ï¸ æš‚åœ
        </button>

        <button
          *ngIf="canResumeTask()"
          class="btn"
          (click)="resumeTask()"
        >
          â–¶ï¸ æ¢å¤
        </button>

        <!-- ç«‹å³æ‰§è¡Œ -->
        <button
          *ngIf="canRunNowTask()"
          class="btn btn-primary"
          (click)="runNow()"
        >
          âš¡ ç«‹å³æ‰§è¡Œ
        </button>

        <!-- åˆ é™¤ -->
        <button
          class="btn btn-danger"
          (click)="deleteTask()"
        >
          ğŸ—‘ï¸ åˆ é™¤
        </button>
      </div>
    </div>
  </div>

  <div class="loading" *ngIf="loading$ | async">
    åŠ è½½ä¸­...
  </div>

  <div class="content-container" *ngIf="task && !(loading$ | async)">
    <!-- è­¦å‘Šä¿¡æ¯ -->
    <div class="alert alert-warning" *ngIf="shouldShowWarning()">
      âš ï¸ {{ getWarningMessage() }}
    </div>

    <!-- ä»»åŠ¡æ¦‚è§ˆ -->
    <div class="overview-section">
      <div class="stats-grid">
        <!-- ä»»åŠ¡çŠ¶æ€ -->
        <div class="stat-card">
          <div class="stat-value status-{{ task.status }}">
            {{ getStatusText(task.status) }}
          </div>
          <div class="stat-label">å½“å‰çŠ¶æ€</div>
        </div>

        <!-- å®Œæˆè¿›åº¦ -->
        <div class="stat-card">
          <div class="stat-value">{{ getCompletionRate() }}%</div>
          <div class="stat-label">å®Œæˆè¿›åº¦</div>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getCompletionRate()"></div>
          </div>
        </div>

        <!-- å·²å®Œæˆæ®µæ•° -->
        <div class="stat-card">
          <div class="stat-value">{{ task.progress }}</div>
          <div class="stat-label">å·²å®Œæˆæ®µæ•°</div>
          <div class="stat-sub">æ€»å…± {{ task.totalSegments }} æ®µ</div>
        </div>

        <!-- æŠ“å–é—´éš” -->
        <div class="stat-card">
          <div class="stat-value">{{ task.crawlInterval }}</div>
          <div class="stat-label">æŠ“å–é—´éš”</div>
        </div>
      </div>
    </div>

    <!-- è¯¦ç»†ä¿¡æ¯ -->
    <div class="details-section">
      <div class="detail-cards">
        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <div class="detail-card">
          <h3>åŸºæœ¬ä¿¡æ¯</h3>
          <div class="detail-item">
            <span class="label">æœç´¢å…³é”®è¯</span>
            <span class="value">{{ task.keyword }}</span>
          </div>
          <div class="detail-item">
            <span class="label">ç›‘æ§èµ·å§‹æ—¥æœŸ</span>
            <span class="value">{{ task.startDate | date:'yyyy-MM-dd' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">å¯ç”¨çŠ¶æ€</span>
            <span class="value">
              <span class="status-tag" [class.enabled]="task.enabled" [class.disabled]="!task.enabled">
                {{ task.enabled ? 'å¯ç”¨' : 'ç¦ç”¨' }}
              </span>
            </span>
          </div>
          <div class="detail-item">
            <span class="label">è´¦å·è½®æ¢</span>
            <span class="value">
              <span class="status-tag" [class.enabled]="task.enableAccountRotation" [class.disabled]="!task.enableAccountRotation">
                {{ task.enableAccountRotation ? 'å¼€å¯' : 'å…³é—­' }}
              </span>
            </span>
          </div>
          <div class="detail-item">
            <span class="label">æŒ‡å®šè´¦å·</span>
            <span class="value">{{ task.weiboAccountId ? 'è´¦å·ID: ' + task.weiboAccountId : 'éšæœºé€‰æ‹©' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">é‡è¯•æ¬¡æ•°</span>
            <span class="value">{{ task.retryCount }} / {{ task.maxRetries }}</span>
          </div>
        </div>

        <!-- æ—¶é—´ä¿¡æ¯ -->
        <div class="detail-card">
          <h3>æ—¶é—´ä¿¡æ¯</h3>
          <div class="detail-item">
            <span class="label">åˆ›å»ºæ—¶é—´</span>
            <span class="value">
              {{ formatTime(task.createdAt) }}
              <div class="relative-time">{{ formatRelativeTime(task.createdAt) }}</div>
            </span>
          </div>
          <div class="detail-item">
            <span class="label">æ›´æ–°æ—¶é—´</span>
            <span class="value">
              {{ formatTime(task.updatedAt) }}
              <div class="relative-time">{{ formatRelativeTime(task.updatedAt) }}</div>
            </span>
          </div>
          <div class="detail-item">
            <span class="label">å½“å‰æŠ“å–æ—¶é—´</span>
            <span class="value">
              <span *ngIf="task.currentCrawlTime">
                {{ formatTime(task.currentCrawlTime) }}
                <div class="relative-time">{{ formatRelativeTime(task.currentCrawlTime) }}</div>
              </span>
              <span *ngIf="!task.currentCrawlTime" class="text-muted">æœªå¼€å§‹</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="label">æœ€æ–°æ•°æ®æ—¶é—´</span>
            <span class="value">
              <span *ngIf="task.latestCrawlTime">
                {{ formatTime(task.latestCrawlTime) }}
                <div class="relative-time">{{ formatRelativeTime(task.latestCrawlTime) }}</div>
              </span>
              <span *ngIf="!task.latestCrawlTime" class="text-muted">æ— æ•°æ®</span>
            </span>
          </div>
          <div class="detail-item">
            <span class="label">ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´</span>
            <span class="value">
              <span *ngIf="task.nextRunAt && task.enabled">
                {{ formatTime(task.nextRunAt) }}
                <div class="relative-time">{{ formatRelativeTime(task.nextRunAt) }}</div>
              </span>
              <span *ngIf="!task.nextRunAt || !task.enabled" class="text-muted">-</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- æ‰§è¡Œæ—¶é—´çº¿ -->
    <div class="timeline-section">
      <h3>æ‰§è¡Œæ—¶é—´çº¿</h3>
      <div class="timeline">
        <div
          *ngFor="let item of timeline"
          class="timeline-item timeline-{{ item.type }}"
        >
          <div class="timeline-content">
            <div class="timeline-header">
              <span class="timeline-title">{{ item.title }}</span>
              <span class="timeline-time">{{ formatTime(item.time) }}</span>
            </div>
            <div *ngIf="item.description" class="timeline-description">
              {{ item.description }}
            </div>
            <div class="timeline-relative">{{ formatRelativeTime(item.time) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- é”™è¯¯ä¿¡æ¯ -->
    <div class="error-section" *ngIf="task.errorMessage">
      <h3>é”™è¯¯ä¿¡æ¯</h3>
      <div class="alert alert-error">
        ğŸš« {{ task.errorMessage }}
      </div>
      <div class="error-help">
        è¯·æ£€æŸ¥ä»»åŠ¡é…ç½®æˆ–ç½‘ç»œè¿æ¥ï¼Œå¿…è¦æ—¶è”ç³»ç®¡ç†å‘˜
      </div>
    </div>
  </div>
</div>