<div class="w-full">
  <!-- 表格头部 -->
  <div class="px-6 py-4 border-b border-slate-200">
    <div class="flex justify-between items-center">
      <h2 class="text-xl font-semibold text-slate-800">API Keys</h2>
      <div class="text-sm text-slate-500">
        {{ getDisplayRange() }}
      </div>
    </div>
  </div>

  <!-- 表格内容 -->
  <div class="overflow-x-auto">
    <table class="w-full">
      <thead class="bg-slate-50 border-b border-slate-200">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            名称
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            API Key
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            类型
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            状态
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            使用次数
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            最后使用
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            过期时间
          </th>
          <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
            操作
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-slate-200">
        <!-- 空状态 -->
        <tr *ngIf="!loading && apiKeys.length === 0">
          <td colspan="8" class="px-6 py-12 text-center">
            <div class="flex flex-col items-center gap-4">
              <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center">
                <span class="text-2xl">🔑</span>
              </div>
              <div>
                <h3 class="text-lg font-medium text-slate-900 mb-1">暂无 API Keys</h3>
                <p class="text-slate-500">创建您的第一个 API Key 开始使用</p>
              </div>
            </div>
          </td>
        </tr>

        <!-- 数据行 -->
        <tr *ngFor="let apiKey of apiKeys; trackBy: trackByApiKeyId"
            class="hover:bg-slate-50 transition-colors duration-150"
            [class.bg-blue-50]="isApiKeySelected(apiKey)">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex flex-col">
              <div class="text-sm font-medium text-slate-900">
                {{ apiKey.name }}
              </div>
              <div class="text-xs text-slate-500 truncate max-w-[200px]" [title]="apiKey.description">
                {{ apiKey.description || '-' }}
              </div>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center gap-2">
              <code class="text-xs bg-slate-100 px-2 py-1 rounded font-mono">
                {{ getDisplayedApiKey(apiKey) }}
              </code>
              <button class="text-slate-400 hover:text-slate-600 transition-colors"
                      (click)="toggleApiKeyVisibility(apiKey)"
                      title="显示/隐藏完整 API Key">
                <span class="text-sm">{{ showFullApiKey.get(apiKey.id) ? '👁️' : '👁️‍🗨️' }}</span>
              </button>
              <button class="text-slate-400 hover:text-slate-600 transition-colors"
                      (click)="copyApiKey.emit(apiKey)"
                      title="复制 API Key">
                <span class="text-sm">📋</span>
              </button>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border {{ getTypeBadgeClass(apiKey.type) }}">
              {{ getTypeText(apiKey.type) }}
            </span>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex flex-col gap-1">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border {{ getStatusBadgeClass(apiKey.status) }}">
                {{ getStatusText(apiKey.status) }}
              </span>
              <span *ngIf="isExpiringSoon(apiKey.expiresAt)"
                    class="text-xs text-orange-600 font-medium">
                ⚠️ 即将过期
              </span>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">
            <div class="flex flex-col">
              <span class="font-medium">{{ apiKey.usageCount.toLocaleString() }}</span>
              <span class="text-xs text-slate-500">次调用</span>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-slate-900">
              <div>{{ formatRelativeTime(apiKey.lastUsedAt) }}</div>
              <div class="text-xs text-slate-500">{{ formatDate(apiKey.lastUsedAt) }}</div>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-slate-900">
              <div *ngIf="apiKey.expiresAt">
                <div [class.text-red-600]="apiKey.isExpired" [class.text-orange-600]="isExpiringSoon(apiKey.expiresAt)">
                  {{ formatDate(apiKey.expiresAt) }}
                </div>
                <div class="text-xs"
                     [class.text-red-500]="apiKey.isExpired"
                     [class.text-orange-500]="isExpiringSoon(apiKey.expiresAt)">
                  {{ apiKey.isExpired ? '已过期' : (isExpiringSoon(apiKey.expiresAt) ? '即将过期' : '正常') }}
                </div>
              </div>
              <div *ngIf="!apiKey.expiresAt" class="text-slate-500">
                永不过期
              </div>
            </div>
          </td>

          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center gap-2">
              <!-- 查看统计 -->
              <button class="p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded transition-all duration-150"
                      (click)="viewStats.emit(apiKey)"
                      title="查看使用统计">
                <span class="text-sm">📊</span>
              </button>

              <!-- 编辑 -->
              <button class="p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded transition-all duration-150"
                      [disabled]="isActionDisabled(apiKey, 'edit')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'edit')"
                      (click)="editApiKey.emit(apiKey)"
                      title="编辑">
                <span class="text-sm">✏️</span>
              </button>

              <!-- 切换状态 -->
              <button class="p-1.5 text-white rounded transition-all duration-150 text-xs px-2 py-1"
                      [class]="getToggleStatusClass(apiKey)"
                      [disabled]="isActionDisabled(apiKey, 'toggle')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'toggle')"
                      (click)="toggleStatus.emit(apiKey)"
                      [title]="getToggleStatusText(apiKey)">
                {{ getToggleStatusText(apiKey) }}
              </button>

              <!-- 重新生成 -->
              <button class="p-1.5 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded transition-all duration-150"
                      [disabled]="isActionDisabled(apiKey, 'regenerate')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'regenerate')"
                      (click)="regenerateApiKey.emit(apiKey)"
                      title="重新生成">
                <span class="text-sm">🔄</span>
              </button>

              <!-- 删除 -->
              <button class="p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded transition-all duration-150"
                      [disabled]="isActionDisabled(apiKey, 'delete')"
                      [class.opacity-50]="isActionDisabled(apiKey, 'delete')"
                      (click)="deleteApiKey.emit(apiKey)"
                      title="删除">
                <span class="text-sm">🗑️</span>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 分页控件 -->
  <div class="px-6 py-4 border-t border-slate-200 bg-slate-50" *ngIf="totalPages > 1">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <!-- 每页显示数量 -->
        <div class="flex items-center gap-2">
          <label class="text-sm text-slate-600">每页显示:</label>
          <select class="text-sm border border-slate-300 rounded px-2 py-1 bg-white"
                  [value]="pageSize"
                  (change)="onPageSizeChange($any($event.target).value)">
            <option [ngValue]="10">10</option>
            <option [ngValue]="20">20</option>
            <option [ngValue]="50">50</option>
            <option [ngValue]="100">100</option>
          </select>
        </div>
      </div>

      <!-- 分页按钮 -->
      <div class="flex items-center gap-1">
        <!-- 上一页 -->
        <button class="px-3 py-1 text-sm border border-slate-300 rounded hover:bg-white transition-colors duration-150"
                [disabled]="currentPage === 1"
                [class.opacity-50]="currentPage === 1"
                (click)="onPrevPage()">
          上一页
        </button>

        <!-- 页码 -->
        <button *ngFor="let page of pageNumbers; trackBy: trackByPage"
                class="px-3 py-1 text-sm border rounded transition-colors duration-150"
                [class]="{
                  'bg-primary text-white border-primary': page === currentPage,
                  'border-slate-300 hover:bg-white': page !== currentPage && page !== -1,
                  'px-2 border-0 cursor-default': page === -1
                }"
                [disabled]="page === -1"
                (click)="page !== -1 && onGoToPage(page)">
          {{ page === -1 ? '...' : page }}
        </button>

        <!-- 下一页 -->
        <button class="px-3 py-1 text-sm border border-slate-300 rounded hover:bg-white transition-colors duration-150"
                [disabled]="currentPage === totalPages"
                [class.opacity-50]="currentPage === totalPages"
                (click)="onNextPage()">
          下一页
        </button>
      </div>
    </div>
  </div>
</div>