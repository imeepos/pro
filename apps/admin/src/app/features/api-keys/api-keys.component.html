<div class="bg-white rounded-lg border border-gray-200 p-6 mb-6">
  <div class="h-full flex flex-col">
    <!-- 页面标题区域 -->
    <div class="bg-white border-b px-6 py-4 -mx-6 -mt-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">API Key 管理</h1>
          <p class="text-sm text-gray-600 mt-1">管理您的 API 访问密钥，控制访问权限和使用统计</p>
        </div>
        <div class="flex gap-3">
          <button
            (click)="onRefresh()"
            class="inline-flex items-center px-4 py-2 text-gray-700 bg-white border border-gray-300 text-sm font-medium rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            刷新
          </button>
          <button
            (click)="onCreateApiKey()"
            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            创建 API Key
          </button>
        </div>
      </div>
    </div>

    <!-- 统计信息卡片 -->
    <div class="mb-6">
      <app-api-key-stats></app-api-key-stats>
    </div>

    <!-- 搜索和过滤区域 -->
    <div class="bg-white border border-gray-200 rounded-lg p-6 mb-6">
      <form [formGroup]="searchForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
        <!-- 搜索 -->
        <div class="flex flex-col">
          <label class="text-sm font-semibold text-gray-700 mb-2">搜索</label>
          <input
            type="text"
            formControlName="search"
            placeholder="名称或描述"
            class="px-4 py-2.5 text-sm border border-gray-300 rounded-lg bg-white transition-all duration-300 outline-none text-gray-800 placeholder:text-gray-400 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20"
          >
        </div>

        <!-- 状态过滤 -->
        <div class="flex flex-col">
          <label class="text-sm font-semibold text-gray-700 mb-2">状态</label>
          <select
            formControlName="status"
            class="px-4 py-2.5 text-sm border border-gray-300 rounded-lg bg-white transition-all duration-300 outline-none text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20"
          >
            <option value="">全部状态</option>
            <option value="active">活跃</option>
            <option value="inactive">未激活</option>
            <option value="expired">已过期</option>
            <option value="revoked">已撤销</option>
          </select>
        </div>

        <!-- 类型过滤 -->
        <div class="flex flex-col">
          <label class="text-sm font-semibold text-gray-700 mb-2">类型</label>
          <select
            formControlName="type"
            class="px-4 py-2.5 text-sm border border-gray-300 rounded-lg bg-white transition-all duration-300 outline-none text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20"
          >
            <option value="">全部类型</option>
            <option value="read_only">只读</option>
            <option value="read_write">读写</option>
            <option value="admin">管理员</option>
          </select>
        </div>

        <!-- 排序 -->
        <div class="flex flex-col">
          <label class="text-sm font-semibold text-gray-700 mb-2">排序</label>
          <select
            formControlName="sortBy"
            class="px-4 py-2.5 text-sm border border-gray-300 rounded-lg bg-white transition-all duration-300 outline-none text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20"
          >
            <option value="createdAt">创建时间</option>
            <option value="updatedAt">更新时间</option>
            <option value="lastUsedAt">最后使用</option>
            <option value="usageCount">使用次数</option>
            <option value="name">名称</option>
          </select>
        </div>

        <!-- 排序方向 -->
        <div class="flex flex-col">
          <label class="text-sm font-semibold text-gray-700 mb-2">排序方向</label>
          <select
            formControlName="sortOrder"
            class="px-4 py-2.5 text-sm border border-gray-300 rounded-lg bg-white transition-all duration-300 outline-none text-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-20"
          >
            <option value="desc">降序</option>
            <option value="asc">升序</option>
          </select>
        </div>
      </form>
    </div>

    <!-- 错误提示 -->
    <div class="bg-red-50 border border-red-200 px-4 py-3 rounded-lg border-l-4 border-l-red-500 mb-6" *ngIf="error">
      <div class="flex items-center">
        <svg class="w-5 h-5 text-red-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.866-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
        </svg>
        <span class="text-red-700">{{ error }}</span>
      </div>
    </div>

    <!-- API Key 列表 -->
    <div class="bg-white border border-gray-200 rounded-lg">
      <!-- 加载状态 -->
      <div class="flex items-center justify-center py-20" *ngIf="loading">
        <div class="flex flex-col items-center gap-4">
          <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
          <p class="text-gray-500">加载中...</p>
        </div>
      </div>

      <!-- 表格组件 -->
      <app-api-key-table
        *ngIf="!loading"
        [apiKeys]="apiKeys"
        [selectedApiKey]="selectedApiKey"
        [loading]="loading"
        [currentPage]="currentPage"
        [pageSize]="pageSize"
        [totalItems]="totalItems"
        (apiKeySelected)="onApiKeySelected($event)"
        (editApiKey)="onEditApiKey($event)"
        (deleteApiKey)="onDeleteApiKey($event)"
        (toggleStatus)="onToggleApiKeyStatus($event)"
        (regenerateApiKey)="onRegenerateApiKey($event)"
        (copyApiKey)="onCopyApiKey($event)"
        (viewStats)="onViewStats($event)"
        (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)">
      </app-api-key-table>
    </div>
  </div>
</div>

<!-- 创建模态框 -->
<app-api-key-modal
  *ngIf="showCreateModal"
  [title]="'创建新的 API Key'"
  [visible]="showCreateModal"
  (close)="onModalClose()"
  (created)="onApiKeyCreated($event)">
</app-api-key-modal>

<!-- 编辑模态框 -->
<app-api-key-modal
  *ngIf="showEditModal"
  [title]="'编辑 API Key'"
  [visible]="showEditModal"
  [mode]="'edit'"
  [apiKey]="selectedApiKey"
  (close)="onModalClose()"
  (updated)="onApiKeyUpdated($event)">
</app-api-key-modal>

<!-- 删除确认模态框 -->
<app-api-key-modal
  *ngIf="showDeleteModal"
  [title]="'删除 API Key'"
  [visible]="showDeleteModal"
  [mode]="'delete'"
  [apiKey]="selectedApiKey"
  (close)="onModalClose()"
  (deleted)="onApiKeyDeleted()">
</app-api-key-modal>

<!-- 重新生成模态框 -->
<app-api-key-modal
  *ngIf="showRegenerateModal"
  [title]="'重新生成 API Key'"
  [visible]="showRegenerateModal"
  [mode]="'regenerate'"
  [apiKey]="selectedApiKey"
  (close)="onModalClose()"
  (regenerated)="onApiKeyRegenerated()">
</app-api-key-modal>