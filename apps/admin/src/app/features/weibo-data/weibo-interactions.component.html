<div class="w-full">
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">互动数据管理</h2>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">查看和管理微博互动记录</p>
  </div>

  <!-- Tabs -->
  <nz-tabset
    (nzSelectedIndexChange)="onTabChange($event)"
    class="mb-6">
    <nz-tab nzTitle="全部"></nz-tab>
    <nz-tab nzTitle="点赞 ❤️"></nz-tab>
    <nz-tab nzTitle="收藏 ⭐"></nz-tab>
    <nz-tab nzTitle="转发 🔄"></nz-tab>
    <nz-tab nzTitle="评论 💬"></nz-tab>
  </nz-tabset>

  <div *ngIf="error()" class="mb-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-800 dark:bg-red-900/30 dark:text-red-300">
    {{ error() }}
  </div>

  <!-- Toolbar -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">用户微博 ID</label>
        <input
          type="text"
          nz-input
          placeholder="搜索用户微博 ID"
          [ngModel]="searchUserWeiboId()"
          (ngModelChange)="searchUserWeiboId.set($event)"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                 placeholder-gray-400 dark:placeholder-gray-500" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">目标微博 ID</label>
        <input
          type="text"
          nz-input
          placeholder="搜索目标微博 ID"
          [ngModel]="searchTargetWeiboId()"
          (ngModelChange)="searchTargetWeiboId.set($event)"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                 placeholder-gray-400 dark:placeholder-gray-500" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">起止日期</label>
        <nz-range-picker
          [ngModel]="dateRange()"
          (ngModelChange)="dateRange.set($event)"
          [nzPlaceHolder]="['开始日期', '结束日期']"
          class="w-full h-10 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </nz-range-picker>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">目标类型</label>
        <nz-select
          [ngModel]="selectedTargetType()"
          (ngModelChange)="selectedTargetType.set($event)"
          nzPlaceHolder="选择目标类型"
          nzAllowClear
          class="w-full">
          <nz-option
            *ngFor="let option of targetTypeOptions"
            [nzLabel]="option.label"
            [nzValue]="option.value">
          </nz-option>
        </nz-select>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-wrap items-center gap-3">
      <button
        (click)="refresh()"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg
               hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
               transition-colors dark:focus:ring-offset-gray-800">
        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        刷新
      </button>

      <button
        (click)="resetFilters()"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300
               bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg
               hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2
               focus:ring-blue-500 focus:ring-offset-2 transition-colors dark:focus:ring-offset-gray-800">
        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        清空筛选
      </button>

      <span class="ml-auto text-sm text-gray-500 dark:text-gray-400">共 {{ totalCount() }} 条记录</span>
    </div>
  </div>

  <!-- Table -->
  <nz-spin [nzSpinning]="loading()">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
      <nz-table
        [nzData]="interactions()"
        [nzPageSize]="pageSize()"
        [nzPageIndex]="page()"
        [nzTotal]="totalCount()"
        [nzShowPagination]="true"
        [nzFrontPagination]="false"
        [nzShowSizeChanger]="true"
        [nzPageSizeOptions]="[10, 20, 50, 100]"
        (nzPageIndexChange)="onPageChange($event)"
        (nzPageSizeChange)="onPageSizeChange($event)">
        <thead>
          <tr>
            <th nzWidth="120px">互动类型</th>
            <th nzWidth="200px">用户</th>
            <th nzWidth="100px">目标类型</th>
            <th nzWidth="150px">目标ID</th>
            <th nzWidth="180px">时间</th>
            <th nzWidth="120px">操作</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of interactions()">
            <!-- Interaction Type -->
            <td>
              <nz-tag [nzColor]="'blue'">
                <span class="mr-1">{{ getInteractionIcon(item.interactionType) }}</span>
                {{ getInteractionLabel(item.interactionType) }}
              </nz-tag>
            </td>

            <!-- User -->
            <td>
              <div class="flex flex-col">
                <span class="text-sm font-medium text-gray-900 dark:text-white">
                  {{ item.userWeiboId || '未知用户' }}
                </span>
              </div>
            </td>

            <!-- Target Type -->
            <td>
              <nz-tag [nzColor]="item.targetType === WeiboTargetType.Post ? 'green' : 'orange'">
                {{ getTargetTypeLabel(item.targetType) }}
              </nz-tag>
            </td>

            <!-- Target ID -->
            <td>
              <span class="text-sm text-gray-600 dark:text-gray-300 font-mono">
                {{ item.targetWeiboId }}
              </span>
            </td>

            <!-- Created At -->
            <td>
              <span class="text-sm text-gray-600 dark:text-gray-300">
                {{ formatDate(item.createdAt) }}
              </span>
            </td>

            <!-- Actions -->
            <td>
              <div class="flex gap-2">
                <button
                  nz-button
                  nzType="link"
                  nzSize="small"
                  class="text-blue-600 hover:text-blue-700">
                  查看用户
                </button>
                <button
                  nz-button
                  nzType="link"
                  nzSize="small"
                  class="text-blue-600 hover:text-blue-700">
                  查看内容
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-spin>

  <!-- Empty State -->
  <nz-empty
    *ngIf="!loading() && interactions().length === 0"
    nzNotFoundContent="暂无互动数据"
    [nzNotFoundImage]="'simple'">
  </nz-empty>
</div>
