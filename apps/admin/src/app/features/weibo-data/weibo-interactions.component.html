<div class="w-full p-6">
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">äº’åŠ¨æ•°æ®ç®¡ç†</h2>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">æŸ¥çœ‹å’Œç®¡ç†å¾®åšäº’åŠ¨è®°å½•</p>
  </div>

  <!-- Tabs -->
  <nz-tabset
    (nzSelectedIndexChange)="onTabChange($event)"
    class="mb-6">
    <nz-tab nzTitle="å…¨éƒ¨"></nz-tab>
    <nz-tab nzTitle="ç‚¹èµ â¤ï¸"></nz-tab>
    <nz-tab nzTitle="æ”¶è— â­"></nz-tab>
    <nz-tab nzTitle="è½¬å‘ ğŸ”„"></nz-tab>
    <nz-tab nzTitle="è¯„è®º ğŸ’¬"></nz-tab>
  </nz-tabset>

  <!-- Toolbar -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- User ID Search -->
      <nz-input-group nzSearch [nzAddOnAfter]="searchButton">
        <input
          type="text"
          nz-input
          placeholder="æœç´¢ç”¨æˆ·å¾®åšID"
          [ngModel]="searchUserWeiboId()"
          (ngModelChange)="searchUserWeiboId.set($event)" />
      </nz-input-group>
      <ng-template #searchButton>
        <button nz-button nzType="primary" nzSearch>
          <span nz-icon nzType="search"></span>
        </button>
      </ng-template>

      <!-- Target ID Search -->
      <nz-input-group>
        <input
          type="text"
          nz-input
          placeholder="æœç´¢ç›®æ ‡å¾®åšID"
          [ngModel]="searchTargetWeiboId()"
          (ngModelChange)="searchTargetWeiboId.set($event)" />
      </nz-input-group>

      <!-- Date Range -->
      <nz-range-picker
        [ngModel]="dateRange()"
        (ngModelChange)="dateRange.set($event)"
        [nzPlaceHolder]="['å¼€å§‹æ—¥æœŸ', 'ç»“æŸæ—¥æœŸ']">
      </nz-range-picker>

      <!-- Target Type -->
      <nz-select
        [ngModel]="selectedTargetType()"
        (ngModelChange)="selectedTargetType.set($event)"
        nzPlaceHolder="é€‰æ‹©ç›®æ ‡ç±»å‹"
        nzAllowClear>
        <nz-option
          *ngFor="let option of targetTypeOptions"
          [nzLabel]="option.label"
          [nzValue]="option.value">
        </nz-option>
      </nz-select>
    </div>

    <!-- Action Buttons -->
    <div class="flex gap-2 mt-4">
      <button nz-button nzType="primary" (click)="refresh()">
        <span nz-icon nzType="reload"></span>
        åˆ·æ–°
      </button>
      <button nz-button (click)="resetFilters()">
        <span nz-icon nzType="clear"></span>
        æ¸…ç©ºç­›é€‰
      </button>
    </div>
  </div>

  <!-- Table -->
  <nz-spin [nzSpinning]="loading()">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
      <nz-table
        #interactionTable
        [nzData]="filteredInteractions()"
        [nzPageSize]="20"
        [nzShowPagination]="true"
        [nzFrontPagination]="true"
        [nzShowSizeChanger]="true"
        [nzPageSizeOptions]="[10, 20, 50, 100]">
        <thead>
          <tr>
            <th nzWidth="120px">äº’åŠ¨ç±»å‹</th>
            <th nzWidth="200px">ç”¨æˆ·</th>
            <th nzWidth="100px">ç›®æ ‡ç±»å‹</th>
            <th nzWidth="150px">ç›®æ ‡ID</th>
            <th nzWidth="180px">æ—¶é—´</th>
            <th nzWidth="120px">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of interactionTable.data">
            <!-- Interaction Type -->
            <td>
              <nz-tag [nzColor]="'blue'">
                <span class="mr-1">{{ getInteractionIcon(item.interactionType) }}</span>
                {{ getInteractionLabel(item.interactionType) }}
              </nz-tag>
            </td>

            <!-- User -->
            <td>
              <div class="flex items-center gap-2">
                <nz-avatar
                  [nzSrc]="getUserSnapshot(item.userInfoSnapshot).profileImageUrl"
                  [nzSize]="32">
                </nz-avatar>
                <div class="flex flex-col min-w-0">
                  <span class="text-sm font-medium text-gray-900 dark:text-white truncate">
                    {{ getUserSnapshot(item.userInfoSnapshot).screenName }}
                  </span>
                  <span class="text-xs text-gray-500 dark:text-gray-400 truncate">
                    ID: {{ getUserSnapshot(item.userInfoSnapshot).weiboId }}
                  </span>
                </div>
              </div>
            </td>

            <!-- Target Type -->
            <td>
              <nz-tag [nzColor]="item.targetType === WeiboTargetType.Post ? 'green' : 'orange'">
                {{ getTargetTypeLabel(item.targetType) }}
              </nz-tag>
            </td>

            <!-- Target ID -->
            <td>
              <span class="text-sm text-gray-600 dark:text-gray-300 font-mono">
                {{ item.targetWeiboId }}
              </span>
            </td>

            <!-- Created At -->
            <td>
              <span class="text-sm text-gray-600 dark:text-gray-300">
                {{ formatDate(item.createdAt) }}
              </span>
            </td>

            <!-- Actions -->
            <td>
              <div class="flex gap-2">
                <button
                  nz-button
                  nzType="link"
                  nzSize="small"
                  class="text-blue-600 hover:text-blue-700">
                  æŸ¥çœ‹ç”¨æˆ·
                </button>
                <button
                  nz-button
                  nzType="link"
                  nzSize="small"
                  class="text-blue-600 hover:text-blue-700">
                  æŸ¥çœ‹å†…å®¹
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-spin>

  <!-- Empty State -->
  <nz-empty
    *ngIf="!loading() && filteredInteractions().length === 0"
    nzNotFoundContent="æš‚æ— äº’åŠ¨æ•°æ®"
    [nzNotFoundImage]="'simple'">
  </nz-empty>
</div>
