<div class="w-full">
  <!-- å¤´éƒ¨ -->
  <div class="mb-6">
    <h2 class="text-2xl font-semibold text-gray-900 dark:text-white">å¸–å­ç®¡ç†</h2>
    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">æŸ¥çœ‹å’Œç®¡ç†å¾®åšå¸–å­æ•°æ®</p>
  </div>

  <div *ngIf="error()" class="mb-4 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-800 dark:bg-red-900/30 dark:text-red-300">
    {{ error() }}
  </div>

  <!-- æœç´¢å’Œç­›é€‰å·¥å…·æ  -->
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 mb-4">
    <!-- æœç´¢æ  -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">å…³é”®è¯</label>
        <input
          type="text"
          [ngModel]="keyword()"
          (ngModelChange)="keyword.set($event)"
          placeholder="æœç´¢å¸–å­å†…å®¹"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                 placeholder-gray-400 dark:placeholder-gray-500">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ä½œè€…æ˜µç§°</label>
        <input
          type="text"
          [ngModel]="authorNickname()"
          (ngModelChange)="authorNickname.set($event)"
          placeholder="æœç´¢ä½œè€…æ˜µç§°"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
                 placeholder-gray-400 dark:placeholder-gray-500">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">å¼€å§‹æ—¥æœŸ</label>
        <input
          type="date"
          [ngModel]="dateFrom()"
          (ngModelChange)="dateFrom.set($event)"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ç»“æŸæ—¥æœŸ</label>
        <input
          type="date"
          [ngModel]="dateTo()"
          (ngModelChange)="dateTo.set($event)"
          class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg
                 bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
      </div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="flex flex-wrap items-center gap-3">
      <button
        (click)="applyFilters()"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg
               hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2
               transition-colors dark:focus:ring-offset-gray-800">
        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        æœç´¢
      </button>

      <button
        (click)="resetFilters()"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300
               bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg
               hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2
               focus:ring-blue-500 focus:ring-offset-2 transition-colors dark:focus:ring-offset-gray-800">
        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        é‡ç½®
      </button>

      <span class="ml-auto text-sm text-gray-500 dark:text-gray-400">å…± {{ totalCount() }} æ¡è®°å½•</span>
    </div>

    <!-- å¿«æ·ç­›é€‰ -->
    <div class="flex flex-wrap items-center gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">ç­›é€‰:</span>
      <button
        (click)="toggleFilter('isLongText')"
        [ngClass]="getFilterClass(isLongText())"
        class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-lg border transition-colors">
        é•¿æ–‡æœ¬
        <span *ngIf="isLongText() === true" class="ml-1">âœ“</span>
        <span *ngIf="isLongText() === false" class="ml-1">âœ—</span>
      </button>

      <button
        (click)="toggleFilter('isRepost')"
        [ngClass]="getFilterClass(isRepost())"
        class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-lg border transition-colors">
        è½¬å‘
        <span *ngIf="isRepost() === true" class="ml-1">âœ“</span>
        <span *ngIf="isRepost() === false" class="ml-1">âœ—</span>
      </button>

      <button
        (click)="toggleFilter('favorited')"
        [ngClass]="getFilterClass(favorited())"
        class="inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-lg border transition-colors">
        æ”¶è—
        <span *ngIf="favorited() === true" class="ml-1">âœ“</span>
        <span *ngIf="favorited() === false" class="ml-1">âœ—</span>
      </button>
    </div>
  </div>

  <!-- åŠ è½½çŠ¶æ€ -->
  <div *ngIf="loading()" class="flex justify-center items-center py-12">
    <div class="flex space-x-2">
      <div class="w-3 h-3 bg-blue-600 rounded-full animate-bounce"></div>
      <div class="w-3 h-3 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
      <div class="w-3 h-3 bg-blue-600 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
    </div>
  </div>

  <!-- å¸–å­åˆ—è¡¨ -->
  <div *ngIf="!loading()" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead class="bg-gray-50 dark:bg-gray-900">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-32">
              å¸–å­ID
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">
              å†…å®¹
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-36">
              ä½œè€…
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-32 cursor-pointer hover:text-gray-700 dark:hover:text-gray-200"
                (click)="toggleSort('createdAt')">
              å‘å¸ƒæ—¶é—´ {{ getSortIcon('createdAt') }}
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-40 cursor-pointer hover:text-gray-700 dark:hover:text-gray-200"
                (click)="toggleSort('attitudesCount')">
              äº’åŠ¨æ•°æ® {{ getSortIcon('attitudesCount') }}
            </th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider w-32">
              æ“ä½œ
            </th>
          </tr>
        </thead>
        <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
          <tr *ngFor="let post of pagedPosts()" class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400 font-mono">
              {{ post.weiboId.slice(-8) }}
            </td>
            <td class="px-4 py-3">
              <div class="text-sm text-gray-900 dark:text-white">
                {{ truncateText(post.text, 100) }}
              </div>
              <div class="flex items-center gap-2 mt-1 text-xs text-gray-500 dark:text-gray-400">
                <span class="inline-flex items-center">
                  <svg class="w-3 h-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" />
                  </svg>
                  {{ post.textLength }} å­—
                </span>
                <span *ngIf="post.regionName">{{ post.regionName }}</span>
                <span *ngIf="post.isLongText" class="px-1.5 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded">é•¿æ–‡</span>
                <span *ngIf="post.isRepost" class="px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded">è½¬å‘</span>
                <span *ngIf="post.favorited" class="px-1.5 py-0.5 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400 rounded">æ”¶è—</span>
              </div>
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center space-x-2">
                <img [src]="post.author.profileImageUrl" [alt]="post.author.screenName"
                     class="w-8 h-8 rounded-full object-cover">
                <div class="flex flex-col">
                  <span class="text-sm text-gray-900 dark:text-white">{{ post.author.screenName }}</span>
                  <span *ngIf="post.author.verified" class="text-xs text-blue-600 dark:text-blue-400">å·²è®¤è¯</span>
                </div>
              </div>
            </td>
            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">
              {{ formatDate(post.createdAt) }}
            </td>
            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">
              <div class="flex flex-col gap-1">
                <div class="flex items-center gap-3">
                  <span title="ç‚¹èµ">â¤ï¸ {{ formatNumber(post.attitudesCount) }}</span>
                  <span title="è¯„è®º">ğŸ’¬ {{ formatNumber(post.commentsCount) }}</span>
                  <span title="è½¬å‘">ğŸ”„ {{ formatNumber(post.repostsCount) }}</span>
                </div>
              </div>
            </td>
            <td class="px-4 py-3">
              <div class="flex items-center gap-2">
                <button
                  (click)="viewDetail(post)"
                  class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-xs font-medium">
                  è¯¦æƒ…
                </button>
                <button
                  (click)="viewComments(post)"
                  class="text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 text-xs font-medium">
                  è¯„è®º
                </button>
                <button
                  (click)="deletePost(post)"
                  class="text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs font-medium">
                  åˆ é™¤
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ç©ºçŠ¶æ€ -->
    <div *ngIf="pagedPosts().length === 0" class="text-center py-12">
      <svg class="mx-auto h-16 w-16 text-gray-400 dark:text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <h3 class="mt-4 text-lg font-medium text-gray-900 dark:text-white">æš‚æ— å¸–å­</h3>
      <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å¸–å­</p>
    </div>

    <!-- åˆ†é¡µ -->
    <div *ngIf="pagedPosts().length > 0" class="bg-gray-50 dark:bg-gray-900 px-4 py-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-700">
      <div class="text-sm text-gray-700 dark:text-gray-300">
        æ˜¾ç¤ºç¬¬ {{ (page() - 1) * pageSize() + 1 }} åˆ° {{ Math.min(page() * pageSize(), totalCount()) }} æ¡ï¼Œå…± {{ totalCount() }} æ¡
      </div>
      <div class="flex items-center gap-2">
        <button
          (click)="changePage(page() - 1)"
          [disabled]="page() === 1"
          [class.opacity-50]="page() === 1"
          [class.cursor-not-allowed]="page() === 1"
          class="px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:hover:bg-white dark:disabled:hover:bg-gray-800 transition-colors">
          ä¸Šä¸€é¡µ
        </button>

        <span class="text-sm text-gray-700 dark:text-gray-300">
          ç¬¬ {{ page() }} / {{ totalPages() }} é¡µ
        </span>

        <button
          (click)="changePage(page() + 1)"
          [disabled]="page() === totalPages()"
          [class.opacity-50]="page() === totalPages()"
          [class.cursor-not-allowed]="page() === totalPages()"
          class="px-3 py-1 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded hover:bg-gray-50 dark:hover:bg-gray-700 disabled:hover:bg-white dark:disabled:hover:bg-gray-800 transition-colors">
          ä¸‹ä¸€é¡µ
        </button>
      </div>
    </div>
  </div>
</div>

<!-- è¯¦æƒ…æŠ½å±‰ -->
<div *ngIf="selectedPost() as post"
     class="fixed inset-0 z-50 overflow-hidden"
     (click)="closeDetail()">
  <div class="absolute inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity"></div>

  <div class="fixed inset-y-0 right-0 max-w-2xl w-full flex">
    <div class="relative w-full bg-white dark:bg-gray-800 shadow-xl overflow-y-auto"
         (click)="$event.stopPropagation()">
      <!-- æŠ½å±‰å¤´éƒ¨ -->
      <div class="sticky top-0 z-10 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-6 py-4">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">å¸–å­è¯¦æƒ…</h3>
          <button
            (click)="closeDetail()"
            class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition-colors">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- æŠ½å±‰å†…å®¹ -->
      <div class="px-6 py-4 space-y-6">
        <!-- ä½œè€…ä¿¡æ¯ -->
        <div class="flex items-center space-x-4 pb-4 border-b border-gray-200 dark:border-gray-700">
          <ng-container *ngIf="post.author.profileImageUrl; else authorFallback">
            <img [src]="post.author.profileImageUrl!"
                 [alt]="post.author.screenName"
                 class="w-16 h-16 rounded-full object-cover">
          </ng-container>
          <ng-template #authorFallback>
            <div class="flex h-16 w-16 items-center justify-center rounded-full bg-blue-500 text-lg font-semibold text-white">
              {{ post.author.screenName.charAt(0) }}
            </div>
          </ng-template>
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <h4 class="font-semibold text-gray-900 dark:text-white">{{ post.author.screenName }}</h4>
              <span *ngIf="post.author.verified"
                    class="px-2 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded">
                å·²è®¤è¯
              </span>
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400 mt-1">
              <span>ç²‰ä¸ {{ formatNumber(post.author.followersCount) }}</span>
              <span class="mx-2">Â·</span>
              <span>å…³æ³¨ {{ formatNumber(post.author.friendsCount) }}</span>
              <span class="mx-2">Â·</span>
              <span>å¾®åš {{ formatNumber(post.author.statusesCount) }}</span>
            </div>
          </div>
        </div>

        <!-- å¸–å­å†…å®¹ -->
        <div class="space-y-4">
          <div class="text-gray-900 dark:text-white text-base leading-relaxed whitespace-pre-wrap">
            {{ post.text }}
          </div>

          <!-- æ ‡ç­¾ -->
          <div class="flex flex-wrap gap-2">
            <span *ngIf="post.isLongText"
                  class="px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded">
              é•¿æ–‡æœ¬
            </span>
            <span *ngIf="post.isRepost"
                  class="px-2 py-1 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded">
              è½¬å‘
            </span>
            <span *ngIf="post.favorited"
                  class="px-2 py-1 text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400 rounded">
              å·²æ”¶è—
            </span>
          </div>
        </div>

        <!-- å…ƒæ•°æ® -->
        <div class="grid grid-cols-2 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div>
            <div class="text-xs text-gray-500 dark:text-gray-400">å¸–å­ID</div>
            <div class="text-sm text-gray-900 dark:text-white font-mono mt-1">{{ post.weiboId }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500 dark:text-gray-400">MID</div>
            <div class="text-sm text-gray-900 dark:text-white font-mono mt-1">{{ post.mid }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500 dark:text-gray-400">å‘å¸ƒæ—¶é—´</div>
            <div class="text-sm text-gray-900 dark:text-white mt-1">{{ formatDate(post.createdAt) }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500 dark:text-gray-400">åœ°åŒº</div>
            <div class="text-sm text-gray-900 dark:text-white mt-1">{{ post.regionName || '-' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500 dark:text-gray-400">æ¥æº</div>
            <div class="text-sm text-gray-900 dark:text-white mt-1">{{ post.source || '-' }}</div>
          </div>
          <div>
            <div class="text-xs text-gray-500 dark:text-gray-400">æ–‡æœ¬é•¿åº¦</div>
            <div class="text-sm text-gray-900 dark:text-white mt-1">{{ post.textLength }}</div>
          </div>
        </div>

        <!-- äº’åŠ¨æ•°æ® -->
        <div class="grid grid-cols-3 gap-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ formatNumber(post.attitudesCount) }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">ç‚¹èµ</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ formatNumber(post.commentsCount) }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">è¯„è®º</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-gray-900 dark:text-white">{{ formatNumber(post.repostsCount) }}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">è½¬å‘</div>
          </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex gap-3 pt-4 border-t border-gray-200 dark:border-gray-700">
          <button
            (click)="viewComments(post)"
            class="flex-1 px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors">
            æŸ¥çœ‹è¯„è®º
          </button>
          <button
            (click)="deletePost(post); closeDetail()"
            class="flex-1 px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-colors">
            åˆ é™¤å¸–å­
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
