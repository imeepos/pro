<div class="p-6 max-w-4xl mx-auto">
  <!-- 页面标题和面包屑 -->
  <div class="mb-6">
    <nav class="flex mb-4" aria-label="Breadcrumb">
      <ol class="inline-flex items-center space-x-1 md:space-x-3">
        <li class="inline-flex items-center">
          <a routerLink="/data" class="text-sm font-medium text-gray-700 hover:text-blue-600">
            数据管理
          </a>
        </li>
        <li>
          <div class="flex items-center">
            <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            <span class="text-sm font-medium text-gray-500 ml-1">{{ title }}</span>
          </div>
        </li>
      </ol>
    </nav>

    <h1 class="text-2xl font-bold text-gray-900">{{ title }}</h1>
    <p class="text-gray-600 mt-1">{{ isEditMode ? '编辑现有数据源' : '创建新的数据源' }}</p>
  </div>

  <!-- 加载状态 -->
  <div *ngIf="loading" class="bg-white rounded-lg shadow p-8 text-center">
    <div class="inline-flex items-center">
      <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      加载中...
    </div>
  </div>

  <!-- 错误提示 -->
  <div *ngIf="error && !loading" class="mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md">
    <div class="flex">
      <div class="flex-shrink-0">
        <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-medium">错误</h3>
        <p class="text-sm mt-1">{{ error }}</p>
      </div>
    </div>
  </div>

  <!-- 表单 -->
  <div *ngIf="!loading" class="bg-white rounded-lg shadow">
    <form [formGroup]="dataForm" (ngSubmit)="onSubmit()" class="space-y-6 p-6">

      <!-- 基本信息 -->
      <div class="border-b border-gray-200 pb-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">基本信息</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- 数据类型 -->
          <div>
            <label for="sourceType" class="block text-sm font-medium text-gray-700 mb-2">
              数据类型 <span class="text-red-500">*</span>
            </label>
            <select
              id="sourceType"
              formControlName="sourceType"
              [class.border-red-300]="isFieldInvalid('sourceType')"
              [class.focus:ring-red-500]="isFieldInvalid('sourceType')"
              [class.focus:border-red-500]="isFieldInvalid('sourceType')"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            >
              <option *ngFor="let type of sourceTypes" [value]="type.value">
                {{ type.label }}
              </option>
            </select>
            <p *ngIf="getFieldError('sourceType')" class="mt-1 text-sm text-red-600">
              {{ getFieldError('sourceType') }}
            </p>
          </div>

          <!-- 数据源URL -->
          <div>
            <label for="sourceUrl" class="block text-sm font-medium text-gray-700 mb-2">
              数据源URL <span class="text-red-500">*</span>
            </label>
            <div class="flex rounded-md shadow-sm">
              <input
                type="url"
                id="sourceUrl"
                formControlName="sourceUrl"
                placeholder="https://example.com/data"
                [class.border-red-300]="isFieldInvalid('sourceUrl')"
                [class.focus:ring-red-500]="isFieldInvalid('sourceUrl')"
                [class.focus:border-red-500]="isFieldInvalid('sourceUrl')"
                class="flex-1 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              />
              <button
                type="button"
                (click)="onImportFromUrl()"
                class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 rounded-r-md bg-gray-50 text-gray-700 text-sm hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                导入
              </button>
            </div>
            <p *ngIf="getFieldError('sourceUrl')" class="mt-1 text-sm text-red-600">
              {{ getFieldError('sourceUrl') }}
            </p>
          </div>
        </div>
      </div>

      <!-- 原始内容 -->
      <div class="border-b border-gray-200 pb-6">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-medium text-gray-900">原始内容</h3>
          <button
            type="button"
            (click)="onPreviewContent()"
            class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
            </svg>
            预览
          </button>
        </div>

        <div>
          <label for="rawContent" class="block text-sm font-medium text-gray-700 mb-2">
            内容 <span class="text-red-500">*</span>
          </label>
          <textarea
            id="rawContent"
            formControlName="rawContent"
            rows="12"
            placeholder="请输入或粘贴原始数据内容..."
            [class.border-red-300]="isFieldInvalid('rawContent')"
            [class.focus:ring-red-500]="isFieldInvalid('rawContent')"
            [class.focus:border-red-500]="isFieldInvalid('rawContent')"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"
          ></textarea>
          <p *ngIf="getFieldError('rawContent')" class="mt-1 text-sm text-red-600">
            {{ getFieldError('rawContent') }}
          </p>
          <p class="mt-1 text-sm text-gray-500">
            支持HTML、JSON、XML等多种格式的原始数据
          </p>
        </div>
      </div>

      <!-- 元数据 -->
      <div formGroupName="metadata">
        <h3 class="text-lg font-medium text-gray-900 mb-4">元数据</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- 标题 -->
          <div>
            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
              标题
            </label>
            <input
              type="text"
              id="title"
              formControlName="title"
              placeholder="数据标题"
              [class.border-red-300]="isMetadataFieldInvalid('title')"
              [class.focus:ring-red-500]="isMetadataFieldInvalid('title')"
              [class.focus:border-red-500]="isMetadataFieldInvalid('title')"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
            <p *ngIf="getMetadataFieldError('title')" class="mt-1 text-sm text-red-600">
              {{ getMetadataFieldError('title') }}
            </p>
          </div>

          <!-- 作者 -->
          <div>
            <label for="author" class="block text-sm font-medium text-gray-700 mb-2">
              作者
              <span *ngIf="dataForm.get('sourceType')?.value === SourceType.WEIBO_HTML ||
                           dataForm.get('sourceType')?.value === SourceType.WEIBO_API_JSON ||
                           dataForm.get('sourceType')?.value === SourceType.WEIBO_COMMENT"
                    class="text-red-500">*</span>
            </label>
            <input
              type="text"
              id="author"
              formControlName="author"
              placeholder="数据作者或来源"
              [class.border-red-300]="isMetadataFieldInvalid('author')"
              [class.focus:ring-red-500]="isMetadataFieldInvalid('author')"
              [class.focus:border-red-500]="isMetadataFieldInvalid('author')"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
            <p *ngIf="getMetadataFieldError('author')" class="mt-1 text-sm text-red-600">
              {{ getMetadataFieldError('author') }}
            </p>
          </div>

          <!-- 描述 -->
          <div class="md:col-span-2">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
              描述
            </label>
            <textarea
              id="description"
              formControlName="description"
              rows="3"
              placeholder="数据描述信息"
              [class.border-red-300]="isMetadataFieldInvalid('description')"
              [class.focus:ring-red-500]="isMetadataFieldInvalid('description')"
              [class.focus:border-red-500]="isMetadataFieldInvalid('description')"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            ></textarea>
            <p *ngIf="getMetadataFieldError('description')" class="mt-1 text-sm text-red-600">
              {{ getMetadataFieldError('description') }}
            </p>
          </div>

          <!-- 标签 -->
          <div>
            <label for="tags" class="block text-sm font-medium text-gray-700 mb-2">
              标签
            </label>
            <input
              type="text"
              id="tags"
              formControlName="tags"
              placeholder="标签1, 标签2, 标签3"
              [class.border-red-300]="isMetadataFieldInvalid('tags')"
              [class.focus:ring-red-500]="isMetadataFieldInvalid('tags')"
              [class.focus:border-red-500]="isMetadataFieldInvalid('tags')"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
            <p *ngIf="getMetadataFieldError('tags')" class="mt-1 text-sm text-red-600">
              {{ getMetadataFieldError('tags') }}
            </p>
            <p class="mt-1 text-sm text-gray-500">
              多个标签用逗号分隔
            </p>
          </div>

          <!-- 发布时间 -->
          <div>
            <label for="publishedAt" class="block text-sm font-medium text-gray-700 mb-2">
              发布时间
            </label>
            <input
              type="datetime-local"
              id="publishedAt"
              formControlName="publishedAt"
              [class.border-red-300]="isMetadataFieldInvalid('publishedAt')"
              [class.focus:ring-red-500]="isMetadataFieldInvalid('publishedAt')"
              [class.focus:border-red-500]="isMetadataFieldInvalid('publishedAt')"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            />
            <p *ngIf="getMetadataFieldError('publishedAt')" class="mt-1 text-sm text-red-600">
              {{ getMetadataFieldError('publishedAt') }}
            </p>
          </div>
        </div>
      </div>

      <!-- 表单操作按钮 -->
      <div class="flex items-center justify-between pt-6 border-t border-gray-200">
        <div class="flex space-x-3">
          <button
            type="button"
            (click)="onReset()"
            [disabled]="saving"
            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            重置
          </button>
        </div>

        <div class="flex space-x-3">
          <button
            type="button"
            (click)="onCancel()"
            [disabled]="saving"
            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            取消
          </button>

          <button
            type="submit"
            [disabled]="dataForm.invalid || saving"
            class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <svg *ngIf="saving" class="animate-spin -ml-1 mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <svg *ngIf="!saving && !isEditMode" class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            <svg *ngIf="!saving && isEditMode" class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            {{ submitButtonText }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>