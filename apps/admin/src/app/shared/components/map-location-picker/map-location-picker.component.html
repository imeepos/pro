<div class="map-location-picker">
  <div class="search-panel">
    <div class="search-input">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (keyup.enter)="searchLocation()"
        placeholder="搜索地点、地标或地址..."
        [disabled]="isLoading || !!errorMessage"
      />
      <button type="button" (click)="searchLocation()" [disabled]="searching || isLoading || !!errorMessage">
        {{ searching ? '搜索中...' : '搜索' }}
      </button>
      <button type="button" class="ghost" *ngIf="searchTerm" (click)="clearSearch()">清除</button>
    </div>
    <div class="search-feedback">
      <span class="hint" *ngIf="!errorMessage">按回车或点击搜索开始检索</span>
      <span class="error" *ngIf="searchError">{{ searchError }}</span>
    </div>
    <ul class="search-results" *ngIf="searchResults.length">
      <li
        *ngFor="let result of searchResults"
        (click)="selectSearchResult(result)"
        [class.active]="result.id === activeResultId"
      >
        <div class="result-name">{{ result.name }}</div>
        <div class="result-address">{{ result.address || '暂无详细地址' }}</div>
      </li>
    </ul>
  </div>

  <div class="status-panel" *ngIf="isLoading">
    <div class="spinner"></div>
    <span>地图正在苏醒，请稍候...</span>
  </div>

  <div class="status-panel error" *ngIf="!isLoading && errorMessage">
    <span class="status-icon">⚠️</span>
    <div class="status-text">
      <p class="status-title">无法载入地图</p>
      <p class="status-message">{{ errorMessage }}</p>
      <p class="status-hint">请确认环境变量中的高德地图 API Key 是否有效。</p>
    </div>
  </div>

  <div
    #mapHost
    class="map-canvas"
    [class.map-canvas--inactive]="errorMessage"
    [style.height]="height"
  ></div>

  <div class="selection" *ngIf="selectedPoint">
    <div class="coord">
      <span>经度</span>
      <strong>{{ selectedPoint.longitude | number: '1.6-6' }}</strong>
    </div>
    <div class="coord">
      <span>纬度</span>
      <strong>{{ selectedPoint.latitude | number: '1.6-6' }}</strong>
    </div>
    <ng-container *ngIf="formatPoint(selectedPoint) as summary">
      <div class="address">{{ summary }}</div>
    </ng-container>
    <button type="button" class="clear" (click)="clearSelection()">重新选择</button>
  </div>
</div>
