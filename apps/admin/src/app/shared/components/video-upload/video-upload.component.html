<div class="video-upload-container">
  <!-- 上传区域 -->
  <div
    *ngIf="uploadingVideos.length < maxCount"
    class="upload-area"
    [class.dragging]="isDragging"
    [class.disabled]="disabled"
    (click)="!disabled && fileInput.click()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <input
      #fileInput
      type="file"
      [accept]="accept"
      [multiple]="multiple"
      [disabled]="disabled"
      (change)="onFileSelect($event)"
      hidden
    >

    <div class="upload-content">
      <svg class="upload-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
      </svg>
      <div class="upload-text">
        <button type="button" class="upload-button" [disabled]="disabled">
          点击上传视频
        </button>
        <span class="upload-hint">或拖拽视频到此处</span>
      </div>
      <p class="upload-limit">
        支持常见视频格式，单个文件不超过 {{ maxSize / (1024 * 1024) }}MB，最多 {{ maxCount }} 个视频
      </p>
    </div>
  </div>

  <!-- 视频列表 -->
  <div *ngIf="uploadingVideos.length > 0" class="video-grid">
    <div
      *ngFor="let video of uploadingVideos; trackBy: trackByVideo"
      class="video-item"
      [class.uploading]="video.status === 'uploading'"
      [class.success]="video.status === 'success'"
      [class.error]="video.status === 'error'"
    >
      <!-- 视频预览 -->
      <div class="video-preview">
        <video
          *ngIf="video.status === 'success'"
          [src]="video.previewUrl"
          class="video-player"
          controls
          preload="metadata"
        ></video>

        <!-- 封面（上传中/失败时显示） -->
        <div
          *ngIf="video.status !== 'success'"
          class="video-cover"
          [style.background-image]="video.coverUrl ? 'url(' + video.coverUrl + ')' : 'none'"
        >
          <!-- 上传中的遮罩 -->
          <div *ngIf="video.status === 'uploading'" class="progress-overlay">
            <div class="progress-circle">
              <svg class="progress-ring" width="60" height="60">
                <circle
                  class="progress-ring-circle"
                  stroke="white"
                  stroke-width="4"
                  fill="transparent"
                  r="26"
                  cx="30"
                  cy="30"
                  [style.stroke-dasharray]="163.4"
                  [style.stroke-dashoffset]="163.4 - (163.4 * video.progress / 100)"
                />
              </svg>
              <span class="progress-text">{{ video.progress }}%</span>
            </div>
          </div>

          <!-- 错误遮罩 -->
          <div *ngIf="video.status === 'error'" class="error-overlay">
            <svg class="error-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="error-text">{{ video.error || '上传失败' }}</span>
          </div>
        </div>
      </div>

      <!-- 视频信息 -->
      <div class="video-info">
        <p class="video-name" [title]="video.file.name">
          {{ video.file.name }}
        </p>
        <div class="video-meta">
          <span class="meta-item">{{ formatFileSize(video.file.size) }}</span>
          <span *ngIf="video.duration" class="meta-item">
            <svg class="meta-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            {{ formatDuration(video.duration) }}
          </span>
        </div>
      </div>

      <!-- 删除按钮 -->
      <button
        *ngIf="video.status === 'success' || video.status === 'error'"
        type="button"
        class="delete-button"
        (click)="deleteVideo(video)"
        title="删除视频"
      >
        <svg class="delete-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- 空状态提示 -->
  <div *ngIf="uploadingVideos.length === 0" class="empty-state">
    <svg class="empty-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
    </svg>
    <p class="empty-text">暂无视频，点击上方区域上传</p>
  </div>
</div>
