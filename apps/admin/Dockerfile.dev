FROM node:20-alpine

WORKDIR /app

# 安装 pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# 复制 package.json 和 pnpm workspace 配置
COPY package.json pnpm-workspace.yaml pnpm-lock.yaml ./
COPY apps/admin/package.json ./apps/admin/
COPY packages ./packages

# 安装依赖
RUN pnpm install --frozen-lockfile

# 暴露端口
EXPOSE 4201

# 启动开发服务器
CMD ["pnpm", "--filter", "@pro/admin", "dev", "--host", "0.0.0.0"]
