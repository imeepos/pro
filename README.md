# Pro Monorepo

ä¸€ä¸ªåŸºäºå¾®æœåŠ¡æ¶æ„çš„æ•°æ®é‡‡é›†ä¸å¤„ç†å¹³å°ï¼Œä¸“æ³¨äºç¤¾äº¤åª’ä½“å’Œç”µå•†å¹³å°çš„æ•°æ®çˆ¬å–ã€æ¸…æ´—å’Œåˆ†æã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æŠ€æœ¯æ ˆ
- **åŒ…ç®¡ç†**: pnpm (å¿«é€Ÿçš„ã€èŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å™¨)
- **æ„å»ºå·¥å…·**: Turbo (é«˜æ€§èƒ½æ„å»ºç³»ç»Ÿ)
- **åç«¯æ¡†æ¶**: NestJS (å¯æ‰©å±•çš„Node.jsæ¡†æ¶)
- **å‰ç«¯æ¡†æ¶**: Angular 20 (ç°ä»£åŒ–çš„å‰ç«¯æ¡†æ¶)
- **æ•°æ®åº“**: PostgreSQL + MongoDB + Redis
- **æ¶ˆæ¯é˜Ÿåˆ—**: RabbitMQ
- **å¯¹è±¡å­˜å‚¨**: MinIO
- **æµè§ˆå™¨è‡ªåŠ¨åŒ–**: Playwright
- **å®¹å™¨åŒ–**: Docker

### æ¶æ„æ¨¡å¼
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚    â”‚   Admin         â”‚
â”‚   (Angular)     â”‚    â”‚   (Angular)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           API Gateway            â”‚
â”‚          (NestJS API)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Broker â”‚  â”‚Crawler â”‚  â”‚Cleaner â”‚
â”‚(è°ƒåº¦å™¨) â”‚  â”‚(çˆ¬è™«)  â”‚  â”‚(æ¸…æ´—å™¨)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚            â”‚            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚     æ¶ˆæ¯é˜Ÿåˆ— & å­˜å‚¨      â”‚
    â”‚ RabbitMQ + PostgreSQL   â”‚
    â”‚  + MongoDB + Redis      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

### Apps ç›®å½• - åº”ç”¨æœåŠ¡

#### ğŸ”§ `admin` (ç«¯å£: 4201)
**ç®¡ç†åå°ç³»ç»Ÿ**
- **æŠ€æœ¯æ ˆ**: Angular 20, Flowbite UI, TailwindCSS
- **åŠŸèƒ½**: ç³»ç»Ÿç®¡ç†ã€ä»»åŠ¡ç›‘æ§ã€æ•°æ®å¯è§†åŒ–
- **ç‰¹æ€§**:
  - å“åº”å¼ä»ªè¡¨æ¿ (angular-gridster2)
  - åœ°å›¾é›†æˆ (é«˜å¾·åœ°å›¾)
  - å®æ—¶æ•°æ®å±•ç¤º (Socket.IO)
  - æœ¬åœ°æ•°æ®å­˜å‚¨ (Dexie)

#### ğŸŒ `api` (GraphQL æ ¸å¿ƒæœåŠ¡)
**ç»Ÿä¸€ GraphQL ç½‘å…³**
- **æŠ€æœ¯æ ˆ**: NestJS, Apollo GraphQL, TypeORM, PostgreSQL
- **æ¥å£æ¨¡å¼**: æ‰€æœ‰å¯¹å¤–èƒ½åŠ›é€šè¿‡å•ä¸€ `/graphql` ç«¯ç‚¹æš´éœ²ï¼Œæ”¯æŒ Query / Mutation / Subscription
- **é¢†åŸŸæ¨¡å—**:
  - è®¤è¯æˆæƒï¼šæ³¨å†Œã€ç™»å½•ã€åˆ·æ–°ã€æ³¨é”€ã€å½“å‰ç”¨æˆ·
  - ç”¨æˆ· & API Key ç®¡ç†
  - å¾®åš / äº¬ä¸œè´¦å·ä¸ç™»å½•ä¼šè¯ï¼ˆå«å®æ—¶è®¢é˜…ï¼‰
  - åª’ä½“ç±»å‹ã€ä»ªè¡¨æ¿ã€å±å¹•ç¼–æ’ç­‰æ•°æ®ç®¡ç†
  - äº‹ä»¶ä¸é™„ä»¶ï¼ˆé¢„ç­¾åç›´ä¼  + ç¡®è®¤ï¼‰
  - é€šçŸ¥æ¨é€ä¸å®æ—¶æ•°æ®å¹¿æ’­
- **å…¼å®¹æ€§æç¤º**: å†å² `/api/*` REST è·¯å¾„å·²ä¸‹çº¿å¹¶è¿”å› `410 Gone`ï¼Œè¯·æ”¹ç”¨ GraphQLã€‚è¯¦è§ [`docs/graphql-migration.md`](docs/graphql-migration.md)ã€‚

> æœ¬åœ°å¼€å‘å¯ä½¿ç”¨ `pnpm --filter @pro/api run dev` å¯åŠ¨æœåŠ¡ï¼Œç„¶ååœ¨ http://localhost:3000/graphql è®¿é—® GraphQL Playgroundã€‚

å¸¸ç”¨ GraphQL æŒ‡å—ï¼š

- å¥åº·æ£€æŸ¥
  ```graphql
  query Health {
    health { status timestamp }
  }
  ```
- ç”¨æˆ·æ³¨å†Œ / ç™»å½•
  ```graphql
  mutation Register($input: RegisterDto!) {
    register(input: $input) { accessToken refreshToken user { id username } }
  }

  mutation Login($input: LoginDto!) {
    login(input: $input) { accessToken refreshToken }
  }
  ```
- å¾®åšç™»å½•è®¢é˜…ï¼ˆéœ€é…åˆ Mutation `startWeiboLogin`ï¼‰
  ```graphql
  subscription WeiboLoginEvents($sessionId: String!) {
    weiboLoginEvents(sessionId: $sessionId) {
      type
      data
    }
  }
  ```

æ›´å¤š REST â†’ GraphQL å¯¹ç…§ã€é™„ä»¶ä¸Šä¼ æµç¨‹ç­‰å†…å®¹è¯·å‚è€ƒ [`docs/graphql-migration.md`](docs/graphql-migration.md)ã€‚

#### âš¡ `broker` (ä»»åŠ¡è°ƒåº¦ä¸­å¿ƒ)
**æ™ºèƒ½ä»»åŠ¡åˆ†å‘å™¨**
- **æŠ€æœ¯æ ˆ**: NestJS, TypeORM, å®šæ—¶ä»»åŠ¡
- **åŠŸèƒ½**: ä¸»ä»»åŠ¡æ‰«æã€å­ä»»åŠ¡ç”Ÿæˆã€è´Ÿè½½å‡è¡¡
- **èŒè´£**:
  - æ‰«æå¾®åšæœç´¢ä»»åŠ¡
  - ç”Ÿæˆçˆ¬å–å­ä»»åŠ¡
  - ç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
  - ä»»åŠ¡é‡è¯•ä¸å¤±è´¥å¤„ç†

#### ğŸ§¹ `cleaner` (æ•°æ®æ¸…æ´—æœåŠ¡)
**æ•°æ®å¤„ç†å¼•æ“**
- **æŠ€æœ¯æ ˆ**: NestJS, MongoDB, æ¶ˆæ¯é˜Ÿåˆ—
- **åŠŸèƒ½**: åŸå§‹æ•°æ®æ¸…æ´—ã€ç»“æ„åŒ–å¤„ç†ã€è´¨é‡æ£€æŸ¥
- **å¤„ç†æµç¨‹**:
  - æ¥æ”¶åŸå§‹çˆ¬å–æ•°æ®
  - æ•°æ®å»é‡ä¸éªŒè¯
  - å†…å®¹æå–ä¸æ ‡å‡†åŒ–
  - å­˜å‚¨åˆ°ç»“æ„åŒ–æ•°æ®åº“

#### ğŸ•·ï¸ `crawler` (çˆ¬è™«æœåŠ¡)
**æ™ºèƒ½ç½‘é¡µçˆ¬å–å™¨**
- **æŠ€æœ¯æ ˆ**: NestJS, Playwright, MongoDB
- **åŠŸèƒ½**: å¤šå¹³å°æ•°æ®çˆ¬å–ã€åçˆ¬çªç ´ã€æ•°æ®å­˜å‚¨
- **æ”¯æŒå¹³å°**:
  - å¾®åšæœç´¢ä¸ç”¨æˆ·æ•°æ®
  - äº¬ä¸œå•†å“ä¿¡æ¯
- **ç‰¹æ€§**:
  - æµè§ˆå™¨è‡ªåŠ¨åŒ– (Playwright)
  - è´¦å·æ± ç®¡ç†
  - è¯·æ±‚ç›‘æ§ä¸é™æµ
  - robots.txt éµå¾ª
  - åŸå§‹æ•°æ®å¤‡ä»½

#### ğŸŒŸ `web` (å‰ç«¯å±•ç¤º)
**å…¬å…±å±•ç¤ºç•Œé¢**
- **æŠ€æœ¯æ ˆ**: Angular 20, TailwindCSS
- **åŠŸèƒ½**: æ•°æ®å±•ç¤ºã€ç”¨æˆ·äº¤äº’ã€å®æ—¶æ›´æ–°
- **ç‰¹æ€§**:
  - çŠ¶æ€ç®¡ç† (Akita)
  - JWTè®¤è¯
  - Socket.IOå®æ—¶é€šä¿¡

### Packages ç›®å½• - å…±äº«åŒ…

#### ğŸ—ï¸ åŸºç¡€è®¾æ–½å±‚

##### `@pro/types` - ç±»å‹å®šä¹‰åŸºçŸ³
- **çº¯TypeScriptç±»å‹åº“**
- **é›¶ä¾èµ–è®¾è®¡**
- **å…¨é¡¹ç›®ç±»å‹ç»Ÿä¸€**

##### `@pro/entities` - æ•°æ®æ¨¡å‹å±‚
- **TypeORMå®ä½“å®šä¹‰**
- **æ•°æ®åº“æ˜ å°„**
- **å…³ç³»é…ç½®**

##### `@pro/utils` - å·¥å…·å‡½æ•°åº“
- **é€šç”¨å·¥å…·å‡½æ•°**
- **JWTå¤„ç†å·¥å…·**
- **ç±»å‹å®‰å…¨çš„å·¥å…·é›†**

#### ğŸ¨ ç”¨æˆ·ç•Œé¢å±‚

##### `@pro/components` - å…±äº«UIç»„ä»¶
- **Angularç»„ä»¶åº“**
- **å¯å¤ç”¨UIå…ƒç´ **
- **ç»Ÿä¸€è®¾è®¡è¯­è¨€**

##### `@pro/sdk` - APIæ¥å£å®šä¹‰
- **å‰ç«¯APIæ¥å£**
- **RxJSå“åº”å¼ç¼–ç¨‹**
- **ç±»å‹å®‰å…¨çš„APIè°ƒç”¨**

#### ğŸ”§ æœåŠ¡å±‚

##### `@pro/logger` - ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
- **åŸºäºPinoçš„é«˜æ€§èƒ½æ—¥å¿—**
- **ç»“æ„åŒ–æ—¥å¿—è¾“å‡º**
- **NestJSé›†æˆ**

#### ğŸ’¾ æ•°æ®å­˜å‚¨å±‚

##### `@pro/mongodb` - MongoDBæ“ä½œ
- **åŸå§‹æ•°æ®å­˜å‚¨**
- **Mongoose ODM**
- **çˆ¬è™«æ•°æ®ä¸“ç”¨**

##### `@pro/redis` - ç¼“å­˜æ“ä½œ
- **é«˜æ€§èƒ½ç¼“å­˜**
- **IORediså®¢æˆ·ç«¯**
- **ä¼šè¯å­˜å‚¨**

##### `@pro/rabbitmq` - æ¶ˆæ¯é˜Ÿåˆ—
- **å¼‚æ­¥ä»»åŠ¡å¤„ç†**
- **æœåŠ¡é—´é€šä¿¡**
- **AMQPåè®®**

##### `@pro/minio` - å¯¹è±¡å­˜å‚¨
- **æ–‡ä»¶å­˜å‚¨æœåŠ¡**
- **S3å…¼å®¹API**
- **åª’ä½“æ–‡ä»¶ç®¡ç†**

## ğŸ”„ æ•°æ®æµæ¶æ„

### ä»»åŠ¡è°ƒåº¦æµç¨‹
```
1. Broker æ‰«æä¸»ä»»åŠ¡ (å®šæ—¶)
2. ç”Ÿæˆå­ä»»åŠ¡å¹¶æ¨é€åˆ° RabbitMQ
3. Crawler æ¶ˆè´¹ä»»åŠ¡è¿›è¡Œçˆ¬å–
4. åŸå§‹æ•°æ®å­˜å‚¨åˆ° MongoDB
5. Cleaner å¤„ç†åŸå§‹æ•°æ®
6. æ¸…æ´—åæ•°æ®å­˜å‚¨åˆ° PostgreSQL
7. GraphQL æœåŠ¡æä¾›æ•°æ®è®¿é—®æ¥å£
8. Frontend å±•ç¤ºå¤„ç†ç»“æœ
```

### å­˜å‚¨ç­–ç•¥
- **PostgreSQL**: ç»“æ„åŒ–ä¸šåŠ¡æ•°æ®
- **MongoDB**: åŸå§‹çˆ¬å–æ•°æ®
- **Redis**: ç¼“å­˜ä¸ä¼šè¯
- **MinIO**: æ–‡ä»¶ä¸åª’ä½“èµ„æº

## ğŸš€ å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚
- Node.js >= 20.0.0
- pnpm >= 9.0.0
- Docker & Docker Compose
- PostgreSQL 14+
- MongoDB 6+
- Redis 7+
- RabbitMQ 3.12+

### å¿«é€Ÿå¼€å§‹

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨åŸºç¡€æœåŠ¡ (æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰)
docker compose up -d postgres mongodb redis rabbitmq minio

# å¯åŠ¨æ‰€æœ‰åº”ç”¨æœåŠ¡ (å¼€å‘æ¨¡å¼)
pnpm run dev

# æˆ–è€…å•ç‹¬å¯åŠ¨ç‰¹å®šæœåŠ¡
cd apps/api && pnpm run dev    # GraphQL æœåŠ¡ï¼ˆè®¿é—® http://localhost:3000/graphqlï¼‰
cd apps/admin && pnpm run dev  # ç®¡ç†åå°
cd apps/web && pnpm run dev    # å‰ç«¯åº”ç”¨

# æ„å»ºæ‰€æœ‰åŒ…
pnpm run build

# è¿è¡Œæµ‹è¯•
pnpm run test

# ç±»å‹æ£€æŸ¥
pnpm run typecheck

# ä»£ç æ£€æŸ¥
pnpm run lint
```

### å¤šæœåŠ¡æœ¬åœ°å¼€å‘

è¯¦ç»†çš„å¤šæœåŠ¡æœ¬åœ°å¼€å‘æŒ‡å—è¯·å‚è€ƒï¼š[æœ¬åœ°å¼€å‘æ–‡æ¡£](docs/LOCAL_DEVELOPMENT.md)

### å•ç‹¬æœåŠ¡å¼€å‘

```bash
# GraphQL æœåŠ¡å¼€å‘
cd apps/api
pnpm run dev

# å¥åº·æ£€æŸ¥ï¼ˆGraphQLï¼‰
curl -s -X POST http://localhost:3000/graphql \\
  -H 'Content-Type: application/json' \\
  -d '{"query":"{ health { status timestamp } }"}'

# çˆ¬è™«æœåŠ¡å¼€å‘
cd apps/crawler
pnpm run dev

# å‰ç«¯å¼€å‘
cd apps/web
pnpm run dev

# ç®¡ç†åå°å¼€å‘
cd apps/admin
pnpm run dev
```

### åŒ…å¼€å‘

```bash
# ç±»å‹åŒ…
cd packages/types
pnpm run dev

# ç»„ä»¶åŒ…
cd packages/components
pnpm run dev
```

## ğŸ³ Docker éƒ¨ç½²

### æ„å»ºé•œåƒ
```bash
# æ„å»ºç”Ÿäº§é•œåƒ
docker build -f Dockerfile.pro -t imeepos/pro:latest .

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

### å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
# ä»…å¯åŠ¨åŸºç¡€æœåŠ¡
docker compose up -d postgres mongodb redis rabbitmq minio

# ç„¶åå¯åŠ¨åº”ç”¨æœåŠ¡
pnpm run dev
```

### æœåŠ¡ç«¯å£
- **API**: 3000
- **Admin**: 4201
- **Web**: 4200
- **Broker**: 3001
- **Crawler**: 3002
- **Cleaner**: 3003

## ğŸ“Š ç›‘æ§ä¸ç»´æŠ¤

### æ—¥å¿—ç³»ç»Ÿ
- åŸºäº Pino çš„ç»“æ„åŒ–æ—¥å¿—
- ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼å’Œç­‰çº§
- æœåŠ¡æ ‡è¯†ä¸è¿½è¸ª

### å¥åº·æ£€æŸ¥
```bash
# API å¥åº·æ£€æŸ¥
curl http://xxx:3000/health

# å„æœåŠ¡çŠ¶æ€ç›‘æ§
docker compose ps
```

### æ€§èƒ½ç›‘æ§
- RabbitMQ ç®¡ç†ç•Œé¢: http://localhost:15672
- ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å®æ—¶ç›‘æ§
- çˆ¬å–é€Ÿç‡ä¸æˆåŠŸç‡ç»Ÿè®¡

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- JWT è®¤è¯ä¸æˆæƒ
- API å¯†é’¥ç®¡ç†
- è¯·æ±‚é¢‘ç‡é™åˆ¶
- æ•°æ®åŠ å¯†å­˜å‚¨
- å®¹å™¨å®‰å…¨éš”ç¦»

## ğŸ“ˆ æ‰©å±•æ€§

### æ°´å¹³æ‰©å±•
- çˆ¬è™«æœåŠ¡å¤šå®ä¾‹éƒ¨ç½²
- æ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½å‡è¡¡
- æ•°æ®åº“è¯»å†™åˆ†ç¦»

### åŠŸèƒ½æ‰©å±•
- æ–°å¹³å°çˆ¬å–å™¨æ’ä»¶åŒ–
- æ•°æ®å¤„ç†ç®¡é“å¯é…ç½®
- å‰ç«¯ç»„ä»¶æ¨¡å—åŒ–

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. éµå¾ªç°æœ‰ä»£ç é£æ ¼
2. ç¼–å†™å……åˆ†çš„æµ‹è¯•ç”¨ä¾‹
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. æäº¤å‰è¿è¡Œç±»å‹æ£€æŸ¥

## ğŸ“„ è®¸å¯è¯

UNLICENSED - ä»…ä¾›å†…éƒ¨ä½¿ç”¨

---

**æ„å»ºçŠ¶æ€**: ä½¿ç”¨ Turbo å®ç°å¿«é€Ÿæ„å»ºç¼“å­˜
**åŒ…ç®¡ç†**: ä½¿ç”¨ pnpm å®ç°é«˜æ•ˆä¾èµ–ç®¡ç†
**æ¶æ„æ¨¡å¼**: å¾®æœåŠ¡ + å•ä½“ä»“åº“çš„æ··åˆæ¶æ„
